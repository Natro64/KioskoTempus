/*!
* Data Aquarium Framework - Touch UI
* Copyright 2008-2015 Code On Time LLC; Licensed MIT; http://codeontime.com/license
*/
(function(){function uu(){return $(this).is(":visible")}function hs(){return $("<style/>").appendTo($("head"))}function cw(n){n.session("grid-style-changed",!0)}function pe(n){var t=n.pageProp("frozenField");return!t&&n._hasKey()&&(t="_first_"),t||"_none_"}function tf(n){return n||(n=i.activePage),n.find(".dv-heading")}function wl(n){tf(n).remove()}function bl(n){var t=n.replace(/\.\w+$/,"").replace(/\W/g,"_").toLowerCase()||"page";return t.match(/^\_/)&&(t=t.substring(1)),t}function rf(){var n=o.width(),t=o.height();return n<480&&t<640||t<480&&n<640}function kl(t){n.pageInfo(typeof t=="string"?t:t._id).echoChanged=!0}function dl(){return o.width()>=u.is(".app-sidebar-undocked")?480:673}function nr(){return i.activePage.find(".app-wrapper")}function we(){nr().focus()}function cs(){var n=s.location.href,t=n.indexOf("#");t>=0&&(n=n.substr(0,t));s.location.reload(n)}function ls(){if(!ru){var n=r.displayDensity;ru=16;n=="Compact"?ru==14:n=="Condensed"&&(ru=12)}return ru}function lw(n){var t=$(this),r,u=t.is(".app-bar-tools")?8:4,i=tt&&tt.x||n.clientX,f=tt&&tt.y||n.clientY;return t.find(".ui-btn-icon-notext").each(function(){var n=$(this),t,r;if(n.is(":visible")&&(t=n.offset().left,t-8<=i&&i<=t+n.outerWidth()+8))return n.trigger("vclick"),r=!0,!1}),r}function cr(n,t){var r=n.DynamicItems?n.DynamicItems:n.Items,u,e,i=t&&t.value,f=t&&t.text;return r&&!r.length&&t&&i&&(i=t.value,f=t.text,u=typeof i=="string"?i.split($app._simpleListRegex):[i],e=u.length>1?f.split($app._simpleListRegex):[f],$(u).each(function(n){r.push([u[n],e[n]])})),r}function yi(n,t){function r(){n.removeData("scrolling enableScrollEventsTimeout")}n.data("scrolling",!0);n.scrollTop(t);var i=n.data("enableScrollEventsTimeout");i!=null&&clearTimeout(i);n.data("enableScrollEventsTimeout",setTimeout(r,300))}function uf(n,t){t||(t=$("#"+n._id+"_echo"));t.length&&t.find(".app-echo-toolbar .app-echo-controls").addClass("app-stale");var i=w();setTimeout(function(){i==w()&&at()},500)}function f(){return ni&&ne=="mouse"}function as(n){return!n&&rf()?r.pageTransition!="none"?"slideup":"none":ht||ap?"none":"fade"}function be(n){return n&&typeof n=="string"&&n.match(/glyphicon-/)}function gl(){return $(".ui-panel-open .ui-btn.app-animated")}function vs(){return $(".ui-popup-active .ui-btn.app-animated")}function aw(){var n=o.width();return n>639&&n>o.height()}function na(n){yf($app.find(n.dataViewId))}function kt(){n.promo("search",yt.PerformAdvancedSearch);n.promo().data("icon-list",null)}function ta(){var t=n._menuButton;e(t,function(){t.trigger("vclick")})}function ys(n){$(n).find(".app-signature").each(function(){$app.upload("resize",{container:this})})}function vw(){return n.contextDataView()!=n.dataView()}function ps(){r.sidebar=="Landscape"?aw()?u.removeClass("app-sidebar-undocked"):u.addClass("app-sidebar-undocked"):r.sidebar=="Never"?u.addClass("app-sidebar-undocked"):u.removeClass("app-sidebar-undocked")}function ws(n){f()?s.open(n):s.location.href=n}function ia(){switch(r.displayDensity){case"Comfortable":return 46;case"Compact":return 40}return 35}function fu(){return(new Date).getTime()}function pi(n){return parseFloat(n.replace(/[A-Za-z]/g,""))}function yw(n){return n.x!=null&&(n.x=Math.ceil(n.x)),n.y!=null&&(n.y=Math.ceil(n.y)),n}function pw(){var t=n._toolbarUserName;if(!t.data("positioned")){var e=n._toolbarButtons,c,i=n._contextButton,l=i.is(":visible"),u=o.width(),a=Math.ceil(i.show().offset().left),s=i.outerWidth(),h=Math.ceil(s/2),r,f=e.length-1;for(t.data("positioned",!0),t.is(":visible")&&gu?(t.show().text(nf).attr("title",nf),t.css("right",u-i.position().left),r=Math.ceil(u-t.offset().left)):r=u-a+h;f>=0;)c=$(e[f]).css("right",r),r=r+s+h,f--;l||i.hide()}}function bs(n,t,i,r){if(n.htmlEncode())if(n.TextMode==3){for(var u=$app.htmlEncode(t).split(/\r?\n/),e,f=0;f<u.length;f++)e=u[f],m=e.match(/^\s+/),m&&(u[f]=Array(m[0].length*2).join("&nbsp;")+e.substring(m[0].length));t=u.join("<br/>");u.length>15?(i.html('<div class="app-text-collapsible"><\/div>').children().html(t),$('<span class="ui-btn ui-btn-icon-notext ui-btn-inline ui-icon-carat-d ui-inline ui-corner-all app-btn-toggle"/>').attr("title",go.Maximize).appendTo(i)):(i.html(t),r&&i.css("white-space","nowrap"))}else i.text(t);else i.html(t)}function ww(n){return String.format("{0} - {1}",yt.QuickFindText,n.get_view().Label)}function ff(n){n.refreshCallback&&(n.refreshCallback(),n.refreshCallback=null)}function ra(t,i,r){t.find("> .app-map, > .app-presenter-instruction").hide();r||(i._mapPageWindow=null);n.presenter("hide",{container:t})}function ua(){return String.format("{0:"+$app.dateFormatStrings["{0:f}"]+"}",new Date)}function lr(n){var t=r.pageTransition!="none";if(arguments.length==0)return t;t||n.removeClass("ui-panel-animate")}function ks(n,i,r){if(n._hasKey()){var u=$('<span class="app-btn-more">&nbsp;<\/span>').appendTo(i).attr("title",t.More);r&&u.addClass("app-frozen")}}function ke(n,t){if(n=$(n),t==null&&(t=n.val().length),n.length)try{n[0].setSelectionRange(t,t)}catch(i){}}function ds(n){var t=kw();"path"in n||(n.path=t.path);"fileName"in n||(n.fileName=t.fileName);$app.execute({controller:p.siteContent,filter:[{field:"Path",operator:"=",value:n.path},{field:"FileName",operator:"=",value:n.fileName}],success:function(t){var i={FileName:n.fileName,Path:n.path};t.SiteContent.length?n.callback(t.SiteContent[0]):$app.confirm("This is a static application page. A copy of the page will be created in the content management system. Continue?",function(){oa(i,"$Text",function(){ds(n)})})}})}function bw(){ds({callback:function(n){var t=p.siteContentPK;$app.touch.navigate({href:String.format("{0}pages/site-content?{1}={2}&_controller={3}&_commandName=Select&_commandArgument=editForm1",__baseUrl,t,n[t],p.siteContent)})}})}function kw(){var n=s.location.pathname,t;return(n=n.substring(p.rootUrl.length),n.match(/^\//)&&(n=n.substring(1)),t=n.lastIndexOf("/"),t==-1)?{path:null,fileName:n}:{path:n.substring(0,t),fileName:n.substring(t+1)}}function fa(n){if(!n){ds({callback:function(n){fa(n)}});return}nb(n)}function ea(n,t){n.errors.length?$app.alert(n.errors.join("\n")):t(n)}function oa(n,t,i){$app.execute({controller:p.siteContent,command:"Insert",view:"createForm1",values:[{name:"Path",newValue:n.Path},{name:"FileName",newValue:n.FileName},{name:"ContentType",newValue:"text/html"},{name:"Text",newValue:t}],success:function(n){ea(n,i)}})}function dw(n,t,i){var r=p.siteContentPK;$app.execute({controller:p.siteContent,command:"Update",view:"editForm1",values:[{name:r,oldValue:n[r]},{name:"Path",value:n.Path},{name:"FileName",value:n.FileName},{name:"Text",oldValue:n.Text,newValue:t}],success:function(n){ea(n,i)}})}function sa(){var n=$.mobile.activePage,t=n.find('[data-editable="true"]'),i;if(n.find(".app-page-content").addClass("app-editor-active"),n.find(".carousel").each(function(){$(this).carousel("pause").off("keydown.bs.carousel swipeleft swiperight")}),t.each(function(){var n=$(this),t;n.is("a")&&(n.attr({"data-href":n.attr("href"),tabIndex:0}),n.removeAttr("href"));t=n.html();n.data("data-content",t);t&&(t=t.replace(/\s*\r?\n\s*/g," ").trim(),n.html(t))}).attr("contenteditable","true"),i=n.find('.app-wrapper [data-editable="true"]').find("img, .glyphicon"),si)i.on("mousedown",function(n){$(n.target).focus()});return t}function gs(n){$(document).trigger($.Event("editor"+n+".app"))}function nh(n){var t=$.mobile.activePage;t.find('[data-editable="true"]').each(function(){var t=$(this),i=t.data("data-content");t.removeAttr("contenteditable").removeData("data-content");t.is("a")&&(t.attr({href:t.attr("data-href"),tabIndex:0}),t.removeAttr("data-href"));n&&t.html(i)});t.find(".app-page-content").removeClass("app-editor-active");gs("stop")}function gw(n){var a=$.mobile.activePage,u=[],r,h,f,t,i,o,e,s=0,c,l;if(f=a.find(".app-page-content").html(),r=n.Text,r&&(h=r.match(/<footer/),t=n.Text.match(/<([\s\S]*?)data-content-framework\s*=\s*"\w+"([\s\S]*?)>/),t&&(t=t[0],u.push(t),c=t.split(/<div[\s\S]*?>/gi),l=t.split(/<\/div>/gi),s=c.length-l.length),s)){for(i=[],o=/\s*<\/div>/gi,e=o.exec(r);e;)i.push(e.index),e=o.exec(r);i=r.substring(i[i.length-s])}return h||(f=f.replace(/\s*<footer([\s\S]+?)<\/footer>/,"")),u.push(f),i&&u.push(i),u.join("")}function ha(n,t){var i=gw(n);"Text"in n?dw(n,i,t):oa(n,i,t)}function nb(t){function o(){wt.disabled=!1;n.bar("remove",i.off());n.bar("remove",r.off())}var u=$.mobile.activePage,i,r,f=sa();f.length&&(wt.disabled=!0,i=$('<div class="app-bar-strip"><\/div>').appendTo(n.bar("create",{type:"header",page:u})).on("vclick",function(i){eu();var r=$(i.target).closest("a");return r.length&&e(r,function(){n.listPopup({anchor:r,iconPos:"left",items:[{text:"Save & Close",icon:"check",callback:function(){nh();ha(t,function(){o()})}},{text:"Save & Keep Editing",icon:"edit",callback:function(){nh();ha(t,function(){sa();gs("start")})}},{text:"Stop Editing",icon:"delete",callback:function(){nh(!0);o()}}]})}),!1}),r=$('<div class="app-bar-strip"><\/div>').appendTo(n.bar("create",{type:"footer",page:u})).on("vclick",function(n){function u(){i.is(".app-has-children")&&t.trigger($.Event("contextmenu",{relatedTarget:i})).addClass("app-editor-focus")}var i=$(n.target).closest(".ui-btn"),t;return i.length?e(i,function(){t=i.data("elem");t&&(t.is('[data-editable="true"]')?t.focus():eu(t),u())}):(i=r.find(".ui-btn").last(),i.length&&(t=i.data("elem"),t&&t.is('[data-editable="true"]')&&t.focus())),!1}),$('<a class="ui-btn ui-corner-all ui-mini app-has-children"/>').appendTo(i).text("Save & Close"),n.bar("show",i.parent()),n.bar("show",r.parent()),eu(f.first().focus()),gs("start"))}function tb(){return f()?"contextmenu":"vclick contextmenu"}function eu(n){var e=i.activePage,o=e.find(".app-bar-footer .app-bar-strip"),s,u,t,r,f,h;if(e.find(".app-editor-focus").removeClass("app-editor-focus"),s=o.find(".ui-btn"),n=$(n),s.removeData().remove(),n.length&&!n.closest("footer,.footer").length){for(n.is('[data-editable="true"]')||n.addClass("app-editor-focus"),u=[];n.length&&!n.is(".app-page-content");)t=null,n.is('[data-editable="true"]')?t=n.is(".btn")?"button":"text":n.is(".jumbotron")?t="jumbotron":n.is(".container")?t="container":n.is(".carousel")?t="carousel":n.parent().is(".row")&&n.is("div")&&(t="column"),t&&u.push({text:t,elem:n}),n=n.parent();for(r=u.length-1;r>=0;)f=u[r],n=f.elem,h=$('<a class="ui-btn ui-corner-all ui-mini"/>').appendTo(o).text(f.text).data("elem",n),r||n.is('[data-editable="true"]')&&!n.is("a")||h.addClass("app-has-children"),r--}}function ib(){var r=f()?"contextmenu":"vclick",n=i.activePage,t;n.on("focus",'[data-editable="true"]',function(){var n=$(this).closest(".ui-page").find(".app-bar-footer .app-bar-strip .ui-btn");n.length&&n.last().data("elem")[0]===this||eu(this)});n.on(r,'[data-editable="true"] .glyphicon',function(){function u(n){t.attr("class","glyphicon "+n)}function i(){var i=[];$(n).each(function(){var n=this,t={text:n,icon:"glyphicon-"+n,context:"glyphicon-"+n,callback:u};r==n&&(t.visible=!0);i.push(t)});a({anchor:t,iconPos:"left",title:"Glyphicon",items:i})}var t=$(this),r=(t.attr("class").match(/glyphicon-([\w+\-]+)/)||[])[1],n=$app.glyphicons;return si&&t.parent().focus(),n?i():$.ajax({url:__baseUrl+"touch/bootstrap.min.css",dataType:"html",success:function(t){var f=/\.glyphicon-([\w\-]+)/g,r,u;for(n=[],r=f.exec(t);r;)u=r[1],n.indexOf(u)==-1&&n.push(u),r=f.exec(t);n.sort();$app.glyphicons=n;i()}}),!1});n.on(r,'.btn[data-editable="true"]',function(n){function i(n){r.removeClass("btn-default btn-primary btn-success btn-info btn-warning btn-danger").addClass("btn-"+n)}function u(n){r.removeClass("btn-xs btn-sm btn-md btn-lg").addClass("btn-"+n)}function t(n,t,i,u){return{text:n,icon:r.is("."+t+"-"+i)?"check":"",context:i,callback:u}}var r=$(this);return a({anchor:n.relatedTarget||r,iconPos:"left",title:"Button",items:[t("Default","btn","default",i),t("Primary","btn","primary",i),t("Success","btn","success",i),t("Info","btn","info",i),t("Warning","btn","warning",i),t("Danger","btn","danger",i),{},t("X-Small","btn","xs",u),t("Small","btn","sm",u),t("Medium","btn","md",u),t("Large","btn","lg",u),]}),!1});n.on("vclick contextmenu",".row > div,.container,.carousel,.jumbotron",function(t){function r(){$app.alert("context menu")}var i=$(this);if(!$(t.target).closest('[data-editable="true"],a').length)return n.find('[data-editable="true"]').blur(),i.is(".app-editor-focus")&&t.type=="vclick"||(eu(i),t.type=="contextmenu"&&r()),!1});n.on("vclick contextmenu",".app-page-content",function(i){if(!$(i.target).closest('[data-editable="true"],a').length&&!t){var r;return n.find(".app-page-content > *").each(function(){var n=$(this);if(n.offset().top<=i.clientY&&n.offset().top+n.outerHeight()>=i.clientY&&!n.is("footer,.footer"))return r=!0,setTimeout(function(){t=!0;n.trigger(i.type);t=!1}),!0}),r||eu(),!1}})}function rb(){var t=tb(),n=i.activePage;n.off("focus",'[data-editable="true"]');n.off(t,'[data-editable="true"] .glyphicon');n.off(t,'.btn[data-editable="true"]');n.off("vclick contextmenu",".row > div,.container,.carousel,.jumbotron");n.off("vclick contextmenu",".app-page-content")}function ca(n,t){n.extension().quickFind(t);uv(n)}function ou(n){var t=[];return n&&n.viewProp("useAdvancedSearch")&&(t=n.viewProp("advancedSearchFilter")||t),t}function ef(n){er(n);aa(n);$(n._allFields).each(function(){delete this._listOfValues});n._forceSync();n.refreshData();ch();uv(n)}function th(n,t){!t&&ou(n).length&&n.viewProp("advancedSearchFilter",null);n.clearFilter();ef(n)}function la(n){var r=n._filter,t=ou(n),i;return t.length&&(n._filter=t,i=n.extension().filterStatus(!0),n._filter=r),i}function aa(n){var t=(n.get_filter()||[]).slice(0),r=[],u,i=0;for($(n.get_externalFilter()).each(function(){r.push(this.Name)});i<t.length;)u=t[i],Array.indexOf(r,u.match(/^\w+/)[0])!=-1?t.splice(i,1):i++;n.viewProp("filter",t);$(document).trigger("searching.app")}function va(){var t=n._menuStrip;return t&&t.strip.is(":visible")}function of(t){var r=n._menuStrip,i=r&&r.strip,u=n._menuPanel;if(i){var o=$(u).find('li a[rel="external"]'),f=o.parent(),e=$(u).find(".ui-li-divider:not(.app-info):not(.app-copy)");arguments.length==0&&(t=va());t?(i.show(),f.hide(),e.hide(),n._title.addClass("app-hidden")):(i.hide(),f.show(),e.show(),n._title.removeClass("app-hidden"))}}function ya(n){n.length&&n[n.length-1].text&&n.push({})}function de(t){var i;t=$(t);var f=t.attr("data-causes-calculate"),u=t.attr("data-causes-populate"),r=t.attr("data-causes-copy"),i;r&&(r=r.split(/\./),i=$app.find(r[1]),i._copyStaticLookupValues(i.findField(r[0])));f&&n.causesCalculate(f);u&&(u=u.split(/\./),$app.find(u[1])._raisePopulateDynamicLookups());i=n.dataView();i&&!t.is(":checkbox,:radio")&&setTimeout(function(){i.extension().calculate(n.dataView())},200)}function pa(n){var e=$(n.target),t,i,u,r=[],f;t=e.closest(".app-container-scrollable");t.length&&(i=t.next(),u=t.data("data-field"),t.find(":checkbox,:radio").each(function(n){$(this).is(":checked")&&(r.length&&r.push(","),r.push(cr(u)[n][0]))}),f=i.val(),i.val(r.join("")),f!=i.val()&&de(i))}function wa(t,i,r){var f=t.ItemsStyle=="CheckBoxList",h=cr(t,r),o=i.attr("id"),u=i.prev(),c=u.is(".app-container-scrollable"),s,e,l=[],a=i.val(),v=a.split(/\s*,\s*/),p=Math.min(Math.ceil(cr(t).length/(t.Columns>1?t.Columns:1)),Math.max(Math.ceil(n.screen().height*.45/ia()),3));c?(s=u.find("fieldset"),s.find(":checkbox,:input").off().checkboxradio("destroy"),s.controlgroup("destroy"),u.empty()):u=$('<div class="app-container-scrollable"><\/div>').attr("data-columns",t.Columns);$(h).each(function(n){n%p==0&&(e=$('<fieldset class="app-controlgroup-vertical"/>').appendTo(u),l.push(e));var r=this,i=r[0],s=$("<input/>").attr({id:o+n,type:f?"checkbox":"radio"}).appendTo(e),h=$("<label/>").attr("for",o+n).appendTo(e).text(r[1]);f||s.attr("name",o);t.HtmlEncode||h.html(r[1]);f&&(i=i!=null?i.toString():"");(f&&v.indexOf(i)!=-1||!f&&i==a)&&s.attr("checked","true")});c?h.length||u.text(y.NullValueInForms):u.insertBefore(i).data("data-field",t);$(l).controlgroup().find(":checkbox,:radio").checkboxradio();u.find(":checkbox,:radio").on("click",pa)}function ge(t,i){t.find(".app-container-scrollable").each(function(){var f=0,e=0,r=$(this),o=parseInt(r.attr("data-columns")),t=r.find("fieldset");if(i){var s=t.find(":input"),c=Math.min(Math.ceil(s.length/(o>1?o:1)),Math.max(Math.ceil(n.screen().height*.45/ia()),3)),u,h=[];t.find(":checkbox,:input").off().checkboxradio("destroy");t.controlgroup("destroy");s.each(function(n){n%c==0&&(u=$('<fieldset class="app-controlgroup-vertical"/>').appendTo(r),h.push(u));var t=$(this),i=t.prev();i.appendTo(u);t.appendTo(u)});t.remove();t=$(h).controlgroup().find(":checkbox,:radio").checkboxradio();r.find(":checkbox,:radio").on("click",pa)}i||t.each(function(){$(this).height("").find(".ui-checkbox,.ui-radio").width("")});t.each(function(){var n=$(this),t=n.width(),i=n.height();t>f&&(f=t);i>e&&(e=i)});t.each(function(){$(this).height(e).find(".ui-checkbox,.ui-radio").width(f+1)})})}function sf(n){var i=!0,t;if(n)setTimeout(function(){sf()},5);else try{s.getSelection?(t=s.getSelection(),t&&t.rangeCount>0&&t.removeAllRanges()):document.selection&&document.selection.empty()}catch(r){i=!1}return i}function no(t){var r=n._menuStrip,i=r&&r.strip;i&&(i.hide(),arguments.length==1&&i.attr("data-enabled",t?"true":"false"))}function ub(n,t){t=="Cards"?n.addClass("app-cardview").removeClass("app-grid app-onecolumnview"):t=="Grid"?n.addClass("app-grid").removeClass("app-cardview app-onecolumnview"):t=="List"&&n.addClass("app-onecolumnview").removeClass("app-cardview app-grid")}function su(n,t,i){var r=$app.find(n);er(r);ut();r.extension().viewStyle(t,i);kl(n);g(!0);g(!1,10)}function ih(n,t){if(t.instruction){var i=n.find("> .app-presenter-instruction"),r=t.instruction();i.length||(i=$('<div class="app-presenter-instruction"><\/div>').appendTo(n).hide());r?(i.show(),i.html(r)):i.hide();ba(t.dataView(),n.closest(".ui-page"),!1,!0)}}function ba(n,t,i,r){var e=n.extension(),f,u;e._instructed||n._totalRowCount==-1||(f=e.instruction(),u=tf(t),f||i?(u.empty(),e._instructed=!0,u.length||(u=$('<span class="dv-heading"/>').appendTo(t).hide()),f&&$('<span class="app-view-instruction"/>').appendTo(u).html(f.replace(/<a.*?<\/a>/gi,"")),u.attr("data-selector",r?".app-presenter-instruction:visible":"ul.app-listview li.app-list-instruction"),i&&kh(n,u),ui(),n.get_groupExpression()&&$(document).trigger($.Event("scrollstop.app",{relatedTarget:t.find(".app-wrapper")}))):u.remove())}function fb(){$('div[data-role="presenter"]').addClass("app-stale");rh()}function rh(t){function i(i){var u=i.attr("data-presenter"),r=n.dataView();!i.closest(".app-echo-inner").length&&r&&i.css("display")!="none"&&n.presenter("show",{name:u,id:r._id,container:t||i.closest(".app-wrapper")})}t?(t.find('div[data-role="presenter"]').each(function(){i($(this))}),$('.ui-page:not(.ui-page-active) div[data-role="presenter"]').each(function(){var n=$(this);n.closest(".app-echo-inner").length||n.addClass("app-stale")})):$('div[data-role="presenter"].app-stale').each(function(){var n=$(this);n.removeClass("app-stale");i(n)})}function ka(n){n.find("> .app-map").each(function(){var i=$(this),u=n.find("> .app-page-header:visible"),f=n.find("> .app-presenter-instruction:visible"),r=$(f.length&&f||u.length&&u),e=i.data("data-map"),t,o;i.css("top",r.length?r.position().top+r.outerHeight(!0):0);i.is(":visible")&&e&&(t=e.map,o=t.getCenter(),google.maps.event.trigger(t,"resize"),t.setCenter(o))})}function uh(n){n.css({display:"block","z-index":-10});ii(n);n.css({display:"","z-index":""})}function ii(n){var f=i.activePage;n||(n=f);var e=n.attr("id")==f.attr("id"),o=e?n:f,r=o.css("padding-top"),t=o.css("min-height"),a=n.find(".ui-content > .app-bar-header,.ui-content > .app-bar-actions,.ui-content > .app-tabs"),v=n.find(".ui-content > .app-bar-footer"),s=du&&n.find(du.fixedTop.selector),h=s&&s.css("position")=="fixed"&&s.outerHeight(),c=du&&n.find(du.fixedBottom.selector),l=c&&c.css("position")=="fixed"&&c.outerHeight(),u=0;e?(i.resetActivePageHeight(),t=o.css("min-height")):n.css({"padding-top":r,"min-height":t});t=parseInt(t.substring(0,t.length-2));r=parseInt(r.substring(0,r.length-2));n.find(".app-wrapper").each(function(){var i=$(this),n=0;a.each(function(){var t=$(this);t.css("display")!="none"&&(n+=t.outerHeight(!0))});v.each(function(){var n=$(this);n.css("display")!="none"&&(u+=n.outerHeight(!0))});n&&(t=t-n,r=r+n);h&&(t-=h,r+=h);l&&(t-=l,u+=l);u&&(u-=2);i.css({top:r,bottom:u,"min-height":t-u});e&&i.css({height:t-u});ka(i)})}function eb(){return si?o.width()>=720:o.width()>=768&&o.height()>=704}function ob(){function b(n){return n&&n.match(/Landscape|Always|Never/)}var c=p.mobileDisplayDensity,o=Sys.Browser,a,s,v,e=$("#PageHeader").parent(),n=u.attr("data-theme")||(e.attr("class")||"").match(/\bpage-theme-(\w+)\b/i),h=$("div[data-content-framework]").first(),y=l("buttonShapes"),w=l("promoteActions");typeof n=="string"&&(n=[0,n]);e.length||(e=u);r={mapApiIdentifier:p.mapApiIdentifier,pageTransition:l("pageTransition")||p.transitions||(nu?"fade":f()?"none":"slide"),sidebar:l("sidebar")||b(p.sidebar)||"Landscape",theme:n&&n[1]||l("theme")||p.theme,themeDisabled:n!=null,displayDensity:l("displayDensity")||(f()?p.desktopDisplayDensity:c=="Auto"?eb()?"Compact":"Comfortable":c),labelsInForm:l("labelsInForm")||p.labelsInForm,labelsInList:l("labelsInList")||p.labelsInList,buttonShapes:y!=null?y:p.buttonShapes,promoteActions:w!=null?w:p.promoteActions,initialListMode:l("initialListMode")||p.initialListMode||"SeeAll"};o.agent==o.InternetExplorer&&o.version<=9&&(u.hide(),p&&p.ui?(a=(new Date).getDate()+365,s=new Date,s.setDate(a),v=String.format("appfactorytouchui=false; expires={0}; path=/",s.toUTCString()),document.cookie=v,location.reload(i.path.parseUrl(location.href).hrefNoHash)):alert(t.TouchUINotSupported));ht&&(u.addClass("app-ios"),gf<8&&u.addClass("app-ios7"));nu&&u.addClass("app-android");r.buttonShapes==!1&&u.addClass("app-buttons-text-only");e.is(".Tall")&&u.addClass("app-page-header-hidden");(e.is(".Wide")||h.length&&h.attr("data-sidebar")!="true"||!h.length&&$('div[data-app-role="page"]').first().attr("data-sidebar")=="false")&&(r.sidebar="Never",r.sidebarDisabled=!0);$(document).trigger($.Event("init.app"));i.defaultPageTransition=r.pageTransition;ps();r.displayDensity||(r.displayDensity=f()?"Compact":"Comfortable");u.addClass(ic(r.theme));u.addClass(rc(r.displayDensity));r.labelsInForm=="AlignedRight"&&u.addClass("app-labelsinform-alignedright");r.labelsInList=="DisplayedAbove"&&u.addClass("app-labelsinlist-displayedabove");f()&&($.datepicker.setDefaults({prevText:"",nextText:"",monthNames:bi.MonthNames,monthNamesShort:bi.AbbreviatedMonthNames,dayNames:bi.DayNames,dayNamesShort:bi.AbbreviatedDayNames,dayNamesMin:bi.ShortestDayNames,firstDay:bi.FirstDayOfWeek,constrainInput:!1,showOtherMonths:!0,changeMonth:!0,changeYear:!0}),$.datepicker.parseDate=function(n,t){var i=$(this._lastInput).attr("data-format-string")||"{0:d}";return Date.tryParseFuzzyDate(t,i)},$.datepicker.formatDate=function(n,t){var r=$(this._lastInput),u=r.attr("data-format-string")||"{0:d}",i=Date.tryParseFuzzyDate(r.val(),u);return i&&(t.setHours(i.getHours()),t.setMinutes(i.getMinutes()),t.setSeconds(i.getSeconds())),String.localeFormat(u,t)})}function fh(n,t,i){if(ts!=!1&&!b&&(t=t||n.find(".ui-collapsible").filter(uu).find(".ui-collapsible-heading").filter(function(){return!$(this).is(".ui-collapsible-heading-collapsed")}).first().parent().find(":input").first(),t.length)){var r=t.closest(".app-wrapper"),c=r.offset().top,u=r.scrollTop(),o=r.height(),e=t.offset().top+u-c,s=t.outerHeight(!0);function h(){f()&&!i&&(ui(),t.focus(),t[0].select&&t[0].select())}e<u||e+s>u+o?(b=!0,vr(r,e-(o-s)/2,function(){b=!1;h();i&&i()})):(h(),i&&i())}}function da(n){return(n.metaKey||n.ctrlKey)&&n.shiftKey}function sb(n){var i=!1,t;return n.is("span")&&n.get(0).scrollWidth-n.innerWidth()>0&&(t=$('<div class="ui-content app-popup-message"/>').html(n.text()).popup({history:!1,arrow:"b,t",overlayTheme:"b",positionTo:"origin",afteropen:function(){},afterclose:function(){au(t)}}).popupopen({x:n.offset().left+n.outerWidth()/2,y:n.offset().top}).on("vclick",function(){return vt(t),!1}),i=!0),i}function tr(t){n.tabs("fit",{page:t})}function hf(n){n=$(n);n.find(".app-wrapper").each(function(){var n=$(this),t=n.data("scroll-top");t&&n.scrollTop()!=t&&yi(n,t)});n.find(".app-echo-inner").each(function(){var n=$(this),t=n.data("scroll-left");n.parent().is(":visible")&&t&&n.scrollLeft()!=t&&n.scrollLeft(t)});ty(n)}function eh(n){$(n).find(".app-wrapper").each(function(){var n=$(this);n.data("scroll-top",n.scrollTop())});$(n).find(".app-echo-inner").each(function(){var n=$(this);n.parent().is(":visible")&&n.data("scroll-left",n.scrollLeft())})}function ga(n){var t=n.scrollTop();return{top:t*-1,height:n.height()+t,maxHeight:n[0].scrollHeight}}function to(n){var t=n.find(".ui-panel-inner"),i,r,u;if(t.length)t.on("scroll keydown keyup",function(){b||i||(i=!0,r=t.scrollTop(),ci=!0,u=setInterval(function(){var n=t.scrollTop();n!=r?r=n:(clearInterval(u),i=!1,ci=!1,t.data("scroll-stop-time",new Date))},200))})}function hb(n){wrapper=n.find(".ui-panel-inner").off("scroll keydown keyup")}function oh(n,t){function a(n){i.data("scroll-dir",n);$(document).trigger($.Event("scrolldir.app",{relatedTarget:i}))}var i=n.find(".app-wrapper").first(),o,s,u,r,h,c,l,e;if(!i.length){if(o=n.find(".ui-content"),s=o.contents(),i=$('<div class="app-wrapper"/>').appendTo(o),t!=!1)i.on("wheel DOMMouseWheel mousewheel",function(n){if(u&&"deltaY"in n.originalEvent){var r=i.data("scroll-dir"),t=n.originalEvent.deltaY>0?"down":"up";t!=r&&a(t)}}).on("touchstart",function(){ht&&gf<8&&(e=!1,li=!0)}).on("touchmove",function(){ht&&(c=fu(),l=i.scrollTop())}).on("touchend",function(){if(ht&&gf<8){var t=fu()-c,n=i.scrollTop(),r=Math.abs(l-n);t>0&&r/t>.25||n<0||n>i.height()?e=!0:li=!1}}).on("scroll",function(){if(!b&&!i.data("scrolling"))if(u){var f=i.data("scroll-dir"),n=i.scrollTop(),t=n<r?"up":n==r?"none":"down";t!=f&&a(t)}else u=!0,r=i.scrollTop(),$(document).trigger($.Event("scrollstart.app",{relatedTarget:i})),ci=!0,h=setInterval(function(){var n=i.scrollTop();n!=r?r=n:(clearInterval(h),u=!1,ci=!1,i.data("scroll-stop-time",new Date),$(document).trigger($.Event("scrollstop.app",{relatedTarget:i})),e&&(e=!1,li=!1))},200)});f()&&i.attr("tabindex",0);$('<div class="app-page-header"><h2/><h1/><\/div>').appendTo(i);s.appendTo(i)}return i}function h(t){n.activeLink(t)}function sh(n){h(n);setTimeout(function(){h()},200)}function e(n,t){t||(t=function(){});n=$(n);var i=n.attr("class");i&&i.match(/\bapp-btn-/)?(n.addClass("ui-btn-active"),setTimeout(function(){n.removeClass("ui-btn-active");fs="link";setTimeout(function(){t(n)},50)},bt)):(h(n),setTimeout(function(){h();fs="link";n&&n.is(".app-btn")&&(fs="toolbar");setTimeout(function(){t(n)},50)},bt))}function nv(n,t){if(t||(t=n.find(".app-stub,.app-stub-main")),t.length){var i=Math.ceil(t.offset().top),r=Math.ceil(n.offset().top),u=n.height();i>r&&(i>r+u?t.height(""):t.height(u-(i-r)))}}function io(){ut();n.promo(!1);u.find("> *").hide()}function hh(){ti&&ti._updateLastActivity()}function ch(){tf().removeClass("app-disabled")}function hu(){return ns||(ns=$("#app-sidebar")),ns}function lh(){return hu().is(":visible")}function ah(n){ce&&(clearTimeout(ce),ce=null);n&&(le=null)}function vh(t){return he?!0:n.causesCalculate()?(he=setInterval(function(){n.causesCalculate()||(clearInterval(he),he=null,t())},100),!0):!1}function dt(n,t){n&&(vh(function(){dt(n,t)})||(we(),n.callback?n.callback(n.context,t):n.href&&(s.location.href=n.href)))}function cf(n){var t=i.activePage;t&&t.find(".dv-load-at-top").css("visibility",n?"hidden":"");b=n}function w(){var n=i.activePage;return n?n.attr("id"):"_"}function ro(){return w()=="Main"}function gt(){return w()=="advanced-search"}function tv(n){return n?n.toJSON().slice(0,10):null}function iv(n){return n?new Date(n.getTime()-n.getTimezoneOffset()*6e4).toJSON().slice(0,19):null}function cb(n){return n?rv(n+"T00:00:00"):null}function rv(n){var t=n?new Date(n.substring(0,4),parseInt(n.substring(5,7))-1,n.substring(8,10),n.substring(11,13),n.substring(14,16),0,0):null;return t!=null&&(t=new Date(t.getTime()-t.getTimezoneOffset()*6e4)),t}function yh(n,t){return"rg_"+n._id+"_v_"+n._viewId+(n._groupExpression?"_g_"+n._groupExpression.replace(/\W/g,"_"):"")+"_f_"+t.Name}function lf(n){return"rg_"+n._id+"_v_"+n._viewId+(n._groupExpression?"_g_"+n._groupExpression.replace(/\W/g,"_"):"")+"_scroll_"}function lb(n){var t=n.Columns;return t==0&&n.Type=="String"&&(t=n.Len),n.ItemsStyle=="CheckBoxList"?t=80:t>80?t=80:t||(n.Type=="String"?(t=30,n.Len>0&&n.Len<t&&(t=n.Len)):t=15),n.Type.match(/^Date/)&&t<18&&(t=18),t}function ir(t){var f=ls(),r=1;$(t||i.activePage.find(".app-listview")).each(function(){var c=$(this),b=c.parent(),tt=c.closest(".ui-page"),et,wt="w"+Math.ceil((o.width()-(lh()?hu().outerWidth():0))/f/r)*r,e=vl[wt],ot,l,a,bt,st,it,ht=c.data("data-yardstick-class"),h=u.find("#app-yardstick"),kt=c.is(".app-grid"),ct=b.is(".app-echo-inner"),ui=ct||b.is(".app-map-info"),v,y,pt,gt;if(e||(h.length||(h=$('<ul id="app-yardstick" class="app-listview"><li class="dv-item"><a><span>1<\/span><\/a><\/li><li><a class="dv-item">2<\/a><\/li><li><a class="dv-item">3<\/a><\/li><\/ul>').appendTo(u).listview()),ct&&kt&&(b=b.closest(".app-wrapper")),h.addClass("app-onecolumnview").appendTo(b).show(),ot=h.find("li").first(),et=tt.css("display"),et!="block"&&tt.css("display","block"),a=ot.outerWidth(),h.toggleClass("app-onecolumnview  app-cardview"),l=ot.outerWidth(),h.toggleClass("app-cardview app-grid"),bt=firstSpanPadding=h.find("span").first(),st=parseInt(bt.css("margin-left")),ei.gridColumnPadding=st,h.removeClass("app-grid"),et!="block"&&tt.css("display",""),h.appendTo(u).hide(),v="xl",a<480?v="tn":a<640?v="xxs":a<768?v="xs":a<992?v="sm":a<1199?v="md":a<1440&&(v="lg"),y="xl",l<480?y="tn":l<640?y="xxs":l<768?y="xs":l<992?y="sm":l<1199?y="md":l<1440&&(y="lg"),e={listBreakpoint:v,cardBreakpoint:y,card:Math.ceil(l/f/r)*r,list:Math.ceil(a/f/r)*r,columnPadding:st,grid:{}},vl[wt]=e),it="app-listitem-"+(c.is(".app-cardview")?e.cardBreakpoint:e.listBreakpoint),it!=ht&&(ht&&c.removeClass(ht),c.addClass("app-yardstick "+it).data("data-yardstick-class",it)),kt){var rt=n.pageInfo(ct?c.closest(".app-echo").attr("data-for"):tt.attr("id")),t=rt.dataView,k=t.session("grid-style"),ni=rt?rt.id+"_"+rt.dataView._viewId+(t._groupExpression?"_g_"+t._groupExpression:""):null;if(!k||t.session("grid-style-changed")){t.session("grid-style-changed",null);e.grid[ni]=!0;var ti=t._fields,fi=gy(t),ii=t._allFields,s=[],lt,p=0,i=e.list*f,at=t.get_showMultipleSelection(),vt=(ls()==12?6:5)*f+e.columnPadding,w,yt=new Sys.StringBuilder,ri=0;$(ti).each(function(){var i=this,n=ii[this.AliasIndex],r;i.Hidden||n.GroupBy||i.OnDemand||(lt=lb(n),r=!0,r&&(ri++,p+=lt),s.push({name:n.Name,className:yh(t,n),cols:lt,type:n.Type,hidden:!1}))});t&&(pt=t.session("grid-avail-width"),pt!=null?i=pt:(i>992?i=992:(s.length>=6?i=768:s.length>=4?i=640:s.length>=2&&(i=480),i-=ei.width*2),i=i/(s.length<8?s.length:8)*s.length,t.session("grid-avail-width",i)));var d,dt=Math.floor(vt/i*p),g,ut=t._hasKey(),nt=0,ft=pe(t);$(s).each(function(){var n=this,t,h=n.cols,f,u,e,o,c,r;if(!n.hidden&&(d||(d=n,g=Math.floor((vt+(ut?22:0)+(ut&&at?54:0))/i*p),g>n.cols&&(p+=g-n.cols,n.cols=g)),h/p*i<vt)){for(f=dt,u=0,o=s.length-1;o>=0;)if(t=s[o--],!t.hidden&&(r=f-h,e=t==d?g:dt,t.cols-r<e&&(r=t.cols-e),r>0&&(t.cols-=r,u+=r,c=!0,u+n.cols>=f)))break;c&&(n.cols+=u)}});$(s).each(function(){w=this;var n=Math.ceil((w.cols/p-e.columnPadding/i-(w==d&&ut?22/i:0)-(w==d&&at?(22+e.columnPadding)/i:0))*i);ft!="_none_"&&(nt+=n+e.columnPadding,(ft==w.name||ft=="_first_")&&(ft="_none_"));yt.appendFormat(".{1} {{width:{2}px;max-width:{2}px}}",e.list,w.className,n);yt.appendLine()});gt=yt.toString();k||(k=hs(),t.session("grid-style",k));k.text(gt);nt&&(nt+=4);t.session("grid-frozen-width",Math.ceil(nt+(ut?26:0))+(at?22+(nt>0?e.columnPadding:4):0))}}})}function ab(){var r=n.pageInfo(),t,i;r&&(t=r.dataView,i=t&&t.extension(),i&&t.get_isGrid()&&(rw=!0,i.executeInContext("Eye",null,!1)))}function et(t){var i=n._menuButton;if(arguments.length==0)return i.is("."+kr);i&&n.toolbar().is(":visible")&&(t=="off"?i.removeClass(kr):t?i.addClass(kr):setTimeout(function(){i.removeClass(kr)},500))}function rr(){et(!0);o.one("beforeunload pagehide",function(){et(!1)})}function uv(){}function fv(){var i=n._menuButton,r,u;i&&n.toolbar().is(":visible")&&(r=n.toolbar(),u=w(),u=="Main"||n._pages.length&&u==n._pages[0].id&&n._pages[0].home?(i.removeClass("ui-icon-back ui-icon-bars "+kr).addClass("ui-icon-bars").attr({href:"#app-btn-menu",title:t.Menu}),r.removeClass("app-has-history")):(i.removeClass("ui-icon-bars "+kr).addClass("ui-icon-back").attr({href:"#app-back",title:t.Back}),r.addClass("app-has-history")))}function ph(n){n.length&&(al[w()+"_"+n.attr("id")]=n.find(".ui-panel-inner").scrollTop())}function vb(n){n.length&&n.find(".ui-panel-inner").scrollTop(al[w()+"_"+n.attr("id")]||0)}function wh(n){var t=$(n.target).closest(".ui-btn,.app-grid-header").find(".app-btn-check");return t.length>0&&(tt&&tt.x||n.pageX)<=t.offset().left+t.outerWidth()+8}function ev(n,t){var u,i,f=tt&&tt.x||n.clientX,e=tt&&tt.y||n.clientY,o=$(n.target).closest(".ui-btn").find(".app-action-column"),r;return o.length&&o.find(".app-action-column-button").each(function(){var n=$(this),o=n.offset();if(f>=o.left-4&&f<=o.left+n.outerWidth()+3&&e>=o.top-6&&e<=o.top+n.outerHeight()+4)return u=!0,n.addClass("ui-btn-active"),setTimeout(function(){n.removeClass("ui-btn-active");i=n.closest(".app-echo");dh(i);uo(t).removeClass("app-selected");r=n.closest(".ui-btn");t.extension().tap(r.data("data-context"),"none");i.length&&r.addClass("app-selected");var u=[],f=n.attr("data-action-path");bf("ActionColumn",t,u,t.extension().commandRow());$(u).each(function(){var n=this;if(n.path==f)return dt(n,r),!1});i.length?uf(t,i):kl(t._id)},bt),!1}),u}function ov(n){var t=$(n.target).closest(".ui-btn").find(".app-btn-more"),i=tt&&tt.x||n.clientX,r=tt&&tt.y||n.clientY;return t.length>0&&t.offset().left-8<=i&&i<=t.offset().left+t.outerWidth(!0)+8&&t.offset().top-8<=r&&r<=t.offset().top+t.outerHeight(!0)+8}function sv(n){return n.closest(".ui-btn").find(".app-btn-more")}function af(n){return String.format("app-style-dv-{0} app-style-c-{1} app-style-cv-{1}-{2}",n._id,n._controller,n._viewId)}function uo(n){return $("#"+n._id).find('ul[data-role="listview"] li a')}function ur(n){$(arguments).each(function(t){t&&(n?$(this).addClass("app-btn-check-selected"):$(this).removeClass("app-btn-check-selected"))})}function bh(n){n.is(".app-cardcolumn")&&(n=n.parent());n.find("a.app-selected").removeClass("app-selected")}function yb(t){var r=t._selectedKeyList,f=r.length==0,u=i.activePage.find(".app-wrapper .app-style-dv-"+t._id),e=u.closest(".app-echo"),o=u.find(".dv-item .app-btn-check"),c=u.closest(".ui-page").find(".app-grid-header .app-btn-check, .dv-heading .app-btn-check"),l=n.stickyHeaderBar().find(".app-grid-header .app-btn-check"),s,h;if(f&&t._totalRowCount>es){$app.alert(String.format(ct.Presenters.Charts.DataWarning,es),function(){e.length&&n.contextScope(t._id);pr({mode:"everything"});n.contextScope(null)});return}if(r.splice(0,r.length),ur(f,o,c,l),o.length&&!t.extension().commandRow()&&(h=$(o[0]).closest(".ui-btn"),t.extension().tap(h.data("data-context"),"none"),e.length&&h.addClass("app-selected")),f)if(t._keyFields.length==1&&u.find(".dv-load-at-top,.dv-load-at-bottom,.dv-action-see-all").length){if(t._busy())return;s=t._createArgsForListOfValues(t._keyFields[0].Name);s.request.MaximumValueCount=es;t._invoke("GetListOfValues",s,function(n){t._busy(!1);$(n).each(function(){r.push(this.toString())})})}else u.find(".dv-item .ui-btn:not(.app-calculated)").each(function(){r.push(t._createRowKey($(this).data("data-context").row))});e.length?ur(f,n.page(t._id).find(".app-wrapper .app-listview .app-btn-check, .dv-heading .app-btn-check")):n.pageInfo(t._id).echoChanged=!0}function hv(t,i){function v(){return u.closest(".ui-page").find(".app-grid-header .app-btn-check, .dv-heading .app-btn-check")}var o=i.find(".app-btn-check"),s=i.data("data-context"),r=t._selectedKeyList,h=r.length,c=t._createRowKey(s.row),e=r.indexOf(c),u=i.closest(".ui-listview"),l=u.closest(".app-echo"),a,y=n.stickyHeaderBar().find(".app-grid-header .app-btn-check"),f;a=v();e!=-1?(r.splice(e,1),ur(!1,o)):(r.push(c),ur(!0,o),bh(u),t.extension().tap(s,"none"),l.length?i.addClass("app-selected"):n.pageInfo(t._id).echoChanged=!0);ur(r.length,a,y);l.length&&(u=n.page(t._id).find(".app-wrapper .app-listview"),u.length&&(f=i.data("data-context"),u.find(".ui-btn").each(function(){var n=$(this),i=n.data("data-context"),o=0;if(f&&($(t._keyFields).each(function(){var n=t.findField(this.Name);f.row&&i&&i.row&&f.row[n.Index]==i.row[n.Index]&&o++}),o==t._keyFields.length))return checkBox=n.find(".app-btn-check"),e!=-1?ur(!1,checkBox):(bh(u),ur(!0,checkBox),n.addClass("app-selected")),ur(r.length,v()),!1})));t.set_selectedValue(r.join(";"));(!h&&r.length||h&&!r.length)&&g()}function kh(n,i){var c=n._fields,l=n._allFields,s=!0,u=$('<div class="app-grid-header"/>').appendTo(i),h=lf(n),r=pe(n),o=r=="_none_",a=0,e;n.get_showMultipleSelection()&&(e=$('<span class="app-btn-check"><\/span>').appendTo(u).attr("title",t.LookupSelectAction),$(vi).appendTo(e),n._selectedKeyList.length&&e.addClass("app-btn-check-selected"));(r!="_none_"||e)&&$('<span class="app-frozen-spacer '+h+'frozen_"/>').appendTo(u);$(c).each(function(){var c=this,t=l[c.AliasIndex],i,e,y,v,p,w;c.Hidden||t.GroupBy||c.OnDemand||(i=$("<span/>").addClass(yh(n,t)).text(t.HeaderText).attr("title",t.HeaderText).attr("data-field-name",t.Name).appendTo(u),t.Type.match(rl)?i.addClass("app-field-type-numeric"):t.Type=="Boolean"&&i.addClass("app-field-type-bool"),e=or(n,t.Name),y=n.get_fieldFilter(t,!0),e&&$('<span class="glyphicon"/>').appendTo(i).addClass("app-icon glyphicon-"+(e.match(/^asc/i)?"sort-by-attributes":"sort-by-attributes-alt")).attr("title",sr(t,e)),y&&(w=$('<span class="app-icon glyphicon glyphicon-filter"><\/span>').appendTo(i),$(n._filter).each(function(){var n=this;if(n.startsWith(t.Name+":"))return v=n,!1}),v&&f()&&(p=n._filter,n._filter=[v],w.attr("title",n.extension().filterStatus(!0)),n._filter=p)),s&&(s=!1,ks(n,u)),r!="_none_"?(i.addClass("app-frozen"),(t.Name==r||r=="_first_")&&(o=!0,r="_none_")):o&&(i.addClass(h+" app-scroll"),o=!1),a++)})}function cv(n,i,r,u){if(n.get_showMultipleSelection()){var f=$('<span class="app-btn-check"><\/span>').appendTo(u).attr("title",t.LookupSelectAction),e;$(vi).appendTo(f);r||(e=n._createRowKey(i),n._selectedKeyList.indexOf(e)!=-1&&f.addClass("app-btn-check-selected"))}}function fo(n,t){var i=n.HyperlinkFormatString,r;return i&&(r=n._dataView._parseLocation(i,t)),r}function vf(n,t,i,r,u){var h=n._fields,c=n._allFields,s=lf(n),e,f=pe(n),o=f=="_none_",l=0;(f!="_none_"||n.get_showMultipleSelection())&&$('<span class="app-frozen-spacer '+s+'frozen_"/>').appendTo(r);cv(n,t,u,r);$(h).each(function(h){var p=this,a=c[p.AliasIndex],k=a.itemColumnClass||yh(n,a),v,y,b,d,w=p.Items;p.Hidden||a.GroupBy||p.OnDemand||(v=$("<span><\/span>").appendTo(r).addClass(k+" app-field app-field-"+a.Name),a.itemColumnClass||(a.itemColumnClass=k),originalValue=y=t[u?p.Index:a.Index],y==null?(d=!0,v.addClass("app-null")):b=fo(p,t),y=a.text(y,a.TextMode!=3),h==0&&ks(n,r,f!="_none_"),a.Type.match(rl)&&v.addClass("app-field-type-numeric"),u?(e=u?u[h]:null,e&&(y=t[p.Index],y=String.localeFormat(p.DataFormatString||"{0:n0}",y),v.text(y),$('<div class="app-static-text"><\/div>').text(e).insertBefore(v.contents()),v.attr("title",a.HeaderText+"\n"+e+" "+y))):(a.Type=="Boolean"?(v.addClass("app-field-type-bool"),!d&&w&&w.length>=2&&w[w.length-1][1]==y?$('<span class="app-icon glyphicon glyphicon-check"/>').appendTo(v):v.html("&nbsp;")):bs(a,y,v,!0),v.attr("title",a.HeaderText+":\n"+y),b&&v.attr("data-href",b)),h==0&&i!=null&&$('<span class="app-item-number"/>').insertBefore(v.contents()).text(i+"."),f!="_none_"?(v.addClass("app-frozen"),(a.Name==f||f=="_first_")&&(o=!0,f="_none_")):o&&(v.addClass(s),o=!1),l++)})}function ar(n,t,i,f,e,o,s){var v=n._allFields,tt=o.is("a"),y=$("<h3>").appendTo(o),d=v[i.heading],h,a,p,w,b;if(tt&&cv(n,t,null,o),i.thumb!=null)if(h=t[i.thumb],h&&h.toString().match(/^null/))e.addClass("ui-li-has-thumb");else var at=n.resolveClientUrl(n.get_appRootPath()),ot=v[i.thumb],pt=$('<img class="ui-li-thumb"/>').appendTo(o).attr({src:String.format("{0}blob.ashx?{1}=t|{2}{3}",at,ot.OnDemandHandler,h,ot.OnDemandStyle==2?"&_nocrop":"")});if(h=t[i.heading],h=d.text(h),tt&&o.attr("title",h),d.HtmlEncode?y.text(h):y.html(h),y.addClass("app-field app-field-"+d.Name).attr("title",d.HeaderText+":\n"+y.text()),f&&$('<span class="app-item-number"/>').insertBefore(y.contents()).text(f+". "),y.contents().wrap('<span class="app-field-data"/>'),i.desc.length){var g=$('<p class="app-para"/>').appendTo(o),k=g,c,st=1,it;$(i.desc).each(function(n){var y=this,l=v[y],nt=i.descLabels[n],tt=i.descPara[n],rt=i.descColumn[n],p,a,d=l.HeaderText,u,w,b;tt&&(k.is(".app-para")||(g=$('<p class="app-para"/>').appendTo(o),c||g.insertAfter(k),k=g,st++),c=null);rt&&(c||e.addClass("app-has-column"),c=$('<span class="app-column"/>').appendTo(o).addClass(c?"":"app-column-first"),p=100/i.descColumnCount+"%",c.css({minWidth:p,maxWidth:p}));h=t[y];w=h==null;u=$('<span class="app-item-desc"/>').insertAfter(k).addClass("app-field app-field-"+l.Name);c&&u.appendTo(c);k=u;h=l.text(h);s?(it=$('<span class="app-field-data"/>').appendTo(u),bs(l,h,it)):l.HtmlEncode||l.TextMode==3?u.text(h):u.html(h);s&&y==i.heading&&(u.addClass("app-item-heading"),f&&$('<span class="app-item-number"/>').insertBefore(it.contents()).text(f+". "));a=u.contents();u.attr("title",l.HeaderText+":\n"+u.text());w||(i.descOriginal[n]!=null&&(l=v[i.descOriginal[n]]),b=fo(l,t),b&&(a=a.wrap("<span/>").parent().attr("data-href",b)));nt!=null&&((r.labelsInList=="DisplayedAbove"||s)&&$('<span class="app-field-label-before"/>').insertBefore(a.first()).text(d),r.labelsInList=="DisplayedBelow"&&$('<span class="app-field-label-after"/>').insertAfter(a.last()).text(d));w?a.wrap('<span class="app-null"/>'):s||a.wrap('<span class="app-field-data"/>')});st>1&&e.addClass("app-para-multi")}if(tt){var rt=n.extension(),vt=rt._commandRow,ut,ht=n.get_actionGroups("ActionColumn",!0),yt=0,ct=ls();if(ht.length){ut=$('<span class="app-action-column"/>').appendTo(o);var ft=pi(o.css("padding-left")),et=ht[0],lt=et.groupText,l=et.groupTextMaxWidth,nt;lt&&!l&&(l=0,nt=$('<span class="app-action-column"><span class="app-action-column-button"/><\/span>').appendTo(u).find("span"),$(lt).each(function(){nt.text(this);l=Math.max(l,nt.outerWidth())}),nt.parent().remove(),et.groupTextMaxWidth=l);ut.css({left:ft,maxWidth:l});ft+=l+ct;o.css("padding-left",ft/ct+"em");rt._commandRow=t;$(n.actionGroups("ActionColumn")).each(function(){$(this.Actions).each(function(){var n=this;yt++;$('<span class="app-action-column-button"/>').appendTo(ut).text(n.HeaderText).attr({title:n.Description||n.HeaderText,"data-action-scope":"ActionColumn","data-action-path":n.Path})})});rt._commandRow=vt}i.aside!=null&&(e.addClass("app-li-has-aside"),a=$('<p class="ui-li-aside"/>').appendTo(o),p=v[i.aside],h=t[i.aside],h=p.text(h),p.HtmlEncode?a.text(h):a.html(h),a.addClass("app-field app-field-"+p.Name).attr("title",p.HeaderText+":\n"+a.text()),i.asideLabel&&$('<span class="app-field-label"/>').insertBefore(a.contents()).text(p.HeaderText));i.count!=null&&(a==null||i.desc.length)&&(w=$('<span class="ui-li-count"/>').appendTo(o),b=v[i.count],h=t[i.count],h=b.text(h),b.HtmlEncode?w.text(h):w.html(h),w.addClass("app-field app-field-"+b.Name).attr("title",b.HeaderText+":\n"+w.text()),i.countLabel&&$('<span class="app-field-label"/>').insertBefore(w.contents()).text(b.HeaderText));ks(n,o)}}function pb(n,t,i){var h=".app-listview li a.app-selected,.app-wrapper .app-map",u=n._lookupInfo?n._id:n._parentDataViewId||n._id,r=$("#"+u).find(h),f,e=$app.find(u),s,o,c;return r.length||(r=$("#"+n._id+"_echo .app-echo-inner .app-selected"),u=n._id,e=n),r.length||(u=n._filterSource,r=$("#"+u).find(h),e=$app.find(u)),r.length&&(f=$('<li class="app-li-card">'),t&&f.appendTo(t),r.is(".app-selected")?(s=r.data("data-context"),s&&(o=s.row)):(c=r.data("data-map"),c&&(o=e.extension().commandRow())),o&&(ar(e,o,e.extension().itemMap(),null,f,f),i!=!1&&(contextDataView=$app.find(u),$('<span class="app-li-corner">').appendTo(f.addClass("app-li-has-corner")).text(contextDataView.get_view().Label)),r.parent().is(".app-li-has-aside")&&f.addClass("app-li-has-aside"))),f}function st(t,r){var f,u,e,s,h,o,c="";if(r)u=r.closest(".ui-page");else{if(u=i.activePage,!u)return;r=u.find(".app-page-header")}if(s=r.find("h1"),h=r.find("h2"),e=u.attr("data-page-header")!="false",typeof t=="boolean")t&&e?r.show():(r.hide(),u.attr("data-page-header","false"));else return f=r.data("data-text"),t?(f&&typeof f!="string"&&typeof t=="string"&&(f[1]=t,t=f),r.data("data-text",t)):t=f,t&&(typeof t=="string"?o=t:(o=t[0],c=t[1])),r.attr("data-locked")!="true"&&(s.text(o),h.text(c)),t!=n.title()&&e?r.show():(r.hide(),e&&u.attr("data-page-header","false")),t}function lv(n,t){rt();var i=Math.ceil(o.width()*.9);!t&&rf()?n.css({maxWidth:o.width()-1,minWidth:o.width()-1}):(i>800&&(i=800),n.css({maxWidth:i}))}function yf(t,i){i==null&&(i=ai);ai=null;var r=t.extension();r.useAdvancedSearch()?cu(t,i,i&&"none"):n.search("configure",{text:i||r.quickFind(),placeholder:ww(t),focus:!0,scope:t._id,setCursor:!!i})}function av(n){var t=$app.find($("#advanced-search").attr("data-scope"));gt()?(t.extension().useAdvancedSearch(!1),e(n,function(){u.one("pagecontainershow",function(){setTimeout(function(){yf(t)},200)});gi=null;history.go(-1)})):yf(t)}function cu(e,o,s){function rt(n,t,i,r){var f=i.SearchOptions,u=t.FilterType;return{field:t.Name,originalField:i.Name,id:n._id,mappedId:n._mappedId,filterField:n._mappedId&&n._filterFields[0],headerText:t.HeaderText,scopeText:n._mappedId&&n.get_view().Label,filterType:u,operation:f&&$app.filterDef(y.Filters[u].List,f[0])&&f[0]||(u=="Boolean"?"$true":u=="Text"?"$contains":"="),value:null,value2:null,values:[],required:r==!0}}function ut(n,t,i){var r=v(),f=r._fields,u=r._allFields;$(u).each(function(){var f=this,s=u[f.AliasIndex],e=f.Search,o=e==1&&n=="Required",h=e==2&&n==="Suggested",c=e==4,l=!n&&t.length<3||o||h;s.AllowQBE&&l&&!c&&(!f.Hidden||o||h)&&t.push(rt(r,s,f,o&&i==!0))})}function k(n,t){var l=t.find(".app-condition-list-field").text(n.headerText),i=n.operation,h=y.Filters[n.filterType],f=h.Kind.toLowerCase(),a=$app.filterDef(h.List,i),c=!i.match(tl),v=c&&i=="$between",o=t.find(".app-condition-list-operation"),r=t.find(".app-input-container").first(),p=r.find(".app-input-value"),w=r.find(".app-input-text"),s=r.next(),u=s.next(),b=u.find(".app-input-value"),k=u.find(".app-input-text"),e=t.find(".app-condition-list-values");n.scopeText&&$("<span/>").appendTo(l).text(n.scopeText);o.text(a.Text);i.match(/month/)?o.addClass("app-condition-list-operation-month"):o.removeClass("app-condition-list-operation-month");p.text(f);w.attr("placeholder",f);b.text(f);k.attr("placeholder",f);c?r.show():r.hide();v?(s.show(),u.show()):(s.hide(),u.hide());r.find(":input").val(n.value);u.find(":input").val(n.value2);i=="$in"||i=="$notin"?(e.show(),e.text(n.lovText||tw.SelectLink),e.addClass("app-has-children")):e.hide();t.data("condition",n)}function pt(n,i){var r=$('<li class="app-condition ui-body-a"><\/li>').appendTo(i),f,u;return f=$('<a class="app-condition-list-field app-btn-select ui-btn ui-corner-all ui-btn-inline"/>').appendTo(r),(!n.required||r.closest(".app-conditions").prev().length)&&f.addClass("app-has-children"),$('<a class="app-condition-list-operation app-btn-select ui-btn app-has-children ui-corner-all ui-btn-inline"/>').appendTo(r),u=$('<div class="app-input-container ui-first-child"><\/div>').appendTo(r),$('<input type="text" class="app-input-text"/>').appendTo(u),$('<span class="app-input-value"/>').appendTo(u).css("visibility","hidden"),$('<span class="app-condition-and"/>').appendTo(r).text(y.Filters.Labels.And),u=$('<div class="app-input-container ui-last-child"><\/div>').appendTo(r),$('<input type="text" class="app-input-text"/>').appendTo(u),$('<span class="app-input-value"/>').appendTo(u).css("visibility","hidden"),$('<a class="app-condition-list-values app-btn-select ui-btn ui-corner-all ui-btn-inline"/>').appendTo(r),$('<a class="ui-btn ui-btn-icon-notext app-btn-icon-transparent app-btn-more ui-btn-right"/>').appendTo(r).attr("title",t.More),k(n,r),r}function et(n,i){var r=$('<ul class="app-condition-list ui-body-a"/>').appendTo($('<div class="app-conditions"><\/div>').appendTo(h)).data("group",i),f=$('<li class="app-matching ui-body-a"><\/li>').appendTo(r),u;return $('<a class="app-condition-list-scope app-btn-select ui-btn app-has-children ui-corner-all ui-btn-inline"/>').appendTo(f).text(t[i.scope]),$('<a class="ui-btn ui-btn-icon-notext app-btn-icon-transparent app-btn-more ui-btn-right"/>').appendTo(f).attr("title",t.More),$(i.conditions).each(function(){pt(this,r)}),u=$('<li class="app-condition app-condition-more ui-body-a"><\/li>').appendTo(r),$('<a class="app-condition-list-field app-btn-select ui-btn ui-corner-all ui-btn-inline app-has-children"/>').appendTo(u).text(yt.AddConditionText),b(i).length||!c()&&ot().length||u.hide(),r.parent()}function wt(n,t,i){var r=r={scope:"MatchAll",required:!1},u=[],f=[];ut("Required",u,i);ut("Suggested",f);u.length?r.conditions=u.concat(f):f.length?r.conditions=f:(ut(null,u),r.conditions=u,t&&(n.push(r),r=JSON.parse(JSON.stringify(r)),r.scope="MatchAny"));n.push(r)}function b(n,t){function f(n,t){$(n._allFields).each(function(){var i=this,u=n._allFields[i.AliasIndex],f=i.Search,e=f==4;u.AllowQBE&&!e&&(!i.Hidden||i.Search>=1&&i.Search<=3)&&r.indexOf(u.Name+"."+n._mappedId)==-1&&(!n._mappedId||i.Name!=n._filterFields[0])&&t.push(i)})}var u=c(),i=[],r=[],e;if($(n.conditions).each(function(){r.push(this.field+"."+this.mappedId)}),includeIndex=r.indexOf(t),includeIndex>=0&&r.splice(includeIndex,1),f(v(),i),u){i._hasChildren=!0;for(e in u)f(u[e],i)}return i}function bt(n,t,i,r){var u;$(n).each(function(){var o=this,f=o._dataView,e=f._mappedId,s;field=f._allFields[o.AliasIndex];n._hasChildren&&(u?e&&u!=e&&(t.push({text:f.get_view().Label}),u=e):(t.push({text:f.get_view().Label}),u=f._id||e));s=i==field.Name+"."+e;t.push({text:field.HeaderText,icon:s?"check":!1,visible:s,context:{field:field.Name,originalField:o.Name,id:f._id,mappedId:e},callback:r})})}function dt(n,t,i){function e(t,u){for(var s=0;s<t.length;s++){var o=t[s],h=o&&o.Function,c=h==n.operation;o?o.List?e(o.List,u):f&&r.indexOf(h)==-1||u.push({text:o.Text,icon:c?"check":!1,visible:c,context:h,callback:i}):f||u.push({})}}var u=nt(n),o=u.findField(n.field),s=u.findField(n.originalField),r=s.SearchOptions,f=r&&r.length;e(y.Filters[o.FilterType].List,t)}function d(n,t){var i=ot(),r=[];(vs().length||n==!0)&&($(i).each(function(){var n=$app.find(this.id);r.push({Controller:n._controller,View:n._viewId,RequiresMetaData:!0,DoesNotRequireData:!0})}),$app._invoke("GetPageList",{requests:r},function(r){if(n==!0||n()){var f={};$(r).each(function(n){var r=this,e=i[n],o=e.id,t=new Web.DataView($("<div><\/div>").appendTo(u));t._render=function(){};r.Expressions=[];t._servicePath=v()._servicePath;t._controller=r.Controller;t._viewId=r.View;t._onGetPageComplete(r);t._filterFields=e.filterFields;t._mappedId=o;f[o]=t});c(f);t()}}))}function ni(n,t){var i=n.find(".ui-listview"),r=f(),u;r&&i.hide();items=[];t(items);wr(i);pc(i,items,{});i.listview("refresh");r&&i.show();u=n.data("position-options");n.popup("reposition",n.data("position-options"))}function hi(n,t,i){var r=[],u;t.mappedId&&!c()?r.push({text:ft.Loading,icon:"refresh",animate:!0,context:{},keepOpen:!0,callback:function(){}}):dt(t,r,i);a({anchor:n,items:r,afterclose:function(){u=!0;kt()},afteropen:function(){var n=this;d(function(){return u!=!0},function(){ni(n,function(n){dt(t,n,i)})})}})}function ti(n,t,i,r){var s=v(),e=ot(),o=b(t,i),u=[],f;bt(o,u,i,r);e.length&&!c()&&u.push({text:ft.Loading,icon:"refresh",animate:!0,context:{},keepOpen:!0,callback:function(){}});a({anchor:n,items:u,afterclose:function(){f=!0;kt()},afteropen:function(){var n=this;d(function(){return f!=!0},function(){ni(n,function(n){bt(b(t,i),n,i,r)})})}})}function v(){return $app.find(l.attr("data-scope"))}function c(n){if(arguments.length==0)return l.data("detail-map");l.data("detail-map",n)}function ot(t){t||(t=v());var i=[];return $(n._pages).each(function(){var r=this,n=r.dataView;n&&n._filterSource==t._id&&i.push({id:n._id,filterFields:n._filterFields.split(/,/)})}),i}function ii(t){var i=l.find(".app-wrapper"),r=t.closest(".app-conditions"),u=r.offset();vr(i,i.scrollTop()+u.top-(i.height()-r.outerHeight())/2,function(){n.blink(t.find(".app-matching .app-btn-select"),function(){f()&&t.find("input:visible").first().focus()})})}function ht(t){n.blink(t,function(){f()&&t.parent().find(":input:visible").first().focus()})}function ci(){$app.confirm(t.ResetSearchConfirm,function(){var n=v();n.viewProp("advancedSearchConfig",null);cu(n,null,"no")})}function ri(n,i){if(i&&i.length){var u=i.slice().reverse(),r=!0;$(u).each(function(){var i=this,f,u;n&&i.count<5||!n&&i.count>=5||(r&&(r=!1,$('<div class="app-clear-fix"><\/div>').appendTo(h),$('<div class="app-header"><\/div>').appendTo(h).text(n?t.Favorites:t.Recent)),f=$('<ul class="app-condition-list app-condition-list-history ui-body-a"/>').appendTo($('<div class="app-conditions"><\/div>').appendTo(h)),u=$('<li class="app-condition app-condition-history ui-body-a"><\/li>').appendTo(f),$("<div/>").appendTo(u).text(i.date),$("<div/>").appendTo(u).text(i.text),$('<a class="ui-btn ui-btn-icon-notext app-btn-icon-transparent app-btn-more ui-btn-right"/>').appendTo(u).attr("title",t.More))})}}function g(n){if(!n)return h.find(".app-clear-fix").nextAll().andSelf().detach();n.appendTo(h)}function ui(n,t){var i=-1;return $(n).each(function(n){if(this.text==t)return i=n,!1}),i}function fi(n,t,i){var u=n[ui(n,t)],r=v();r.viewProp("advancedSearchConfig",u.config);vr(nr(),0,function(){cu(r,null,i)})}function nt(n){return $app.find(n.id)||c()[n.mappedId]}function li(){var t,n;r.pageTransition!="none"&&o&&s!="none"&&(t=i.navigate.history.stack,t[t.length-1].transition="slidedown");n=h.find("input:visible").first();n.length&&(o&&!n.val().length&&(n.val(o),n.closest(".app-condition").data("condition").value=o),f()&&(ke(n,n.val().length),n.focus()))}var ai=e.get_filter(),vi=e.extension(),w=n.content("advanced-search"),l=w.closest(".ui-page"),it=w.find(".app-page-header"),lt=e.get_view().Label,at=t.AdvancedSearch,h=w.find(".app-panel-filter"),vt=e.viewProp("advancedSearchRecent"),p,tt,ei,ct,oi,si;if(ac(),n._contextButton.show().removeClass("ui-icon-dots").addClass("ui-icon-carat-d").attr("title",yt.HideAdvancedSearch),l.attr("data-scope")!=e._id||l.attr("data-view")!=e._viewId){if(l.attr("data-scope",e._id),l.attr("data-view",e._viewId),tt=c(),tt)for(ei in tt)ct=tt[ei],ct._element.remove(),ct.dispose();c(null);l.find(".app-wrapper").data("scroll-top",null)}it.attr("data-locked","false");st(lt==n.title()?[at,""]:[lt,at],it);it.attr("data-locked","true");l.addClass("app-page-search app-page-scrollable");u.one("pagecontainershow",function(){gi=function(){e._totalRowCount==-1&&e.sync()}});if(!h.length){h=$('<div class="app-panel-filter"><\/div>').appendTo($("<div><\/div>").appendTo(w)).on("vclick",function(i){var r=$(i.target).closest(".ui-btn"),u=h.data("config");r.length&&n.callWithFeedback(r,function(){var s,i,f,n;if(r.is(".app-btn-more"))if(r.parent().is(".app-matching"))a({anchor:r,iconPos:"left",tolerance:2,items:[{text:vu.Scopes.Grid.Delete.HeaderText,icon:"trash",callback:function(){var n=r.closest(".app-condition-list"),i=n.data("group"),t=!0;$(n).find(".app-condition").each(function(){var n=$(this),i=n.data("condition");if(i&&i.required)return t=!1,a({anchor:n.find(".app-condition-list-field"),title:yu.RequiredField}),!1});t&&(u.splice(u.indexOf(i),1),n.find(".app-condition").data("condition",null),n.data("group",null).parent().remove())}},{text:vu.Scopes.Grid.Duplicate.HeaderText,icon:"duplicate",callback:function(){var n=r.closest(".app-condition-list").data("group"),t,i=g();n=JSON.parse(JSON.stringify(n));u.push(n);t=et(v(),n);h.find(".app-matching-more").closest(".app-conditions").appendTo(h);g(i);ii(t)}}],afterclose:kt});else if(r.parent().is(".app-condition-history")){var tt=v(),w=r.parent().find("div").last().text(),o=tt.viewProp("advancedSearchRecent");r.parent().addClass("app-selected");a({anchor:r,iconPos:"left",tolerance:2,items:[{text:yt.PerformAdvancedSearch,icon:"search",callback:function(){fi(o,w,"search")}},{text:vu.Scopes.Grid.Edit.HeaderText,icon:"edit",callback:function(){fi(o,w,"no")}},{},{text:vu.Scopes.Grid.Delete.HeaderText,icon:"trash",callback:function(){o.splice(ui(o,w),1);tt.viewProp("advancedSearchRecent",o);var n=r.closest(".app-conditions");n.prev().is(".app-header")&&!n.next().is(".app-conditions")&&(n.prev().remove(),n.prev().remove());n.remove()}}],afterclose:function(){r.parent().removeClass("app-selected");kt()}})}else r.parent().is(".app-condition")&&a({anchor:r,iconPos:"left",tolerance:2,items:[{text:vu.Scopes.Grid.Delete.HeaderText,icon:"trash",callback:function(){var n=r.closest(".app-condition-list"),t=n.data("group"),i=r.parent(),f=i.data("condition");f.required&&!r.closest(".app-conditions").prev().length?a({anchor:i.find(".app-condition-list-field"),title:yu.RequiredField}):(t.conditions.splice(t.conditions.indexOf(f),1),i.data("condition",null).remove(),n.find(".app-condition").length<=1?(u.splice(u.indexOf(t),1),n.data("group",null).parent().remove()):b(t).length&&n.find(".app-condition-more").show())}}],afterclose:kt});else if(r.is(".app-btn-select"))if(r.is(".app-condition-list-scope")){i=r.closest(".app-condition-list").data("group");function l(n){i.scope=n;r.text(t[n])}a({anchor:r,iconPos:"left",items:[{text:t.MatchAll,context:"MatchAll",icon:i.scope=="MatchAll"?"check":!1,callback:l},{text:t.MatchAny,context:"MatchAny",icon:i.scope=="MatchAny"?"check":!1,callback:l},{text:t.DoNotMatchAll,context:"DoNotMatchAll",icon:i.scope=="DoNotMatchAll"?"check":!1,callback:l},{text:t.DoNotMatchAny,context:"DoNotMatchAny",icon:i.scope=="DoNotMatchAny"?"check":!1,callback:l}],afterclose:kt})}else if(r.parent().is(".app-matching-more")){function p(n){wt(u,!1,u.length==0);var t=u[u.length-1],i,f=g();t.scope=n;i=et(v(),t);r.closest(".app-conditions").appendTo(h);g(f);ii(i)}a({anchor:r,items:[{text:t.MatchAll,context:"MatchAll",callback:p},{text:t.MatchAny,context:"MatchAny",callback:p},{text:t.DoNotMatchAll,context:"DoNotMatchAll",callback:p},{text:t.DoNotMatchAny,context:"DoNotMatchAny",callback:p}],afterclose:kt})}else if(r.parent().is(".app-condition-more"))s=r.closest(".app-condition-list"),i=s.data("group"),ti(r,i,null,function(n){var t=nt(n),u=rt(t,t.findField(n.field),t.findField(n.originalField)),f;i.conditions.push(u);f=pt(u,s);r.parent().appendTo(s);b(i).length?r.parent().show():r.parent().hide();ht(f.find(".app-condition-list-field"))});else if(r.is(".app-condition-list-field")){var s=r.closest(".app-condition-list"),i=s.data("group"),f=r.parent(),e=f.data("condition");e.required&&!r.closest(".app-conditions").prev().length?a({anchor:f.find(".app-condition-list-field"),title:yu.RequiredField}):ti(r,i,e.field+"."+e.mappedId,function(n){var u=nt(n),t=rt(u,u.findField(n.field),u.findField(n.originalField));t.value=e.value;t.value2=e.value2;$app.filterDef(y.Filters[t.filterType].List,e.operation)&&(t.operation=e.operation);i.conditions[i.conditions.indexOf(e)]=t;k(t,f);ht(r)})}else if(r.is(".app-condition-list-operation"))f=r.parent(),n=f.data("condition"),hi(r,n,function(t){n.operation=t;k(n,f);ht(r)});else if(r.is(".app-condition-list-values")){f=r.parent();n=f.data("condition");function it(){var t=nt(n),i=n.field;yk(r,t,i,n.lov,function(r){var s=r.match(/^\w+\:((\$\w+)\$|=)(.+)$/),e=t.findField(i),u=n.operation,h,o,c=[];s?(h=n.lov=s[3],o=s[1],o=="="?u="=":u=="$in"?o=="$in$"||(u="$notin"):o=="$in$"||(u="$in"),n.operation=u,u=="="?(n.value=e.text(t.convertStringToFieldValue(e,h)),n.lovText=null,n.lov=null):($(h.split(/\$or\$/g)).each(function(){var n=t.convertStringToFieldValue(e,this);c.push(e.text(n))}),n.lovText=c.join(", "))):(n.lov=null,n.lovText=null);k(n,f);kt()},kt)}n.mappedId&&!c()?d(!0,it):it()}})});h.on("change",function(n){var t=$(n.target),i,r;t.is(".app-input-text")&&(i=t.closest(".app-condition").data("condition"),r=t.val(),t.parent().is(".ui-first-child")?i.value=r:i.value2=r)}).on("vclick",function(n){var t=$(n.target);if(t.is(".app-condition"))return t.find(":input:visible").first().focus(),!1});$('<div class="app-promo-filler"><\/div>').appendTo(w);$(document).on("sidebar.app",function(n){if(gt()){var i=n.items;i.splice(0,i.length);i.push({text:t.AdvancedSearchInstruction,isStatic:!0,wrap:!0});i.push({});i.push({text:yt.ResetAdvancedSearch,icon:"refresh",callback:ci})}}).on("search.app",function(t,i){function f(){var n,d=c(),t=v(),g={MatchAll:"_match_:$all$",MatchAny:"_match_:$any$",DoNotMatchAll:"_donotmatch_:$all$",DoNotMatchAny:"_donotmatch_:$any$"},e={positive:[],negative:[]},l,o,s,y,f,p=[],w=[],b={},k=0,u;$(r).each(function(t){var i=this,r,u;$(i.conditions).each(function(f){function nt(n,i,r){return{gIndex:t,cIndex:f,text:n,focus:i,focus2:r}}var o=this,s=o.operation,rt=!s.match(tl),ut=o.value,tt,ft=o.value2,it,v=$app.find(o.id)||o.mappedId&&d[o.mappedId],y=v.findField(o.field),p=y.Name,h,l,a="",et;if(rt?(String.isBlank(ut)?o.required&&(n=nt(yu.RequiredField,!0)):(tt={NewValue:ut.trim()},l=v._validateFieldValueFormat(y,tt,!0),l?n=nt(l,!0):a=v.convertFieldValueToString(y,tt.NewValue)),n||s=="$between"&&(String.isBlank(ft)?o.required&&(n=nt(yu.RequiredField,!1,!0)):(it={NewValue:ft.trim()},l=v._validateFieldValueFormat(y,it,!0),l&&(n=nt(l,!1,!0))),!n&&tt.NewValue>=it.NewValue&&(n=nt(ft+" "+iw.LessThanOrEqual+" "+ut,!1,!0)),n||(a+="$and$"+v.convertFieldValueToString(y,it.NewValue)))):(s=="$in"||s=="$notin")&&(a=o.lov,rt=!0),n)return!1;if(!rt||a){if(o.mappedId&&(h=c()[o.mappedId],h==null))return;r||(r=!0,u=i.scope.startsWith("DoesNot")?e.negative:e.positive,u.push(g[i.scope]),k++);s.match(/\$/)&&(s+="$");o.mappedId&&(et=new Sys.StringBuilder,h._fieldNameHint={},h._fieldNameHint[p]=o.headerText+" ("+o.scopeText.toUpperCase()+")",h._renderFilterDetails(et,[p+":"+s+a],!1),p+=","+h._controller+"."+(h._viewId||"grid1")+"."+o.filterField,b[p.replace(/\W/g,"_")+(k-1)]=et.toString());u.push(p+":"+s+a)}else w.push(o)});r||p.push(i)});n?(l=h.find(".app-condition-list").get(n.gIndex),o=$($(l).find(".app-condition").get(n.cIndex)),s=n.focus?o.find(".ui-first-child .app-input-text"):n.focus2?o.find(".ui-last-child .app-input-text"):o.find(".app-condition-list-field"),a({anchor:s,title:n.text,xOffset:8,yOffset:"bottom",afterclose:function(){s.is(":input")&&s.focus();kt()}})):(t.viewProp("advancedSearchFilter",e.positive.concat(e.negative)),$(r).each(function(){var n=this;$(w).each(function(){var t=n.conditions.indexOf(this);t>=0&&n.conditions.splice(t,1)})}),$(p).each(function(){var n=r.indexOf(this);n>=0&&r.splice(n,1)}),t.viewProp("advancedSearchConfig",r.length==0?null:r),t.viewProp("deepSearchInfo",b),r.length&&(y=t._filter,t._filter=[],f=t.extension().filterStatus(),t._filter=y,u=t.viewProp("advancedSearchRecent")||[],$(u).each(function(n){var t=this;if(t.text==f)return t.date=ua(),t.count++,u.splice(n,1),u.push(t),f=null,!1}),f&&(u.push({text:f,date:ua(),count:1,config:r}),u.length>30&&u.splice(30,1)),t.viewProp("advancedSearchRecent",u)),i())}n.promo(!1);var r=[],u;h.find(".app-condition-list").each(function(){var n=$(this).data("group");n&&(r.push(n),$(n.conditions).each(function(){this.mappedId&&(u=!0)}))});u&&!c()?d(!0,f):f()})}if(p=e.viewProp("advancedSearchConfig"),p||(p=[],wt(p,!0,!0)),h.data("condition",null),h.find(".app-condition").data("condition",null),h.data("config",p).find(".app-condition-list").data("group",null).parent().remove(),h.find(".app-header,.app-clear-fix").remove(),$(p).each(function(){et(e,this)}),oi=$('<ul class="app-condition-list app-condition-list-more ui-body-a"/>').appendTo($('<div class="app-conditions"><\/div>').appendTo(h)),si=$('<li class="app-matching app-matching-more ui-body-a"><\/li>').appendTo(oi),$('<a class="app-condition-list-field app-btn-select app-has-children ui-btn ui-corner-all ui-btn-inline"/>').appendTo(si).text(t.AddMatchingGroup),ri(!0,vt),ri(!1,vt),$('<div class="app-clear-fix"><\/div>').appendTo(h),s=="no"){n.blink(h.find(".app-condition-list-scope"));return}if(s=="search"){n.blink(h.find(".app-condition-list-scope"),function(){pf(!1)});return}u.one("pagecontainershow",function(){setTimeout(li,200)});uh(l);i.changePage("#advanced-search",{changeHash:!0,transition:r.pageTransition=="none"?"none":s||"slidedown"})}function pf(t){t?e(n.promo(),function(){pf()}):$(document).trigger("search.app",function(){var t=$("#advanced-search"),r=$app.find(t.attr("data-scope")),n=i.navigate.history.stack;n[n.length-1].transition="none";u.one("pagecontainershow",function(){hf(i.activePage);ef(r)});gi=null;history.go(-1)})}function vv(f,o){function g(){(c||h.length>0&&!f.get_useCase())&&(c&&o.parent().addClass("app-page-tasks"),s=$('<ul data-role="listview" data-inset="true" data-shadow="false" class="app-listview app-listview-static"/>').appendTo(o),f&&(k=pb(f,s,c)))}function nt(){c&&(h.length&&h.push({}),h.push({text:t.Settings,icon:"gear",callback:function(){n.contextScope("_taskAssistant");uc()}}))}var h=[],a,b=n.pageInfo(f&&f._id),c=!f,s,k,v=!1,y,d="eye",tt,p,l;if(f||(f=b&&b.dataView),o||(o=n.content("taskassistant"),a=o.closest(".ui-page"),a.find(".app-page-header").remove(),a.addClass("app-page-tasks app-page-scrollable"),o.find('ul[data-role="listview"]').listview("destroy").remove(),n.tabs("destroy",{container:a}),uh(a)),f&&(n.contextScope(f._id),h.isTaskAssistant=c,n.navContext(h,!c),n.contextScope(null),h.length&&h[0].icon=="back"&&(h=h.splice(1)),g(),c&&(f.get_isInserting()?(y="Entering",d="plus"):f.get_isEditing()?(y="Editing",d="edit"):f._lookupInfo&&(y="Lookup")),!1&&n.renderContext(s,h,function(n){var t=n.navigateTo=="detail";return t&&(v=!0),t}),c&&(v&&$('<li data-role="list-divider">').appendTo(s),tt=$("<li>").appendTo(s).attr("data-icon",d),resumeLink=$('<a href="#"/>').appendTo(tt).text(t["Resume"+(y||(f.get_isForm()?"Viewing":"Browsing"))]),$('<p class="app-item-desc"/>').appendTo(resumeLink).text(b.text),nt(),v=!0,n.renderContext(s,h,function(n){return v&&(v=!1,$('<li data-role="list-divider"/>').appendTo(s)),!n.navigateTo&&(n.callback||n.href)&&n.icon!="dots"&&(!n.command||!n.command.match(/^(Eye|SideBar)$/))})),s&&!c)){l=[];function it(){n.tabs("create",{tabs:l,className:"app-tabs-echo",scope:f.get_selectedKey(),change:function(){at()}})}$(h).each(function(){var i=this,t,n;i.navigateTo=="detail"&&(n=i.activator,n&&n.type=="Tab"&&($(l).each(function(){if(n.text==this.text)return t=this,!1}),t||(p!=n.container&&(p&&(it(),l=[]),p=n.container),t={text:n.text,content:[]},l.push(t))),echo=wv(this.context,s.parent()),t&&t.content.push(echo))});p&&it()}if(c&&!f&&(nt(),g(),n.renderContext(s,h)),s){s.listview().on("vclick",function(n){rt();var t=$(n.target).closest("a").andSelf("a"),r=t.data("context-action"),f=i.navigate.history.stack;return t.length&&!da(n)&&e(t,function(){if(w()=="taskassistant"){f[f.length-1].transition="none";u.one("pagecontainershow",function(){hf(i.activePage);setTimeout(function(){dt(r)},100)});history.go(-1)}else dt(r)}),!1});s.find(".ui-btn-icon-right").toggleClass("ui-btn-icon-right ui-btn-icon-left");ir(s)}if(c&&s&&s.find("li").first().length){l=[{text:fl.Tasks,content:$('#taskassistant ul[data-role="listview"]')},{text:t.Recent,content:$()},{text:t.Favorites,content:$()}];n.tabs("create",{tabs:l,className:"ui-header-fixed app-tabs-tasks",id:"tasks",scope:"user",placeholder:o});$(document).one("pagecontainershow",function(){tr()});i.changePage("#taskassistant",{changeHash:!0,transition:r.pageTransition=="none"?"none":"slidedown"})}c||!k||k.next().length||s.off().listview("destroy").remove()}function lu(n){n.find(".app-listview a").removeData();n.find('ul[data-role="listview"]').listview("destroy").remove()}function yv(t,i){t.find("h3").on("vclick",function(t){var u=$(t.target).closest("h3"),r=[],o=n.contextScope(),s,f;return u.addClass("app-selected"),e(u,function(){s=ro();n.contextScope(i);dy(r,!1,!0);r.length&&r[r.length-1].text&&r.push({});r.push({text:ki.Refresh,icon:"refresh",callback:function(){$app.find(i).sync()}});f=$.Event("viewselector.dataview.app");f.items=r;f.dataView=$app.find(i);$(document).trigger(f);n.contextScope(o);a({anchor:u,items:r,iconPos:"left",dropDown:!0,y:u.offset().top+u.outerHeight()})}),!1})}function pv(t,i){t.on("vclick",".ui-btn",function(t,r){function e(){var r=f.context&&f.context.group,e=[],t;r?(t=n.pageInfo(i).dataView,bf(r.Id,t,e,t.extension().commandRow()),a({items:e,iconPos:"left",defaultIcon:"carat-r",scope:t._id,anchor:u,y:u.offset().top+u.outerHeight(!0)/4*3,dropDown:!0})):f.callback(f.context)}var u=$(t.target).closest("a"),f=u.data("data-context");return u.length&&!n.busy()&&(r!=!1?n.callWithFeedback(u,e):e()),!1})}function dh(n){n.find(".app-echo-inner .app-selected").removeClass("app-selected")}function wv(i,r){function l(t){function l(n){var r=parseInt(s.attr("data-start-index")),u=parseInt(s.attr("data-end-index")),t=n=="next"?u+1:r-1,i=0;return t<0&&(t=0),i=Math.floor(t/h.extension().pageSize()),{action:n,rowIndex:t,pageIndex:i,ensurePageIndex:Math.max(n=="next"?i+1:i-1,0),pageY:f.offset().top}}var u=$(t.target),f=u.closest("a"),r=f.find(".app-btn-next"),s=f.find(".app-info"),c=i+"_echo",o=tt&&tt.x||t.pageX;r.length&&o>=r.offset().left&&o<r.offset().left+r.outerWidth()+4?u=r:(r=f.find(".app-btn-prev"),r.length&&o>=r.offset().left&&o<r.offset().left+r.outerWidth()?u=r:(f.find(".app-btn-see-all").addClass("ui-btn-active"),u=f));u.is(".app-btn-disabled")||(f.removeClass("ui-btn-active"),e(u,function(){u.removeClass("ui-btn-active");setTimeout(function(){u.is(".app-btn-next")?fr(c,l("next")):u.is(".app-btn-prev")?fr(c,l("prev")):n.changePage(i)},25)}))}var u=$('<div class="app-echo"/>').appendTo(r).attr({id:i+"_echo","data-for":i}),c,a,s,h=$app.find(i),o=$('<div class="app-echo-toolbar"><h3><\/h3><a href="#" class="ui-btn ui-btn-inline ui-corner-all ui-icon-dots ui-btn-icon-notext app-btn-more"/><div class="app-echo-controls"><\/div><span class="app-echo-see-all"><span><\/span><a href="#" class="ui-btn ui-btn-inline ui-corner-all ui-icon-carat-r ui-btn-icon-notext"/><\/span><\/div>').appendTo(u).on("vclick","a",function(t){var r=$(t.target);return oi(r)&&!n.busy()&&e(r,function(){r.is(".ui-icon-carat-r")?n.changePage(i):r.is(".ui-icon-dots")&&n.showContextMenu({scope:i})}),!1});c=o.find("h3");h.get_showViewSelector()||c.addClass("app-hidden");o.find(".ui-icon-dots").attr("title",t.More).css("visibility","hidden");yv(o,i);o.find(".ui-icon-carat-r").attr("title",t.SeeAll);o.find(".app-echo-see-all span").html(t.SeeAll).on("vclick",function(t){var r=$(t.target).addClass("app-selected");setTimeout(function(){r.removeClass("app-selected");n.changePage(i)},bt)});pv(o.find(".app-echo-controls"),i);h.get_showActionBar()||o.hide();$('<div class="app-echo-instruction"><\/div>').appendTo(u).hide();a=$('<div class="app-echo-inner"><\/div>').appendTo(u).hide().on("vclick taphold",function(t){var o=$(t.target),r=o.closest("a"),w,f,h,b,c,v=t.type,a=v!="taphold"&&!t.ctrlKey,y=r.is(".dv-action-see-all"),p;if(!o.closest(".app-presenter").length||y){if(s){s=!1;return}if(r.length&&!r.is(".app-divider")&&oi(o,v)&&(!y||a)&&!n.busy())if(y)l(t);else{if(o.is("[data-href]"))return;if(n.contextScope(i),w=n.pageInfo(i),f=w.dataView,h=f.extension(),c=r.data("data-context"),p=r.is(".app-selected"),f._hasKey()){if(ev(t,f))return!1;b=f.get_showMultipleSelection();a&&b&&wh(t)?hv(f,r):(dh(u),a?r.addClass("app-selected"):p?r.removeClass("app-selected"):r.addClass("app-selected"),uo(f).removeClass("app-selected"),a?(h.tap(c,"none"),ov(t)?kf(sv(o)):h.tap(c)):(p?h.clearSelection():h.tap(c,"none"),v=="taphold"&&(s=!0)),e(o));uf(f,u)}else n.infoView(f,!0,c.row);n.contextScope(null)}if(!o.closest(".app-grid-header").length)return!1}}).on("contextmenu",function(t){return hp(n.pageInfo(i).dataView,t)});$('<div class="app-echo-footer"><\/div>').appendTo(u).on("vclick",function(){var t=$(event.target),n=t.closest("a");return n.length&&n.is(".dv-action-see-all")&&l(event),!1});return bv(u),o.find("h3").text(n.pageInfo(i).text),f()&&u.find(".app-echo-inner").attr("tabindex",0),u}function at(t,r){var e,f,u,o=0;t?i.activePage.find(".app-echo-toolbar").each(function(){e=$(this).parent();f=e.attr("data-for");u=n.pageInfo(f);u.echoId&&!u.dataView._busy()&&fr(u.echoId)}):ci||b||li?(clearTimeout(ol),ol=setTimeout(function(){at(t,r)},50)):(n.callWhenVisible(".app-echo",function(t){setTimeout(function(){f=t.attr("data-for");u=n.pageInfo(f);!u.dataView||u.dataView._busy()||u.dataView.get_isForm()||(u.echoInitialized?u.echoChanged&&fr(u.echoId):(u.echoId=t.attr("id"),n.pageInit(u.id,!1)&&fr(u.id+"_echo")))},r==null?o:r);o+=50}),i.activePage.find(".app-echo-controls.app-stale").each(function(){var t=$(this).closest(".app-echo"),i=t.attr("id"),r=n.pageInfo(i.substring(0,i.length-5));iy(r.dataView,t)}))}function bv(n){var t=r.displayDensity;t!="Condensed"&&(t=="Comfortable"&&o.width()/16<31?n.addClass("app-density-compact"):t=="Compact"&&o.width()/14<31&&n.addClass("app-density-condensed"))}function eo(n,t,i){var r=n.find("h3").empty().text(t.get_view().Label||i.text),u=t._totalRowCount;return n.length&&u&&($("<span> (<\/span>").appendTo(r),$('<span class="app-echo-count"><\/span>').appendTo(r).text(u),$("<span>)<\/span>").appendTo(r),f()&&r.attr("title",r.text())),r}function kv(n){var t=n.session("frozen-style");t||(t=hs(),t.text("."+lf(n)+"frozen_{display:none!important}"),n.session("frozen-style",t))}function dv(n,t){var i=n.session("grid-avail-width"),r=t.find(".app-hscrollbar");t.closest(".app-echo").length||r.css("margin-right",ei.width);i!=null&&r.find(".app-hscrollbar-inner").width(i+ei.gridColumnPadding);ty(t)}function gv(){var t=$(this);if(!t.data("ignore-scrolling")){var n=$app.find(t.attr("data-view")),u=lf(n),i=n.session("scroll-style"),r=-t.scrollLeft()+ei.gridColumnPadding;i||(i=hs(),n.session("scroll-style",i));i.html("."+u+"{margin-left:"+r+"px!important;transition:margin-left 0 ease-out}");r=t.scrollLeft();n.session("scroll-left",r);ny(n,r)}}function ny(n,t){var i=n.session("frozen-style"),r=lf(n);i&&i.html("."+r+"frozen_{display:"+(t?"inline-block":"none")+"!important;width:"+(n.session("grid-frozen-width")||0)+"px}")}function ty(n){n.find(".app-hscrollbar").each(function(){var t=$(this),n=$app.find(t.attr("data-view")),r=n.session("frozen-style"),i=n?n.session("scroll-left"):null;i!=null&&(t.data("ignore-scrolling",!0).scrollLeft(i),ny(n,i),setTimeout(function(){t.removeData("ignore-scrolling")},100))})}function fr(r,u){function yi(){if(kt){vt.show().empty();var n=l.aggregateLabels(),t=$('<div class="app-echo-container-aggregates"><\/div>').appendTo(vt);$(c._fields).each(function(i){var f=this,o=c._allFields[f.AliasIndex],e=n[i],r,u,s;e&&(r=kt[f.Index],r=String.localeFormat(f.DataFormatString||"{0:n0}",r),u=$('<a class="ui-btn ui-inline app-calculated app-btn-static"/>').appendTo(t),$('<span class="app-calculated-label"/>').text(o.HeaderText).appendTo(u),s=$('<span class="app-calculated-value"/>').text(r).appendTo(u),$('<div class="app-static-text"/>').text(e).insertBefore(s.contents()),u.attr("title",o.HeaderText+"\n"+e+" "+r))});i.activePage.find(".app-echo:visible").length==1&&b.prev().is(".app-page-header,.app-tabs")&&(w-=vt.outerHeight())}}function yr(){$(s).each(function(n){var t=this;if(c.rowIsSelected(t))return g=n,l.commandRow()||(l.clearSelection(),l.tap(t,"none"),l.currentPageIndex(yt)),!1});nt=s.length}function wi(){var n;u?(g=null,u.action=="prev"?(v=u.rowIndex-h+1,v<0&&(v=0),lastPageRowIndex=u.rowIndex%wt,n=lastPageRowIndex-h+1,n>0?s=s.slice(n,lastPageRowIndex+1):(s=s.slice(0,lastPageRowIndex+1),u.pageIndex&&(k=l.visibleDataRows(u.pageIndex-1),k&&(s=k.slice(k.length+n).concat(s))))):(v=u.rowIndex,n=u.rowIndex%wt,s=s.slice(n,n+h+1),s.length<h&&(k=l.visibleDataRows(u.pageIndex+1),k&&(s=s.concat(k)))),yr()):g!=null&&h<ot&&(oi=Math.floor(h/2),st=v+g-oi+1,ot-(v+g)<oi&&(st-=oi-(ot-(v+g))),st<0&&(st=0),st!=v&&(st>v?(s=s.slice(0),s.splice(0,st-v),g-=st-v,v=st,s.length<h&&yt<l.pageCount()-1&&(k=l.visibleDataRows(yt+1),k&&(s=s.concat(k)))):yt>0&&(k=l.visibleDataRows(yt-1),k&&(k=k.slice(0),k.splice(0,wt-(v-st)),g+=k.length,v=st,s=k.concat(s)))),nt=wt)}function hi(n,i,r){n.empty();$('<span class="app-btn-see-all"/>').appendTo(n).text(t.SeeAll).attr("title",t.SeeAll);var u=$('<span class="app-btn-prev"/>').appendTo(n).text(t.Prev).attr("title",ki.Previous);return i||u.addClass("app-btn-disabled"),u=$('<span class="app-btn-next"/>').appendTo(n).text(t.Next).attr("title",ki.Next),r==ot-1&&u.addClass("app-btn-disabled"),$('<span class="app-info"/>').appendTo(n).attr({"data-start-index":i,"data-end-index":r}).html(String.format(ki.ShowingItems,i+1,r+1,ot)),n}function tu(n){if(u){var r=n.offset().top,t=Math.ceil(u.pageY)-Math.ceil(r),i;t>0&&t+n.outerHeight(!0)<ft.height()&&(i=n.parent().prev("li").first().find("a"),i.length&&$('<div class="app-listview-stub"><\/div>').height(t).appendTo(i))}}var b,bi,di,ii,nr,d,rt,ut,tr,pt,rr,br,er;if(!li&&(b=$("#"+r),b.length)){b.removeClass("app-density-condensed app-density-compact");var ft=b.parent(),o=b.find(".app-echo-inner").show(),vt=o.next().hide(),kr=b.attr("data-for"),et=n.pageInfo(kr),c=et.dataView,ot=c._totalRowCount,l=c.extension(),yt=u?u.pageIndex:l.currentPageIndex()||0,wt=l.pageSize(),v=yt*wt,ri,st,s=l.visibleDataRows(yt),k,e,a,p,bt,ui,dt=c.get_showRowNumber()==!0,ci=$(b).find(".app-echo-toolbar"),dr=ci.find(".app-echo-controls"),gr=ci.find(".app-echo-see-all"),or,sr=o.prev(),ai=l.instruction(!1),ct=l.viewStyle(),fi=l.itemMap(ct=="List"),nu=i.getScreenHeight(),w=ft.height()*.55,gt,g,nt,h,oi,tt,at,hr,ni,cr=c.get_selectedKey().length>0,si,lr,kt=l.aggregates(),vr,vi;if(!b.is(":visible")){et.echoChanged=!0;return}if(et.echoChanged=!1,bv(b),!s||u&&wt*u.ensurePageIndex<ot&&!l.visibleDataRows(u.ensurePageIndex)){c.goToPage(u&&u.pageIndex||0,!0);l.echoCallback=function(){l.echoCallback=null;fr(r,u)};return}if(or=eo(ci,c,et),et.echoInitialized||(et.echoInitialized=!0,et.refreshed=!1),b.css("padding-bottom",""),at=ft.find(".app-stub,.app-stub-main"),at.length||(at=$("<div><\/div>").appendTo(ft).addClass("app-stub"+(ro()?"-main":""))),at.height(at.outerHeight()+o.outerHeight(!0)),ai&&(s.length||ai.match(/"app-filter"/))?sr.html(ai).show():sr.hide(),gt=o.scrollLeft(),o.find(".app-hscrollbar").off(),lu(o),vr=o.find('div[data-role="presenter"]').detach(),o.empty(),vr.appendTo(o),n.presenter("hide",{container:o}),s.length){if(o.removeClass("app-no-scrolling app-horizontal-scrolling"),c._filterSource||ft.find(".app-echo").filter(uu).length!=1?f()&&ft.css("overflow",""):(w=nu-o.offset().top,f()&&(w-=pi(b.css("padding-top"))+pi(b.css("padding-bottom")),ct&&ct.match(/List|Grid|Cards/)?(ft.css("overflow","hidden"),lr=!0):ft.css("overflow",""))),gh(c,o),n.presenter("supports",ct)&&(bi=[],di=!1,n.presenter("enumerate",{id:c._id,list:bi}),$(bi).each(function(){if(this.name==ct)return di=!0,!1}),o.addClass("app-no-scrolling").height(""),yi(),di&&n.presenter("show",{name:ct,id:c._id,container:o,maxHeight:Math.ceil(w)})?vi=!0:ct=dl()?"Grid":"List"),!vi)if(u||yr(),ct=="Grid"){o.addClass("app-no-scrolling").height("");lu(o);e=$('<ul class="app-listview app-grid" data-role="listview"/>').addClass(af(c)).appendTo(o);a=$('<li data-role="list-divider" class="app-list-instruction"/>').appendTo(e);kh(c,a);a=$('<li data-icon="false" class="dv-item"/>').appendTo(e);vf(c,s[0],null,$("<a/>").appendTo(a));e.listview().listview("refresh");bt=a.outerHeight();ir(e);w-=a.prev().outerHeight()+1;h=Math.ceil(w/(bt+1));kt&&(h-=2);a.remove();h<4&&(h=4);wi();var it=[],ht=[],ti=0,lt,gi;$(s).each(function(n){var i=this,u=v+n+1,t=$('<li data-icon="false" class="dv-item"/>').appendTo(e),r=$('<a class="ui-btn"/>').appendTo(t).data("data-context",{row:this.slice(0),pageIndex:0});return vf(c,i,dt?u:null,r),n==g&&(ni=i,r.addClass("app-selected")),ri=v+n,!g||n<g?it.push(t):ht.push(t),h<nt&&h-1==n?!1:void 0});kt&&(a=$('<li data-icon="false" class="dv-item"/>').appendTo(e),a.prev().addClass("app-followed-by-aggregates"),p=$('<a class="app-divider app-calculated"/>').appendTo(a),vf(c,kt,null,p,l.aggregateLabels()));function pr(){tt=$('<a class="dv-action-see-all"/>').appendTo($("<li/>").appendTo(e)).html("text")}ii=$('<li class="app-echo-grid-hscrollbar"><div class="app-hscrollbar"><div class="app-hscrollbar-inner"><\/div><\/div><\/li>').height(ei.height);kv(c);ii.appendTo(e);ii.find(".app-hscrollbar").attr("data-view",c._id).on("scroll",gv);os(function(){dv(c,ii)});w-=ii.outerHeight();(h<nt||nt<ot)&&pr();e.listview().listview("refresh");tt&&(w-=tt.outerHeight());e.find(".dv-item").each(function(){ti+=$(this).outerHeight()});function wr(){lt&&(ti-=lt.outerHeight(),lt.find(".ui-btn").removeData(),lt.remove())}if(ti>w){if(tt||(pr(),w-=tt.outerHeight()),ht.length)while(it.length+ht.length+1>3&&ti>w)lt=null,gi=="before"?(gi="after",it.length>1&&it.length>=ht.length&&(lt=it[0],it.splice(0,1),v++)):(gi="before",ht.length>1&&ht.length>it.length&&(lt=ht[ht.length-1],ht.splice(ht.length-1,1),ri--)),wr();else while(it.length>3&&ti>w)u&&u.action=="prev"?(lt=it[0],it.splice(0,1),v++):(lt=it[it.length-1],it.splice(it.length-1,1),ri--),wr();e.listview("refresh")}tt&&(hi(tt.toggleClass("ui-btn-icon-right ui-btn-icon-left"),v,ri),tu(tt))}else if(ct=="List"){for(h=30,wi(),o.addClass("app-no-scrolling").height(""),lu(o),yi(),e=$('<ul class="app-listview app-onecolumnview" data-role="listview"/>').addClass(af(c)).appendTo(o).listview(),nr=0,d=g==null?0:g,ir(e),nc(c,e),u&&(d=u.action=="next"?0:s.length-1),rt=d,ut=d,tt=$('<li data-icon="carat-r" class="dv-item"><a class="ui-btn dv-action-see-all"/><\/li>').appendTo(e),w-=tt.outerHeight(),tt.remove();d>=0&&d<s.length;){var ur=s[d],iu=v+d+1,a=$('<li data-icon="false" class="dv-item"/>'),p=$('<a class="ui-btn"/>').appendTo(a).data("data-context",{row:ur.slice(0),pageIndex:0});if(u&&u.action=="prev"&&rr?a.insertBefore(rr):a.appendTo(e),rr=a,ar(c,ur,fi,dt?iu:null,a,p,!0),d==g&&(ni=ur,p.addClass("app-selected")),e.listview("refresh"),nr+=a.outerHeight(),nr>=w&&ut-rt>=3){br=!0;break}u?u.action=="next"?(ut++,d=ut):(rt--,d--):pt=="up"?(a.insertBefore(tr),tr=a,ut<s.length-1?(pt="down",ut++,d=ut):(rt--,d=rt)):pt=="down"?rt>0?(pt="up",rt--,d=rt):(ut++,d=ut):(tr=a,rt>0?(rt--,pt="up",d=rt):(ut++,pt="down",d=ut))}ut-rt<ot&&(pt=="down"||u&&u.action=="next"?ut--:rt++,br&&(p.removeData(),a.remove()),a=$('<li data-icon="carat-r" class="dv-item"/>').appendTo(e),p=hi($("<a/>").appendTo(a).addClass("dv-action-see-all"),v+rt,v+ut),e.listview("refresh"),p.toggleClass("ui-btn-icon-left ui-btn-icon-right"))}else{if(h=30,wi(),nt=s.length,e=$('<ul class="app-listview app-cardcolumn" data-role="listview"/>').hide().appendTo(o),a=$('<li data-icon="false" class="dv-item"/>').appendTo(e),p=$('<a class="ui-btn"/>').appendTo(a),yi(),ar(c,s[0],fi,dt?1:null,a,p),e.listview().show(),bt=a.outerHeight(!0),ui=Math.floor(o.innerWidth()/a.outerWidth(!0)),h=Math.floor(w/bt),h<1&&(h=1),e=vt.find(".app-echo-container-see-all").hide(),ot>nt&&(vt.show(),e.length?(e.show(),p=e.find(".ui-btn")):(e=$('<div class="app-echo-container-see-all"><\/div>'),kt?e.insertBefore(vt.find(".app-echo-container-aggregates")):e.appendTo(vt),p=$('<a class="ui-btn-icon-left ui-btn-icon-right ui-btn ui-icon-carat-r dv-action-see-all"/>').appendTo(e)),tt=hi(p,v,v+nt-1),w-=e.outerHeight(!0),f()&&(w-=8),h=Math.floor(w/bt),h<1&&(h=1)),ui*h>=s.length&&(h=Math.ceil(s.length/ui),o.addClass("app-no-scrolling")),ot>nt&&ui*h>=nt&&o.addClass("app-no-scrolling"),o.is(".app-no-scrolling")||(o.addClass("app-horizontal-scrolling"),f()&&(h=Math.floor(w/bt),h<1&&(h=1))),lu(o),$(s).each(function(n){if(n>=nt)return!1;e&&n%h!=0||(e=$('<ul class="app-listview app-cardcolumn" data-role="listview"/>').addClass(af(c)).appendTo(o),gh(c,e),nc(c,e));var t=this,u=v+n+1,i=$('<li data-icon="false" class="dv-item"/>').appendTo(e),r=$('<a class="ui-btn"/>').appendTo(i).data("data-context",{row:this.slice(0),pageIndex:0});ar(c,t,fi,dt?u:null,i,r);n==g&&(ni=t,r.addClass("app-selected"))}),nt>h&&(er=h-nt%h,er<h))while(er-->0)a=$('<li data-icon="false" class="dv-item"/>').appendTo(e),p=$("<a/>").appendTo(a),ar(c,s[0],fi,dt?1:null,a,p),p.css("visibility","hidden");h==ot&&e.addClass("app-list-one-column");ir(o.find(".app-listview").listview());e=o.find(".app-listview").first();e.length&&f()&&o.height(e.height()+ei.height+8);p=o.find(".app-selected");p.length&&(hr=p.offset().left-o.offset().left+p.outerWidth(),hr>o.width()&&(gt=p.offset().left-o.offset().left-(o.width()-p.outerWidth())/2));u&&(u.action=="next"?gt=0:(e=o.find(".app-listview").last(),gt=e.offset().left+e.outerWidth()-o.offset().left));o.scrollLeft(gt);tt&&hi(tt,v,v+nt-1)}}else $('<div class="app-echo-empty"/>').appendTo(o.height("")).text(y.NoRecords);b.prev().is(".app-echo")||b.next().is(".app-echo")||b.css("padding-bottom",0);nv(ft,at);(ft.scrollTop()||lr&&at.first().prev().offset().top+at.first().prev().height()>ft.offset().top+ft.height())&&ft.css("overflow","");vi||(cr?ni||u?c.rowIsSelected(l.commandRow())||(l.clearSelection(),l.tap(ni,"none")):l.clearSelection():l.commandRow()&&l.clearSelection());et.echoRefreshCallback&&(et.echoRefreshCallback(),et.echoRefreshCallback=null);iy(c,b,cr,dr,or,gr);l._checkedAutoSelect||(l._checkedAutoSelect=!0,setTimeout(function(){si=l._autoSelect;l._autoSelect=null;si&&!n.busy()&&(et.echoChanged=!0,n.contextScope(c._id),l.tap(si.row,si.action),n.contextScope(null))}))}}function iy(n,t,i,r,u,f){if(i==null&&(i=n.get_selectedKey().length>0),!r){if(t||(t=$("#"+n._id+"_echo")),!t.length)return;r=t.find(".app-echo-toolbar .app-echo-controls");u=r.parent().find("h3");f=r.next()}var e=u.next().css("visibility",""),o=e.offset().left+e.outerWidth(),s=f.offset().left;ry(n,r,o,s)}function ry(t,i,r,u,f,e){function v(n){return n.offset().left+n.outerWidth()>d+p-1}var b=[],y=[],k,d,p,s=[],w=[],l,a={},o,h,c;if(r==0||u==0)i.addClass("app-stale");else if(u-r>=28){if(i.find(".ui-btn").data("data-context",null),i.hide().contents().remove(),k=n.contextScope(),n.contextScope(t._id),t.extension().context(b,["ActionBar"]),n.contextScope(k),$(b).each(function(){var n=this;n.system?n.icon!="search"||f||y.push(n):n.text&&!n.isStatic&&y.push(n)}),$(y).each(function(){var t=this,n,r=t.icon,u;l=t.group;e&&r==e||(n=$('<a class="ui-btn"/>').appendTo(i).data("data-context",t),r=="dots"?n.addClass("app-has-children ui-corner-all ui-mini").text(t.text):(u=be(r),n.addClass("ui-mini ui-btn-icon-left ui-corner-all ui-icon-"+(u?"":r||"carat-r")).attr("title",t.text),u&&n.toggleClass("ui-btn-icon-left ui-icon-"),r=="search"?n.toggleClass("ui-btn-icon-left ui-btn-icon-notext ui-mini "):n.text(t.text),u&&$('<span class="glyphicon"> <\/span>').insertBefore(n.contents()).addClass(r),o=a[l],o||(o=a[l]=[]),o.push(n)))}),p=u-r-pi(i.css("marginRight")),i.width(p).show(),d=i.offset().left,i.find(".ui-btn").each(function(){var n=$(this);n.is(".ui-btn-icon-left")&&w.push(n);v(n)&&s.push(n)}),s.length)for(w.reverse();s.length;){if(h=s[0],c=v(h),c&&(isGeneric=h.is(".ui-icon-carat-r"),isGeneric?s.push(h):h.is(".ui-btn-icon-left")&&(h.toggleClass("ui-btn-icon-notext ui-mini ui-btn-icon-left"),c=v(h)),!isGeneric&&c&&$(w).each(function(){var n=this;if(s.indexOf(n)==-1&&n.is(".ui-btn-icon-left")&&(n.is(".ui-icon-carat-r")?n.hide():n.toggleClass("ui-btn-icon-notext ui-mini ui-btn-icon-left"),c=v(h),!c))return!1}),c)){$(s).each(function(){this.hide()});break}s.splice(0,1)}else for(l in a)o=a[l],o.length>1&&($(o).each(function(){$(this).addClass("app-group-item")}),o[0].addClass("app-group-first"),o[o.length-1].addClass("app-group-last"));$('<a class="ui-btn ui-btn-icon-notext ui-corner-all"/>').appendTo(i).css("visibility","hidden")}else i.hide()}function wb(t,i){var r=$('<div class="app-bar-actions ui-header ui-bar-inherit ui-header-fixed"><\/div>').insertBefore(i),u=$("<h3/>").appendTo(r).text(n.pageInfo(t._id).text);return $('<a class="ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all ui-icon-dots app-btn-more"/>').appendTo(r),yv(r,t._id),t.get_showViewSelector()||u.addClass("app-hidden"),pv($('<div class="app-bar-controls"><\/div>').appendTo(r),t._id),r}function bb(){var n=ci||b;return n==!0}function oi(n,t){var i;if(ci||b)return!1;if(ht)if(i=$(n).closest("a"),i.data("scroll-check")==!0)i.data("scroll-check",!1);else{li=!1;var r=i.closest(".app-wrapper,.ui-panel-inner"),u=r.data("scroll-stop-time"),f=r.scrollTop();return u&&fu()-u.getTime()>5e3?!0:(i.data("scroll-check",!0),setTimeout(function(){t||(t="vclick");f==r.scrollTop()?($(n).is(".app-btn-more")?n:i).trigger(t):(oi(i,t),h())},10),!1)}return!0}function wf(n){setTimeout(function(){$("div.ui-panel-open").panel("close",n!=!0)},bt)}function g(t,i,r){i||(i=450);pu&&(clearTimeout(pu),pu=null);t||(pu=setTimeout(function(){if(b)g(t,100,r);else{pu=null;ir();var u=w(),i=hu(),f=i.data("page-id"),e=n.contextScope();f==u&&ph(i);n.contextScope(null);i.find(".app-show-request").removeClass("app-show-request").show();i.find(".app-hide-request").removeClass("app-hide-request").hide();n.refreshContextMenu(i.data("page-id",u));n.contextScope(e);n.callInAnimationFrame(function(){n.refreshMenuStrip()});r&&r();wi(100);ui()}},i))}function ri(n,t){if(n=location.pathname.replace(/\W/g,"_")+"_"+n,arguments.length==1)return l(n);l(n,t)}function l(n,t){if(ko||(ko=__settings.appInfo.replace(/\W/g,"_")),n=ko+"_"+n,arguments.length==1){if(typeof Storage!="undefined")try{return t=localStorage[n],t!=null&&(t=JSON.parse(t)),t}catch(i){}return null}if(typeof Storage!="undefined")if(t==null)localStorage.removeItem(n);else try{localStorage[n]=JSON.stringify(t)}catch(i){}}function uy(n,t){var r={text:t,resolved:!0,description:null,type:null},i=n.attr("data-activator"),e,u,o,s=$(n).prev(".DataViewHeader").text(),f;return i||(o=n.closest("div[data-activator]"),i=o.attr("data-activator"),n=o),i&&(e=n.parent(),u=e.attr("id"),u||(u="aid"+ew++,e.attr("id",u)),r.container=u),i||(i=s),i&&i!="false"?(i=$app.eval(i),f=yp.exec(i),f?(r.text=f[4]||f[2],r.type=f[1]):r.text=i):r.resolved=!1,r.description=n.attr("data-activator-description"),r}function oo(n,t){return(t?n.tagged("action-call"):n.tagged("action-call","field-call"))||n.Name.match(kp)&&(!t||!n.tagged("action-call-disabled"))}function so(n,t){return(t?n.tagged("action-email"):n.tagged("action-email","field-email"))||n.Name.match(dp)&&!(t||!n.tagged("action-email-disabled"))}function fy(n,t){return(t?n.tagged("action-url"):n.tagged("action-url","field-url"))||n.Name.match(gp)&&(!t||!n.tagged("action-url-disabled"))}function kb(n,t){return t?n.tagged("action-location"):n.tagged("action-location","map-address")&&!n.tagged("action-location-disabled")}function db(n){var t=n.ItemsStyle;return!String.isNullOrEmpty(t)&&t!="CheckBoxList"}function gh(n,t){n.get_isTagged("thumb-person")||n._controller.match(/\b(emp|acc|user|usr|person|cust)/i)&&!n.get_isTagged("thumb-standard")?t.addClass("app-thumb-person"):t.removeClass("app-thumb-person")}function nc(n,t){n.get_showMultipleSelection()?t.addClass("app-listview-multiselect"):t.removeClass("app-listview-multiselect")}function vr(n,t,i){n.data("scrolling",!0).animate({scrollTop:t},"swing",function(){b=!1;i&&i();setTimeout(function(){n.removeData("scrolling")},100)})}function ey(t,i,r){r||(r={});var f=$(t),o=r.position||"right";if(rt(),iu=null,f.length==0){f=$(String.format('<div data-position-fixed="true" data-role="panel" data-theme="a" data-display="overlay" class="ui-panel ui-panel-display-overlay ui-panel-animate ui-panel-position-{0}"><ul/><\/div>',o)).appendTo(u).panel({animate:lr(),position:o,beforeopen:function(){tu=!0;wu&&(clearTimeout(wu),wu=null);i&&i()},open:function(){tu=!1;h();r&&r.afteropen&&r.afteropen()},beforeclose:function(){tu=!0;ph(f)},close:function(){tu=!1;iu&&iu();n.contextScope()&&(wu=setTimeout(function(){n.contextScope(null);wu=null},1e3));iu=null;r&&r.close&&r.close()}});lr(f);r.className&&f.addClass(r.className);to(f);t.match(/^#/)&&f.attr("id",t.substring(1));f.find("ul").listview().on("vclick",function(n){var t=$(n.target).closest("a"),r=t.closest("li").attr("data-icon"),i;if(tu||t.length&&!oi(t))return!1;if(i=t.data("context-action"),i&&!hl){if(i.dataRel)return!0;i.feedback==!1?(h(),i.keepOpen==!0?dt(i,t):(f.panel("close",r!="dots"&&r!="back"),iu=function(){setTimeout(function(){dt(i,t)},10)})):i.keepOpen==!0?e(t,function(){dt(i,t)}):e(t,function(){f.panel("close",r!="dots"&&r!="back");iu=function(){setTimeout(function(){dt(i,t)},lr()?10:bt)}})}return hl=!1,!1}).on("swipe",function(){});r&&r.resetScrolling&&f.addClass("app-reset-scrolling")}return f}function yr(){n.contextScope()=="_contextMenu"?n._menuPanel.panel("toggle"):n.toggleContextPanel("#app-panel-context")}function rt(){c&&$(c).blur()}function ut(){var t=!1;return n.stickyHeaderBar().is(":visible")&&(t=!0,n.stickyHeaderBar().hide()),t}function wi(t){t!=null?(clearTimeout(ll),ll=setTimeout(function(){n.fetchOnDemand()},t)):n.fetchOnDemand()}function ui(){return n.stickyHeader(),n}function k(t,i,r){return rt(),d=t,(n.contextScope()&&(!r||r.position!="left")||r&&r.position!="right")&&(i+="-scope",r||(r={}),r.position="left"),ey(i,function(){n.refreshContextMenu(i,d)},r).panel("toggle")}function oy(n){var r=new Sys.StringBuilder,o=n._fields,i,f,u=n.get_sortExpression(),e=te,t;if(u)for(t=e.exec(u);t;)i=n.findField(t[1]),f=!t[3]||t[3].match(/^asc/)?"asc":"desc",i&&i.AllowSorting&&(r.isEmpty()||r.append(", "),r.appendFormat("{0} ({1})",i.HeaderText,sr(i,f))),t=e.exec(u);return r.toString()}function sy(n){var i=new Sys.StringBuilder,o=n._fields,r,e,u=n.get_groupExpression(),f=te,t;if(u)for(t=f.exec(u);t;)r=n.findField(t[1]),e=!t[3]||t[3].match(/^asc/)?"asc":"desc",r&&r.AllowSorting&&(i.isEmpty()||i.append(", "),i.appendFormat("{0}",r.HeaderText)),t=f.exec(u);return i.toString()}function er(t){t.extension()._instructed=!1;n.stickyHeaderBar().find(".app-bar-text").removeData("html")}function tc(n,t){var f=n.groupExpression(),i=n.get_sortExpression(),u,r=0;if(f&&i){for(i=i.split($app._simpleListRegex);r<i.length;)u=i[r].match(/(\w+)(\s+\w+)?/),!i[r]||u&&f.indexOf(u[1])!=-1?i.splice(r,1):r++;i=i.join(",");n.set_sortExpression(i);n.viewProp("sortExpression",i)}n.viewProp("groupExpression",t);n.set_groupExpression(t);er(n);ut();n._keepKeyList=!0;n.AutoPivots=null;n.sync()}function ho(){var t=n.contextDataView();lt!=null&&(t.set_sortExpression(lt),lt=null,er(t),ut(),t._keepKeyList=!0,t.sync())}function or(n,t,i){var f=lt==null?n.get_sortExpression()||"":lt,e=f.split($app._simpleListRegex),r,u;if(i==null){if(f)for(r=0;r<e.length;r++)if(u=e[r].match(nw),u&&u[1]==t)return u[3]||"asc";return null}lt=i?String.format("{0} {1}",t,i):"";n.viewProp("sortExpression",lt)}function sr(n,t){var i=ft.GenericSortAscending,r=ft.GenericSortDescending;switch(n.FilterType){case"Text":i=ft.StringSortAscending;r=ft.StringSortDescending;break;case"Date":i=ft.DateSortAscending;r=ft.DateSortDescending}return t=="asc"?i:r}function ot(n,t){d=n;t?setTimeout(t,500):uc()}function hy(){function i(t){no();ut();n.contextScope(null);r.sidebar=t;l("sidebar",t);ps();ir();wi(1e3);ab();g();setTimeout(function(){tr();at(!0);f();ui()},750)}function f(){ot(u,hy)}var u=d,e=[{text:t.Back,icon:"back",callback:function(){ot(u)}},{text:t.Sidebar,isStatic:!1,instruction:!0},{text:t.Landscape,icon:r.sidebar=="Landscape"?"check":!1,context:"Landscape",callback:i},{text:t.Always,icon:r.sidebar=="Always"?"check":!1,context:"Always",callback:i},{text:t.Never,icon:r.sidebar=="Never"?"check":!1,context:"Never",callback:i},];n.contextScope("_contextMenu");k(e,"#app-panel-settings-sidebar")}function ic(n){return"app-theme-"+n.toLowerCase()}function rc(n){return"app-density-"+n.toLowerCase()}function cy(){var f=d,n=r.theme,e=[{text:t.Back,icon:"back",callback:function(){ot(f)}},{text:t.Themes.Label,isStatic:!1,instruction:!0}];for(var i in t.Themes.List)e.push({text:t.Themes.List[i],icon:i==n?"check":!1,context:i,callback:function(t){t!=n&&(n&&u.removeClass(ic(n)),r.theme=t,u.addClass(ic(t)),l("theme",t),ut(),fb(),ui());ot(f,cy)}});k(e,"#app-panel-settings-theme")}function ly(){function e(n){$app.confirm(t.ConfirmReload,function(){n!=u&&(r.pageTransition=n,l("pageTransition",n));ot(i,ly);cs()})}var i=d,u=r.pageTransition,f=[{text:t.Back,icon:"back",callback:function(){ot(i)}},{text:t.Transitions.Label,isStatic:!1,instruction:!0},];for(var n in t.Transitions.List)f.push({text:t.Transitions.List[n],icon:n==u?"check":!1,context:n,callback:e});k(f,"#app-panel-settings-theme")}function ay(){var f=d,n=r.displayDensity,e=[{text:t.Back,icon:"back",callback:function(){ot(f)}},{text:t.DisplayDensity.Label,isStatic:!1,instruction:!0},];for(var i in t.DisplayDensity.List)e.push({text:t.DisplayDensity.List[i],icon:i==n?"check":!1,context:i,callback:function(t){t!=n&&(o.trigger("resize"),u.removeClass(rc(n)),r.displayDensity=t,u.addClass(rc(t)),ii(),l("displayDensity",t),ru=null,setTimeout(function(){},bt),o.trigger("throttledresize"));ot(f,ay)}});k(e,"#app-panel-settings-display-density")}function vy(){var i=d,f=r.labelsInForm,e=[{text:t.Back,icon:"back",callback:function(){ot(i)}},{text:t.LabelsInForm.Label,isStatic:!1,instruction:!0},];for(var n in t.LabelsInForm.List)e.push({text:t.LabelsInForm.List[n],icon:n==f?"check":!1,context:n,callback:function(n){n!=f&&(u.removeClass("app-labelsinform-alignedright"),r.labelsInForm=n,n=="AlignedRight"&&u.addClass("app-labelsinform-alignedright"),l("labelsInForm",n));ot(i,vy)}});k(e,"#app-panel-settings-labels-in-form")}function gb(){var u=d,f=r.labelsInList,i=[{text:t.Back,icon:"back",callback:function(){ot(u)}},{text:t.LabelsInList.Label,isStatic:!1,instruction:!0},];for(var n in t.LabelsInList.List)i.push({text:t.LabelsInList.List[n],icon:n==f?"check":!1,context:n,callback:function(n){$app.confirm(t.ConfirmReload,function(){l("labelsInList",n);cs()})}});k(i,"#app-panel-settings-labels-in-form")}function yy(){function e(n){r.buttonShapes=n;l("buttonShapes",n);n?u.removeClass("app-buttons-text-only"):u.addClass("app-buttons-text-only");g();ot(i,yy)}var i=d,f=r.buttonShapes,n=[{text:t.Back,icon:"back",callback:function(){ot(i)}},{text:t.ButtonShapes,isStatic:!1,instruction:!0},];n.push({text:fe,icon:f!=!1?"check":!1,context:!0,callback:e});n.push({text:ue,icon:f==!1?"check":!1,context:!1,callback:e});k(n,"#app-panel-settings-button-shapes")}function py(){function f(n){r.promoteActions=n;l("promoteActions",n);g();ot(i,py)}var i=d,u=r.promoteActions,n=[{text:t.Back,icon:"back",callback:function(){ot(i)}},{text:t.PromoteActions,isStatic:!1,instruction:!0},];n.push({text:fe,icon:u!=!1?"check":!1,context:!0,callback:f});n.push({text:ue,icon:u==!1?"check":!1,context:!1,callback:f});k(n,"#app-panel-promote-actions")}function nk(){var u=d,f=r.initialListMode,i=[{text:t.Back,icon:"back",callback:function(){ot(u)}},{text:t.InitialListMode.Label,isStatic:!1,instruction:!0},];for(var n in t.InitialListMode.List)i.push({text:t.InitialListMode.List[n],icon:n==f?"check":!1,context:n,callback:function(n){$app.confirm(t.ConfirmReload,function(){l("initialListMode",n);cs()})}});k(i,"#app-panel-settings-default-list-mode")}function uc(){var i=[];n.contextScope()!="_taskAssistant"&&i.push({text:t.Back,icon:"back",callback:yr});i.push({text:t.Settings});r.displayDensityDisabled||i.push({text:t.DisplayDensity.Label,icon:"dots",callback:ay,desc:t.DisplayDensity.List[r.displayDensity]});r.themeDisabled||i.push({text:t.Themes.Label,icon:"dots",callback:cy,desc:t.Themes.List[r.theme]});r.pageTransitionDisabled||i.push({text:t.Transitions.Label,icon:"dots",callback:ly,desc:t.Transitions.List[r.pageTransition]});r.sidebarDisabled||i.push({text:t.Sidebar,icon:"dots",callback:hy,desc:r.sidebar=="Landscape"?t.Landscape:r.sidebar=="Always"?t.Always:t.Never});r.labelsInFormDisabled||i.push({text:t.LabelsInForm.Label,icon:"dots",callback:vy,desc:t.LabelsInForm.List[r.labelsInForm]});r.labelsInListDisabled||i.push({text:t.LabelsInList.Label,icon:"dots",callback:gb,desc:t.LabelsInList.List[r.labelsInList]});r.buttonShapesDisabled||i.push({text:t.ButtonShapes,icon:"dots",callback:yy,desc:r.buttonShapes!=!1?fe:ue});r.promoteActionsDisabled||i.push({text:t.PromoteActions,icon:"dots",callback:py,desc:r.promoteActions!=!1?fe:ue});r.initialListModeDisabled||i.push({text:t.InitialListMode.Label,icon:"dots",callback:nk,desc:t.InitialListMode.List[r.initialListMode]});k(i,"#app-panel-settings")}function fc(i){function w(n){var t=0;return n.closest("ul").find(".app-keep-open").each(function(){var n=$(this).data("context-action").context;n.index&&n.index>t&&(t=n.index)}),t}function b(n,t){n.closest("ul").find(".app-keep-open").each(function(){var n=$(this).data("context-action").context;n.index&&n.index>t&&n.index--})}function d(n){n.closest("ul").find(".app-keep-open").each(function(){var n=$(this),t=n.data("context-action").context;n.find(".ui-li-count").remove();t.index&&$('<span class="ui-li-count ui-body-inherit"/>').appendTo(n).text(t.index)})}var u=n.contextDataView(),r=u.get_groupExpression(),l=u.get_view().Label,a=u._fields,v=u._allFields,s=[],f=[],h,e,p=1,c,o={};if(i||f.push({text:t.Back,icon:"back",callback:yr}),r&&f.push({text:t.GroupedBy+" "+sy(u)+"."},{text:y.Filters.Labels.Clear,icon:"delete",callback:function(){tc(u,null)}}),f.push({},{text:t.Apply,callback:function(n,t){var i=[];$(t).closest("ul").find(".app-keep-open").each(function(){var n=$(this).data("context-action").context;n.index&&i.push(n)});i.sort(function(n,t){return n.index-t.index});r="";$(i).each(function(){var n=this;r&&(r+=",");r+=n.field});tc(u,r)}},{text:String.format(t.GroupByField,l)}),r)for(h=te,e=h.exec(r);e;)c=u.findField(e[1]),c&&(o[c.Name]={field:e[1],index:p++}),e=h.exec(r);$(a).each(function(n){var t=this,i=t;t=v[t.AliasIndex];!i.Hidden&&t.AllowSorting&&n>0&&s.push(t)});s.sort(function(n,t){var i=o[n.Name],r=o[t.Name];return(i?i.index:1e3)-(r?r.index:1e3)});$(s).each(function(){var n=this,t;t=o[n.Name];f.push({text:n.HeaderText,context:n,keepOpen:!0,icon:!1,context:t||{field:n.Name},count:t?t.index:null,callback:function(n,t){n.index?(b(t,n.index),n.index=null):n.index=w(t)+1;d(t)}})});k(f,"#app-panel-group-fields")}function tk(){function c(n){var t,i=0;$(r).each(function(){var i=this,r=i.context;if(r&&r.field==n.field)return t=i,!1});n.order?(t.context.order||($(r).each(function(){var n=this.context;n&&n.index>i&&(i=n.index)}),t.context.index=i+1,t.count=i+1),t.icon=n.order=="asc"?"arrow-u":"arrow-d",t.context.order=n.order):($(r).each(function(){var i=this,n=i.context;n&&n.index>t.context.index&&(i.count--,n.index--)}),t.context.order=null,t.context.index=null,t.count=null,t.icon=!1);k(r,"#app-panel-sort-fields")}var i=n.contextDataView(),f=i.get_sortExpression(),l=i.get_view().Label,a=i._fields,v=i._allFields,o=[],r=[{text:t.Back,icon:"back",callback:yr}],s,u,p=1,h,e={};if(f&&r.push({text:oy(i)},{text:y.Filters.Labels.Clear,icon:"delete",callback:function(){lt="";i.viewProp("sortExpression",lt);ho()}}),r.push({},{text:t.Apply,callback:function(n,t){var r=[];$(t).closest("ul").find(".ui-btn").each(function(){var n=$(this).data("context-action").context;n&&n.order&&r.push(n)});r.sort(function(n,t){return n.index-t.index});lt="";$(r).each(function(){var n=this;lt&&(lt+=",");lt+=n.field+" "+n.order});i.viewProp("sortExpression",lt);ho()}},{text:String.format(t.SortByField,l)}),f)for(s=te,u=s.exec(f);u;)h=i.findField(u[1]),h&&(e[h.Name]={field:u[1],index:p++,order:u[3]&&u[3].match(/^desc/i)?"desc":"asc"}),u=s.exec(f);$(a).each(function(){var n=this,t=n;n=v[n.AliasIndex];!t.Hidden&&n.AllowSorting&&o.push(n)});o.sort(function(n,t){var i=e[n.Name],r=e[t.Name];return(i?i.index:1e3)-(r?r.index:1e3)});$(o).each(function(){var u=this,n,f=i.groupExpression();n=e[u.Name];r.push({text:u.HeaderText,icon:n?n.order=="asc"?"arrow-u":"arrow-d":!1,context:n||{field:u.Name},count:n?n.index:null,callback:function(n){var u=i.findField(n.field),e=[{text:t.Back,icon:"back",callback:function(){k(r,"#app-panel-sort-fields")}},{text:String.format(t.SortByOptions,i.get_view().Label,u.HeaderText)},{text:sr(u,"asc"),icon:n.order=="asc"?"check":!1,context:{order:"asc",field:n.field},callback:c},{text:sr(u,"desc"),icon:n.order=="desc"?"check":!1,context:{order:"desc",field:n.field},callback:c}];f&&f.indexOf(n.field)!=-1||e.splice(2,0,{text:t.None,icon:n.order?!1:"check",context:{field:n.field},callback:c});k(e,"#app-panel-sort-field-options")}})});k(r,"#app-panel-sort-fields")}function ik(n){var t=n.find(".app-group"),i=t.length?t.first().outerHeight(!0):0;return t.remove(),i}function rk(n,t){var r=n.groupExpression(),o=[],v=n.get_showFirstLetters()&&!r,s,i=0,u,f,e,c,l,h,a;if(r){while(i<r.length)s=n.findField(r[i]),s?r[i++]=n._allFields[s.AliasIndex]:r.splice(i,1);t.find("li a").each(function(){var s=$(this),k=s.data("data-context"),t=[],y=[],p=[],w,b=[],d,n,g;k?($(r).each(function(l){var it=this,nt=k.row[it.Index],a,rt,tt,et,ut;if(nt!=null&&(a=v?nt.substring(0,1):it.text(nt)),t.push(a),y.push(it.HeaderText),p.push(it.Type),b.push(nt),o.length&&o[l]==a||(o[l]=a,d=!0),d&&l==r.length-1){for(u&&($('<span class="app-group-count"/>').appendTo(u).text(f+(h?"+":"")),h=!1),n=$('<li class="app-group"/>').insertBefore(s.parent()),$(pl).appendTo(n),tt=null,rt=null,w=p[p.length-1].match(/^Date/),nt!=null&&p.length==1&&w&&(nt=b[b.length-1],rt=bi.DayNames[nt.getDay()]+" "+nt.getDate(),tt=bi.MonthNames[nt.getMonth()],et=nt.getFullYear()),tt&&(e=$('<span class="app-group-info"/>').appendTo(n),$('<span class="app-group-info-value"/>').appendTo(e).text(tt),$('<span class="app-group-info-value-muted"/>').appendTo(e).text(et),c!=tt?c=tt:e.addClass("app-group-info-duplicate")),w&&n.addClass("app-group-fixed"),f=0,i=0;i<t.length-1;)ut||(ut=$('<span class="app-group-path"/>').appendTo(n)),g=$('<span class="app-group-path-value"/>').appendTo(ut),a=t[i],a||(a=ft.BlankValue),g.text(a).attr("title",y[i]+":\n"+a),i++;a=rt||t[t.length-1];u=$('<span class="app-group-title"/>').appendTo(n).text(a);a||(a=ft.BlankValue);u.text(a).attr("data-text",a).attr("title",y[y.length-1]+":\n"+a)}}),f++):s.is(".dv-load-at-bottom")?a=!0:!l&&s.is(".dv-load-at-top")&&(h=!0,l=!0)});u&&$('<span class="app-group-count"/>').appendTo(u).text(f+(a?"+":""))}}function uk(n){var t=n.get_filter(),i=n._externalFilter||[];return t&&t.length&&i.length<t.length||ou(n).length}function ec(n){var t=$(".ui-panel-open .app-btn-apply,.ui-popup-active .app-btn-apply");t.is(".app-enabled")||(n?t.removeClass("ui-disabled"):t.addClass("ui-disabled"))}function co(n){var t=n.find(".app-icon-check");n.is(".app-checked")?t.length||$(vi).appendTo(n):t.remove()}function fk(n,t){var i=wy(t),r=oc(t);t.toggleClass("ui-btn-icon-right app-checked");co(t);r.length>r.filter(".app-checked").length?i.removeClass(dr):i.addClass(dr);co(i);ec(r.filter(".app-checked").length>0)}function wy(n){return n.closest(".ui-panel-inner").find(".app-btn-select-all a")}function oc(n){return wy(n).parent().nextAll().find("a")}function ek(n){return n.length>0?n.data("data-context")||n.data("context-action"):null}function ok(n,t){var i=$app.find(n.dataViewId),r=n.field,f=i.findField(r),e=i._allFields[f.AliasIndex],u=by(i,r,t);i.removeFromFilter(e);u&&i._filter.push(u);ef(i)}function by(n,t,i){function s(t){r=[];o.each(function(){var i=$(this),u=i.is(".app-checked");(u&&t||!u&&!t)&&r.push(n.convertFieldValueToString(f,f._listOfValues[ek(i).context]))})}var f=n.findField(t),h=n._allFields[f.AliasIndex],u=[],r,e,o=oc(i);return o.filter(":not(.app-checked)").length&&(s(!0),r.length&&(u.push(h.Name+":"),r.length==1?u.push("="+r[0]):(e=r.length<=10||r.length<=r.length/2,u.push(e?"$in$":"$notin$"),e||s(!1),$(r).each(function(n){n>0&&u.push("$or$");u.push(this)})))),u.join("")}function pr(i){function o(n,i){var f=n._dataView,u=f._allFields[n.AliasIndex],e=f.get_fieldFilter(u,!0);r||(i.push({text:t.Back,icon:"back",callback:c}),i.push({text:u.HeaderText}));e&&i.push({text:y.Filters.Labels.Clear,context:u.Name,callback:function(){f.removeFromFilter(u);ef(f)},icon:"delete"});i.push({text:y.Filters[u.FilterType].Text,context:u.Name,disabled:!0,callback:function(){},icon:"dots"});r||i.push({text:String.format(t.FilterByOptions,f.get_view().Label,u.HeaderText,t.Apply)})}function s(n,i){var e,r,w,u=n._dataView,l=n._listOfValues||[],a=u._allFields[n.AliasIndex],h=u.get_fieldFilter(a,!0),v=[],o,p,s,f,c=h=="$notin";for(h&&(h=="="||h=="$in"||c)&&(p=(u.get_fieldFilter(a)||"").split(/\$or\$/)),o={text:t.Apply,disabled:!0,itemClassName:"app-btn-apply",context:{dataViewId:u._id,mappedId:u._mappedId,field:n.Name},callback:ok},i.push(o,{}),l.length>1&&i.push({text:y.Filters.Labels.SelectAll,keepOpen:!0,itemClassName:"app-btn-select-all",icon:!1,callback:function(n,t){var i=oc(t);t.is(".app-checked")?(t.removeClass(dr),i.removeClass(dr).find(".app-icon-check").remove(),ec(!1)):(t.addClass(dr),$(vi).appendTo(i.addClass(dr)),ec(!0));co(t)}}),e=0;e<l.length;e++)r=l[e],f=p&&p.indexOf(u.convertFieldValueToString(n,r))!=-1,c&&(f=!f),w=r==null?ft.EmptyValue:typeof r=="string"&&r==""?ft.BlankValue:a.text(r),s={text:w,icon:f?"check":!1,keepOpen:!0,context:e,callback:fk,linkClassName:f?"app-checked":""},f?(c?v.push(s):i.push(s),o.disabled&&(o.disabled=!1,o.itemClassName+=" app-enabled")):c?i.push(s):v.push(s);return i.concat(v)}function h(t){var i=[],u=n.contextDataView(),r=u.findField(t),f=u._allFields[r.AliasIndex];o(f,i);e&&i.splice(0,1);r._listOfValues&&r._listOfValues.length?i=s(r,i):i.push({text:ft.Loading,icon:"refresh",animate:!0,context:{id:u._id,field:t},keepOpen:!0,callback:function(){}});k(i,"#app-panel-filter-field",{position:"right",resetScrolling:!0,afteropen:function(){var u=gl().data("context-action"),r=u&&u.context,i,f,t;r&&(i=$app.find(r.id),t=i.findField(r.field),f=i._allFields,i._loadListOfValues(null,t.Name,f[t.AliasIndex].Name,function(){var u=gl(),f=u.length&&u.data("context-action").context,r=[];u.length&&f.id==i._id&&f.field==t.Name&&(o(t,r),e&&r.splice(0,1),r=s(t,r),n.refreshContextMenu(u.closest(".ui-panel"),r))}))}})}function c(){var i=n.contextDataView(),r=f?[]:[{text:t.Back,icon:"back",callback:yr}],u={},e=i&&i._filter;uk(i)&&(r.push({text:i.extension().filterStatus()}),r.push({text:y.Filters.Labels.Clear,icon:"delete",callback:function(){var t=n.contextDataView();th(t)}}),f&&ou(i).length&&r.push({text:yt.ShowAdvancedSearch,desc:la(i),icon:"search",toolbar:!1,system:!0,context:{dataViewId:i._id},callback:na}));r.push({text:String.format(t.FilterByField,i.get_view().Label)});$(i._filter).each(function(){var n=this,t=n.match(/^\w+/);t&&(u[t[0]]=n)});$(i._externalFilter).each(function(){u[this.Name]=null});$(i._fields).each(function(){var o=this,t,f,n;t=i._allFields[o.AliasIndex];f=u[t.Name];f&&(i._filter=[f],n=i.extension().filterStatus(!0,!0),n.indexOf(t.HeaderText)==0&&(n=n.substring(t.HeaderText.length).trim(),n.length>2&&(n=n.charAt(0).toUpperCase()+n.slice(1))));!o.Hidden&&t.AllowQBE&&r.push({text:t.HeaderText,context:o.Name,icon:f?"filter":!1,desc:n,callback:h});i._filter=e});k(r,"#app-panel-filter")}var f,e,r,u;if(typeof i=="object"&&(i._dataView?r=i:i.mode=="everything"?f=!0:i.mode=="field"&&(e=!0)),r)return u=[],o(r,u),r._listOfValues&&r._listOfValues.length?u=s(r,u):u.push({text:ft.Loading,icon:"refresh",animate:!0,context:{id:r._dataView._id,field:r.Name},keepOpen:!0,callback:function(){}}),u;i&&i.mode=="field"?h(i.field):c()}function ky(t,i,r,u){r||(r=n.pageInfo());var f=r&&r.dataView,e=f&&f.get_view(),o=0;return f&&f.get_isGrid()&&f.get_showViewSelector()&&$(f.get_views()).each(function(){var n=this,s=n.Label==e.Label;i&&n.Id==e.Id||(n.Type!="Form"&&n.ShowInSelector||n.Id==e.Id)&&(t.push({text:n.Label,icon:s?"check":i?"":!1,context:o,callback:function(t){var i=$.find("#"+r.id+" .ui-content > .app-tabs-views .ui-btn");u&&i.length?$(i[t]).trigger("vclick",{selectedTab:n.Label}):(f._forceSync(),f.extension()._commandRow=null,f._requestedSortExpression=f.pageProp(n.Id+"_sortExpression"),f._requestedFilter=f.pageProp(n.Id+"_filter"),f.executeCommand({commandName:"Select",commandArgument:n.Id}),f.pageProp("viewId",n.Id),u&&!i.length&&ri(r.id+"_view-tabs",n.Label),r.id==w()&&(st(n.Label),wl(),er(f),g()))}}),o++)}),o}function dy(i,r,u){var e=n.contextDataView(),f=e.extension(),o=f.viewStyle(),h=e!=n.dataView(),s=[];ky(i,null,n.contextPageInfo(),!0)==1&&i.splice(i.length-2,2);e.get_isGrid()&&e.get_showViewSelector()&&(r==!1?i.length&&i.push({}):i.push({text:t.PresentationStyle}),(u==null||u==!0)&&(f.tagged("view-style-grid-disabled")||i.push({text:t.Grid,icon:o=="Grid"?"check":!1,callback:function(){f.viewStyle("Grid")}}),f.tagged("view-style-list-disabled")||i.push({text:t.List,icon:o=="List"?"check":!1,callback:function(){f.viewStyle("List")}}),f.tagged("view-style-cards-disabled")||i.push({text:t.Cards,icon:o=="Cards"?"check":!1,callback:function(){f.viewStyle()!="Cards"&&f.viewStyle("Cards")}}),h||f.tagged("view-style-map-disabled")||f.tagged("supports-view-style-map")&&i.push({text:t.Map,icon:o=="Map"?"check":!1,callback:function(){f.viewStyle("Map")}}),n.presenter("enumerate",{id:e._id,list:s}),$(s).each(function(){var n=this;f.tagged("view-style-"+n.name.toLowerCase()+"-disabled")||(n.icon=n.name==o?"check":!1,i.push(n))})))}function sk(){var n=[{text:t.Back,icon:"back",callback:yr},{text:t.AlternativeView}];dy(n);k(n,"#app-panel-view-options")}function sc(t,i,r){var s=t._parentDataViewId&&!t._lookupInfo,e=t.extension(),o=t._id,h=t._allFields[t._fields[0].AliasIndex],f=i.length,u;r&&r.length&&!e.inserting()&&i.isSideBar==!1&&(n.enumerateFields(t,i,null,r),f<i.length&&(u=i[f],u.icon="info",u.theme="b",u.callback=function(){var t=$app.find(o);n.infoView(t,!1,null,"right")}))}function hc(n,t,i){i&&$(n._fields).each(function(){var r=n._allFields[this.AliasIndex],f=oo(r,!0),e=so(r,!0),u;(f||e)&&(u=i[r.Index],u!=null&&(f?t.push({text:r.text(u),desc:r.HeaderText,icon:"phone",href:"tel:"+u,system:!0}):e&&t.push({text:r.text(u),desc:r.HeaderText,icon:"mail",href:"mailto:"+u,system:!0})))})}function hk(n){var t=null,i=n.CssClass;if(i&&(t=i.match(/\bui-icon-(\w+)\b/),t?t=t[1]:(t=i.match(/\bglyphicon-([\w\-]+)\b/),t&&(t=t[0]))),!t)switch(n.CommandName){case"Delete":t="trash";break;case"New":t="plus";break;case"Edit":t="edit";break;case"Insert":case"Update":t="check";break;case"Cancel":t="back";break;case"Duplicate":t="duplicate"}return t}function bf(i,r,u,f,e){function b(n){for(var i=r._views,t=0;t<i.length;t++)if(i[t].Id==n)return i[t].Type!="Form";return!1}var p=r.rowIsSelected(f),h,a=[],g=r.get_viewId(),v=r.get_isGrid(),y={},c,o,l,w=ni?/^(DataSheet|Grid|Import|BatchEdit)$/:/^(DataSheet|Grid|Export(Rowset|Rss)|Import|BatchEdit)$/;$(r.actionGroups(i)).each(function(g){var nt=this,tt=nt.Scope;tt!="ActionBar"||nt.Flat||nt.Id==i?(!nt.Scope.match(/Grid|ActionColumn/)||p&&v||nt.Flat)&&$(this.Actions).each(function(t){var p=this,i=p.CommandName,k=p.CommandArgument,it=i+"/"+k+"/"+p.HeaderText,d=a.indexOf(it)==-1&&(!i||!i.match(w))&&(!nt.Flat||p.HeaderText);l=i?function(){if(n.contextScope(null),!r._busy())if(i=="Cancel")s.history.go(-1);else{function u(){r.extension().command(f,i,k,p.CausesValidation,p.Path)}String.isNullOrEmpty(p.Confirmation)?u():r._confirm({action:p,scope:nt.Scope,actionIndex:t,rowIndex:0,groupIndex:g},function(n){$app.confirm(n,function(){u()})})}}:null;o=null;d&&(c=i&&i.match(/^(Select|Edit|New|Duplicate)$/),c&&v&&(!k||b(k))?e&&i=="Edit"?k=e:(y[i]=u[u.length-1],d=!1):c&&(o=y[i]));d&&!l&&nt.Scope.match(/Grid|ActionColumn/)&&(d=!1);d&&(a.push(it),h={text:p.HeaderText,callback:l,icon:hk(p),uiScope:tt,group:nt.Id,path:p.Path,command:i,argument:k},o?Array.insert(u,u.indexOf(o)+1,h):u.push(h))}):u.push({text:nt.HeaderText,icon:"dots",uiScope:tt,group:nt.Id,context:{group:nt,isSideBar:u.isSideBar},callback:function(n){d=[];n.isSideBar||d.push({text:t.Back,icon:"back",callback:yr});d.push({text:nt.HeaderText});bf(n.group.Id,r,d,f);k(d,"#app-panel-group-actions",n.isSideBar?{position:"left"}:null)}})})}function gy(n,t){function o(n,t){$(f).each(function(i){var r=f[i],e=r.AliasIndex,o=f[e];r.Hidden||o.GroupBy||!(u||r.tagged(n))||t.call(r,e)})}function s(n){o(n,function(t){var f=this,s=f.tagged(n+"desc"),h=f.tagged(n+"para"),c=f.tagged(n+"column"),l=f.tagged(n+"nolabel"),e=(f.tagged(n+"label")||s||h||c)&&!l,o=$app.tagSuffix,a=f.tagged(n+"count"),v=f.tagged(n+"aside"),y=f.tagged(n+"heading"),p=f.tagged(n+"thumb"),w;f.tagged(n+"none")||(!u||y||s||a||v||l||h||c||(i.heading==null?i.heading=t:i.thumb==null&&f.OnDemand&&f.OnDemandStyle!=1?i.thumb=t:(s=!0,e=!0)),y&&(i.heading=t),(!e||a||v)&&!l||(i.desc.push(t),r=i.desc.length-1,$app.tagSuffix&&(i.descRwd[r]=$app.tagSuffix),e&&(i.descLabels[r]=!0,o&&(i.descLabelsRwd[r]=o)),h&&(i.descPara[r]=!0),c&&(i.descColumn[r]=!0,w=f.Columns,i.descColumnCount++)),a&&(i.count=t,i.countRwd=$app.tagSuffix,i.countLabel=e,i.countLabelRwd=o),v&&(i.aside=t,i.asideRwd=$app.tagSuffix,i.asideLabel=e,i.asideLabelRwd=o),p&&(i.thumb=t))})}function h(){u=!0}var p=n._fields,f=n._allFields,i=t&&n._listItemMap&&n._listItemMap[n._viewId]||!t&&n._cardItemMap&&n._cardItemMap[n._viewId]||{heading:null,thumb:null,aside:null,count:null,desc:[],descOriginal:[],descRwd:[],descLabels:[],descLabelsRwd:[],descPara:[],descColumn:[],descColumnCount:0},u,r;if(i.cached)return i;if(t?(o("list-",h),u&&s("list-")):(o("card-",h),u&&s("card-",!0)),u||(o("item-",h),u&&s("item-")),u)i.heading==null&&(i.heading=p[0].AliasIndex);else{var c,l,w=0,e=[],a=3,v;function y(n){if(!this.Hidden&&!this.GroupBy)if(this.OnDemand)i.thumb==null&&this.OnDemandStyle!=1&&(i.thumb=n);else if(!c||this.ShowInSummary){n=this.AliasIndex;var o=f[n],s=o.Type.match(/^Date/);if(o.GroupBy)return;isSimpleType=o.Type!="String"&&!o.OnDemand;i.heading==null?(i.heading=n,t&&(i.desc.push(n),r=i.desc.length-1,i.descLabels[r]=n,e.push(r))):i.aside==null&&s&&i.count==null&&!t?i.aside=n:i.count!=null||!isSimpleType||s||i.aside!=null||t?(i.desc.push(n),r=i.desc.length-1,i.descLabels[r]=n,t?(e.push(r),!o.ItemsLookupStyle&&(o.Rows>1||o.TextMode==3)?(i.descPara[r]=!0,l=!0):l&&(i.descPara[r]=!0,l=!1)):w++%3==0&&(i.descPara[r]=!0)):i.count=n;u=!0}}t&&(c=!1);$(f).each(y);t&&!i.descPara.length&&e.length>3&&(e.length<7&&(a=2),v=Math.ceil(e.length/a),$(e).each(function(n){n%v==0&&(i.descColumn[this]=!0,i.descColumnCount++)}));u||(c=!1,$(f).each(y))}return i.desc.length&&$(f).each(function(){var n=this,t=i.desc.indexOf(n.AliasIndex);t!=-1&&n.Index!=n.AliasIndex&&(i.descOriginal[t]=n.Index)}),i.cached=!0,t?(n._listItemMap||(n._listItemMap={}),n._listItemMap[n._viewId]=i):(n._cardItemMap||(n._cardItemMap={}),n._cardItemMap[n._viewId]=i),i}function cc(n){var t={latitude:null,longitude:null,segments:[]},i=[];return $(n._allFields).each(function(n){var r=this;r.tagged("map-")&&(r.tagged("map-latitude")?t.latitude=n:r.tagged("map-longitude")?t.longitude=n:i.push(this))}),$(["address","city","state","region","postalcode","zipcode","zip","country"]).each(function(){var n=this;$(i).each(function(r){var u=this;if(u.tagged("map-"+n))return t.segments.push(u.Index),i.splice(r,1),!1})}),t}function ck(n){var t=bu||l("geoLocations"),i=null;return t&&$(t).each(function(){var t=this;if(t.address==n)return i=t.lat==null&&t.lng==null?"ZERO_RESULTS":{lat:t.lat,lng:t.lng},!1}),bu||(bu=t),i}function np(n,t,i){var r=bu||l("geoLocations");r||(r=[]);r.push({address:n,lat:t,lng:i});r.length>uw&&r.splice(0,1);bu=r;setTimeout(function(){l("geoLocations",r)},0)}function tp(n,t,i){var r=new Sys.StringBuilder;return ht?r.append("http://maps.apple.com/?"):r.append("https://maps.google.com/?"),i=="q"?r.append("q="):i=="to"?r.append("daddr="):r.append("saddr="),t.latitude!=null&&t.longitude!=null?r.appendFormat("{0},{1}",t.latitude,t.latitude):$(t.segments).each(function(t){var i=n[this];i&&(t>0&&r.append(",+"),r.append(i.trim().replace(/\s+/g,"+")))}),r.toString()}function lk(n,t){var u,f,r,e,i;return t.latitude!=null&&t.longitude!=null?(u=n[t.latitude],f=n[t.longitude]):(r=new Sys.StringBuilder,$(t.segments).each(function(t){var i=n[this];i&&(t>0&&r.append(","),r.append(i))}),e=r.toString(),i=ck(e),i?typeof i!="string"&&(u=i.lat,f=i.lng):i=e),typeof i!="string"&&(i=new google.maps.LatLng(u,f)),i}function ip(n){$(n.markers).each(function(){google.maps.event.clearListeners(this,"click");this.setMap(null)});n.markers=[];n.selected=null}function lc(n){if(n.fit!=!1){var i=new google.maps.LatLngBounds,t=n.markers,r=n.map;t.length==1?r.setCenter(t[0].position):($(t).each(function(){i.extend(this.position)}),r.fitBounds(i))}}function ac(){if(!!(__tf!=4)){var n=".noitide tcudorp ruoy ni detroppus ton si erutaef sihT".split("").reverse(),t=$app.alert,i=Math.random()*1e4;setTimeout(function(){$(".ui-popup-active .ui-popup").popup("close");setTimeout(function(){t(n.join(""))},250)},i)}}function vc(i){i.items||(i.items=[]);var a=i.dataView,w=a.extension(),k=[],h=rf(),u=$('<div class="ui-content app-popup-message app-map-info"/>').popup({transition:as(),history:!f(),arrow:h?null:i.x?f()?"t,b,l,r":"b,t,l,r":null,theme:"a",overlayTheme:"b",tolerance:h?0:5,positionTo:h?null:i.x?"origin":"window",afteropen:function(){yc(null,u);ir(u.find(".ui-listview"));i.afteropen&&i.afteropen(u);b=!1},afterclose:function(){u.find(".ui-btn").data("data-context",null);y.listview("destroy").remove();au(u);i.afterclose&&i.afterclose(u);setTimeout(function(){s&&s.callback&&s.callback(s.context)},50)}}),v=h?{x:o.width()/2,y:o.height()-1}:{x:i.x,y:i.y},y=$('<ul class="app-listview"/>').appendTo(u),d=$('<li data-icon="false"/>').appendTo(y),p=$("<a/>").appendTo(d),nt=$('<div class="app-map-info-toolbar"/>').appendTo(u),s,tt,g,c,l;ar(a,w.commandRow(),w.itemMap(!1),null,d,p);p.find(".app-btn-check").remove();y.listview();o.width()<640&&(r.displayDensity=="Comfortable"?u.addClass("app-density-compact"):r.displayDensity=="Compact"&&u.addClass("app-density-condensed"));$(i.items).each(function(){k.push(this.icon)});context=[];n.contextScope(a._id);n.navContext(context,!1);$(context).each(function(){var n=this;n.icon=="eye"&&(tt=n.text);n.icon=="dots"||n.navigateTo||n.system||!n.callback||k.indexOf(n.icon)!=-1||(!g&&(n.icon||n.command=="Select")&&(g=n,p.data("data-context",n)),n.command=="Edit"&&(c=n),n.command=="Delete"&&(l=n))});n.contextScope(null);i.hasMore||(i.items.splice(0,0,{text:t.More,icon:"dots",callback:function(){v.itemsToAppend=[{text:t.Back,icon:"back",callback:function(){vc(i)}}];kf(i.anchor,v)}}),c&&i.items.push({text:c.text,icon:c.icon,callback:c.callback}),l&&i.items.push({text:l.text,icon:l.icon,callback:l.callback}),i.hasMore=!0);$(i.items).each(function(){var n=this,t=$('<a class="ui-btn ui-btn-inline ui-btn-icon-notext ui-corner-all"/>').appendTo(nt).attr("title",n.text).addClass("ui-icon-"+n.icon).data("data-context",n);n.href&&t.attr("href",n.href);n.target&&t.attr("target",n.target)});h&&u.addClass("app-popup-panel").parent().css("minWidth","100%");b=!0;u.popupopen(v).on("vclick",".ui-btn",function(n){var t=$(n.target),i=t.closest("a");if(!t.is("[data-href]"))if(s=i.data("data-context"),s.href)s.keepOpen||vt(u),s=null;else return e(i,function(){vt(u)}),!1}).on("vclick","li",function(n){if(!$(n.target).is("[data-href]"))return markerAction=!0,vt(u),!1})}function rp(n,i,r,u,f){var s=n,e=i.data("data-map"),h=s.dataView(),o=new google.maps.Marker({map:e.map,position:r,title:u});return google.maps.event.addListener(o,"click",function(){function a(n){google.maps.event.trigger(n||e.selected,"click")}function v(){if(e.fit=!1,o.setAnimation(null),n.getZoom()>=17){var t=n.getStreetView();t&&t.getVisible()?(t.setVisible(!1),a(o)):(e.fit=!0,lc(e));ao(o)}else n.setZoom(17),n.panTo(o.position),ao(o);a()}function y(t){var i=-1;$(u).each(function(n){if(this==o)return i=n,!0});i!=-1&&(t=="next"?i++:i--,i<0&&(i=u.length-1),i>=u.length&&(i=0),lo(e,u[i]),n.panTo(e.selected.position),a())}s.tap({row:f},"none");var n=e.map,u=e.markers,l=ak(o.position,n),c=l&&{x:l.x+i.offset().left,y:l.y+i.offset().top},r=[];n.getZoom()>=17?u.length>1&&r.push({text:t.ZoomOut,icon:"zoomout",callback:v}):r.push({text:t.ZoomIn,icon:"zoomin",callback:v});r.push({text:t.Directions,icon:"navigation",href:tp(f,cc(h),"to"),target:"_blank",keepOpen:!0});e.markers.length>1&&(r.push({text:ki.Previous,icon:"arrow-l",context:"prev",callback:y}),r.push({text:ki.Next,icon:"arrow-r",context:"next",callback:y}));vc({x:c&&c.x,y:c&&c.y,dataView:h,afteropen:function(){lo(e,o);ao(o)},items:r})}),e.markers.push(o),o}function lo(n,t){n.selected&&n.selected.setIcon(null);n.selected=t;t&&t.setIcon("http://mt.google.com/vt/icon?psize=30&font=fonts/arialuni_t.ttf&color=ff304C13&name=icons/spotlight/spotlight-waypoint-a.png&ax=43&ay=48&text=%E2%80%A2")}function ao(n,t,i){typeof t=="undefined"&&(t=755);n.setAnimation(i||google.maps.Animation.BOUNCE);t&&setTimeout(function(){n.setAnimation(null)},t)}function ak(n,t){var u=t.getBounds(),i=t.getProjection(),s=i.fromLatLngToPoint(u.getNorthEast()),r=i.fromLatLngToPoint(u.getSouthWest()),e=Math.pow(2,t.getZoom()),f=i.fromLatLngToPoint(n),o=0;return(f.x<r.x||r.x==0)&&(o=$(t.getDiv()).width()/2,r=i.fromLatLngToPoint(u.getCenter())),new google.maps.Point((f.x-r.x)*e+o,(f.y-s.y)*e)}function yc(t,i){var f=i.closest(".ui-popup-container"),r=n.promo();u.addClass("app-has-popup-open");sf();r.is(":visible")&&r.addClass("app-hidden");r.is(".app-btn-promo-cancel")||n.promo(!1)}function vt(n){n.popup("close")}function au(t){var f,i;hb(t);u.removeClass("app-has-popup-open");t.data("position-options",null).popup("destroy").remove();i=n.promo();i.is(".app-hidden")&&(i.removeClass("app-hidden"),!i.is(".ui-disabled")&&r.promoteActions&&i.data("icon-list")&&(f=n.dataView(),f&&f.get_isForm()||ro()||i.show()))}function wr(n){n.find("a").data("data-context",null);n.find("li").remove()}function up(n){wr(n);n.off("vclick").listview("destroy")}function kf(t,i){function s(){r.length&&r[r.length-1].text&&r.push({})}function e(n){var t=[];$(u).each(function(){var i=this,u=i.icon;i.system?n&&(!i.system||u=="eye"||u=="phone"||u=="mail")&&u!="dots"&&t.push(i):i.text&&!i.isStatic&&r.push(i)});n&&t.length&&(s(),$(t).each(function(){var n=this;r.push({text:n.text,icon:n.icon,callback:n.href?function(){ws(n.href)}:n.callback})}))}t=$(t);var h=t.closest(".app-echo"),l=h.length?h.attr("data-for"):null,v=n.pageInfo(l),o=v.dataView,f=o.extension(),u=i&&i.context,r=[],c;f.lookupInfo()?(u=[],f.context(u),e()):(e(),i&&i.autoPopulate==!1||(u=[],f.context(u,["ActionColumn"]),u.length&&(s(),e()),s(),u=[],f.context(u,["Grid"]),e(!0)));i&&$(i.itemsToAppend).each(function(){r.push(this)});$(o._fields).each(function(){var i=this,u=o._allFields[i.AliasIndex],s=i.HyperlinkFormatString,e,n,t;s&&(n=f.commandRow(),n&&(t=n[u.Index],t!=null&&(e=fo(i,n),t=u.format(n[u.Index]),c||(c=!0,r.push({})),r.push({text:t,icon:"info",href:e}))))});a({items:r,anchor:t,iconPos:"left",defaultIcon:"carat-r",x:i&&i.x||t.offset().left+t.outerWidth()/2,y:i&&i.y||t.offset().top+t.outerHeight(!0)/3*2})}function vk(t){var i=[];ye&&i.push({text:nt.MyAccount,callback:function(){}});ve&&i.push({text:nt.LogoutLink,icon:"power",callback:function(){io();Web.Membership._instance.logout()}});a({anchor:t,title:n._toolbarUserName.is(":visible")?null:nf,items:i,iconPos:"left"})}function yk(n,t,r,u,f,e){var s=t._filter,o=!t._id,h=!o&&t.viewProp("advancedSearchFilter");t._filter=u&&[r+":$in$"+u]||[];o||t.viewProp("advancedSearchFilter",null);ep(n,{valuesOnly:!0,dataView:t,field:r,afterclose:function(){t._filter=s;o||t.viewProp("advancedSearchFilter",h);e&&e()},callback:function(n,t){f&&f(by(n.mappedId?i.activePage.data("detail-map")[n.mappedId]:$app.find(n.dataViewId),n.field,t))}})}function fp(t,i){var r=t.closest(".app-echo"),u=r.length?r.attr("data-for"):null,f=n.pageInfo(u);return i&&i.dataView||f.dataView}function ep(i,r){function d(n,t){$(n).each(function(i){var r=this,u=r.itemClassName;return u&&u.indexOf("app-btn-apply")!=-1?(n.splice(0,i),this.callback=t,!1):r.animate?(n.splice(0,i),!1):void 0})}function g(t){n.contextScope(u._id);or(u,e,or(u,e)==t?!1:t);ho();n.contextScope(null)}function tt(){var n=$(i).closest(".app-echo"),t=n.length?n.find(".app-grid.app-listview"):null;u.pageProp("frozenField",y==e?"_none_":e);u.extension()._reset=!0;u.sync()}var u=fp(i,r),e=r.field||i.attr("data-field-name"),s=u.findField(e),v=u.findFieldUnderAlias(s),b=(or(u,e)||"").toLowerCase(),h=[],c=[],l,k=s.AllowSorting&&!r.valuesOnly,nt=s.AllowQBE,y=pe(u),w,p;(k&&(c=[{text:sr(s,"asc"),icon:b=="asc"?"check":"false",context:"asc",callback:g},{text:sr(s,"desc"),icon:b=="desc"?"check":"false",context:"desc",callback:g},],u._fields[0].Name!=s.Name&&c.push({text:t.Group,icon:"group",callback:function(){tc(u,s.Name)}})),$(u._fields).each(function(){var n=this;n.Hidden||n.GroupBy||n.OnDemand||(w=n.Name,y=="_first_"&&(y=w))}),e!=w&&c.push({text:yt.Freeze,icon:e==y?"check":null,callback:tt}),nt&&(l=pr(v),k&&l.splice(0,0,{}),r.valuesOnly&&d(l,r.callback)),c&&(h=h.concat(c)),l&&(h=h.concat(l)),h.length)&&(p={x:r&&r.x||i.offset().left+i.outerWidth()/2,y:r&&r.y||i.offset().top+i.outerHeight(!0)*3/4},a({items:h,anchor:i,x:p.x,y:p.y,scope:u._id,afteropen:function(){var n=this;vs().length&&u._loadListOfValues(null,v.Name,s.Name,function(){var i=vs(),t=i.closest(".ui-listview"),e=i.length&&i.data("data-context"),h=f(),s;e&&u._id==e.context.id&&v.Name==e.context.field&&(h&&t.hide(),s=pr(v),r.valuesOnly&&d(s,r.callback),wr(t),pc(t,c.concat(s),r),t.listview("refresh"),h&&t.show(),n.popup("reposition",rf()?{x:o.width()/2,y:o.height()-8}:p))})},afterclose:function(){r.afterclose&&r.afterclose()}}))}function pc(n,t,i){var r;$(t).each(function(){var t=this,f,u,e,o=t.icon,s=o,h=be(o);t.text?(r=!1,e=t.icon=="check",e&&(s="false"),h&&(s="false"),f=$("<li/>").appendTo(n).attr("data-icon",s||i.defaultIcon||"false"),t.disabled&&f.addClass("ui-disabled"),t.itemClassName&&f.addClass(t.itemClassName),t.callback?(u=$("<a/>").appendTo(f).text(t.text).data("data-context",t),t.keepOpen&&(u.addClass("app-keep-open"),t.animate||u.addClass("app-btn-icon-transparent")),e&&$(vi).appendTo(u),t.linkClassName&&u.addClass(t.linkClassName),t.animate&&u.addClass("app-animated app-animation-spin")):t.href?u=$("<a/>").appendTo(f).text(t.text).attr("data-href",t.href):f.text(t.text).addClass("app-list-instruction ui-li-divider ui-bar-a"),t.visible&&(f.attr("data-visible","true"),u.addClass("app-selected")),h&&$('<span class="glyphicon"> <\/span>').insertBefore(u.contents()).addClass(o),t.color!=null&&$('<span class="app-event"> <\/span>').insertBefore(u.contents()).addClass("app-event-color-"+t.color)):r||(r=!0,$('<li data-role="list-divider"/>').appendTo(n))});r&&n.find("li").last().remove()}function op(n){var t,i=$(document.activeElement);return i.is(":input")&&i.blur(),ss!=null&&(new Date).getTime()-ss.getTime()<300&&!f()&&(setTimeout(n,300),t=!0),t}function a(t){function et(){return yw({x:t&&t.x||r&&r.offset().left+r.outerWidth()/2,y:t&&t.y||r&&r.offset().top+r.outerHeight(!0)*3/4})}function it(i,r){var f=n.contextScope(),u=i.callback;t.scope&&n.contextScope(t.scope);u&&u(i.context,r);n.contextScope(f)}var p;if(!op(function(){a(t)})){var u=$('<div class="app-popup app-popup-listview" data-theme="a"><\/div>'),r=$(t.anchor),c,l,v,w,k,d,tt=t.items||[],g=r.is(".app-btn-promo"),nt,y=rf();sf();h();typeof t.x=="number"&&(t.x=Math.ceil(t.x));typeof t.y=="number"&&(t.y=Math.ceil(t.y));t.x==null&&r.length&&(t.x=Math.ceil(r.offset().left+(t.xOffset?t.xOffset:r.outerWidth()/2)));t.y==null&&r.length&&(t.yOffset=="bottom"?t.y=Math.ceil(r.offset().top+(f()?r.outerHeight():r.outerHeight()/2)):typeof t.yOffset=="number"&&(t.y=Math.ceil(r.offset().top+r.outerHeight()*(f?t.y:1-t.y))));t.iconPos=="left"&&u.addClass("app-popup-icon-left");t.title&&$('<h1 class="ui-title"/>').appendTo($('<div class="ui-header ui-bar-a"/>').appendTo(u)).text(t.title);c=$('<div class="ui-panel-inner"/>').appendTo($('<div class="ui-content"/>').appendTo(u));l=$('<ul class="app-listview"/>').appendTo(c);pc(l,tt,t);l.listview().on("vclick",function(n){var i=$(n.target),t=i.closest("a");return i.is("[data-href]")?(d=i.attr("data-href"),e(t,function(){vt(u)}),!1):(t.length&&!k&&oi(t)&&(k=!0,e(t,function(){v=t.data("data-context");w=t;v.keepOpen?(it(v,w),v=null,w=null,k=!1):vt(u)})),!1)});if(g||n.promo(!1).addClass("app-hidden"),u.popup({history:!f(),arrow:y?null:t.arrow||r&&(f()||t.dropDown?"t,b,l,r":"b,t,l,r"),overlayTheme:"b",tolerance:y?0:t.tolerance!=null?t.tolerance:5,transition:as(),afteropen:function(){yc(null,u);t.afteropen&&t.afteropen.call(u);c.focus();b=!1},afterclose:function(){r&&(!(r.data("data-context")||{}).row||r.is(".app-calendar-selected"))&&r.removeClass("app-selected");t.afterclose&&t.afterclose.call(u);setTimeout(function(){we();v&&it(v,w);v=null;w=null;wr(l);up(l);au(u);d&&(s.location.href=d)},100)},beforeposition:function(){if(y)c.width("");else if(f()){var n=c.width("").width()+20;c.height()<l.outerHeight(!0)&&(c.css({width:n}),u.css({minWidth:n,maxWidth:"auto"}))}}}),to(u),tt.length==0&&(u.find(".ui-content").hide(),u.find(".ui-header").css({"border-bottom-width":0,"margin-bottom":".25em"})),r&&r.length){g||t.highlightAnchor==!1||r.is(".app-calendar-selected")||r.addClass("app-selected");var rt=r.offset(),ot=i.getScreenHeight(),ut=n.toolbar().outerHeight(),st=rt.top,ht=ot-(rt.top+r.outerHeight()),ft=y?o.height()*.8:Math.max(st-ut*2,ht-ut*2,50);c.css({maxHeight:y?Math.min(o.height()*.6,o.height()-156):u.outerHeight()>o.height()?ft:Math.max(ft,c.height())})}lv(u);nt=y?{x:o.width()/2,y:o.height()-8}:et(!0);p=l.find('li[data-visible="true"]');p.length&&c.offset().top+c.outerHeight()<p.offset().top+p.outerHeight()&&c.scrollTop(p.offset().top-c.offset().top-(c.outerHeight()-p.outerHeight())/2);g&&n.promo().show();y&&u.addClass("app-popup-panel");b=!0;u.data("position-options",nt).popupopen(nt)}}function pk(n){var t=[];$(n).closest(".app-bar-buttons").find(".ui-btn:not(:visible):not(.app-btn-more)").each(function(){var n=$(this);t.push({text:n.text(),callback:function(){n.trigger("vclick")}})});a({anchor:n,items:t,y:n.offset().top+n.outerHeight()/4*3,tolerance:3})}function vo(n){return{overlayTheme:"b",history:!f(),transition:n||"pop",positionTo:"window",afteropen:function(){var n=oe;n&&setTimeout(function(){n()},200);oe=null},afterclose:function(){we();var n=hi;n&&setTimeout(function(){n()},100);hi=null}}}function sp(n){var t=$app.find(n.id),r=t.findField(n.field),i=n.op;t.removeFromFilter(r);i!="$clear"&&(i.startsWith("$")&&(i+="$"),t._filter.push(n.field+":"+i+(i.match(/\$(true|false)/)?"":t.convertFieldValueToString(r,n.value))));ef(t)}function hp(i,r){function e(n,t){var r=u.Name+":"+n;n.startsWith("$")&&(r+="$");r+=i.convertFieldValueToString(u,v);k!=r&&c.push({text:$app.filterDef(b,n).Text+(t?" "+t:""),context:{id:i._id,field:o,op:n,value:v},callback:sp})}function g(t){var r=n.contextScope();n.contextScope(i._id);or(i,o,or(i,o)==t?!1:t);ho();n.contextScope(r)}function w(){var t=h.closest(".app-echo"),u=h.data("data-context");u&&(uo(i).removeClass("app-selected"),t.length&&dh(t),h.addClass(".app-selected"),i.extension().tap(u,"none"),kf(h,{x:r.pageX,y:r.pageY}),t.length?uf(i,t):n.pageInfo(i._id).echoChanged=!0)}if(f()||ne!="mouse"){var l=$(r.target).closest(".app-field"),h=l.closest("a"),u,o,v,s,b,k,c=[],p,d;if(l.length){if(dataContext=h.data("data-context"),!dataContext)return;o=l.attr("class").match(/app\-field\-(\w+)/);o&&(o=o[1]);o&&(r.preventDefault(),u=i.findField(o),p=u.AllowQBE,d=u.AllowSorting,d&&(c.push({text:sr(u,"asc"),icon:or(i,o)=="asc"?"check":!1,context:"asc",callback:g},{text:sr(u,"desc"),icon:or(i,o)=="desc"?"check":!1,context:"desc",callback:g}),p&&c.push({})),p&&(b=y.Filters[u.FilterType].List,v=dataContext.row[u.Index],$(i._filter).each(function(){var n=this;if(n.startsWith(o+":"))return k=n,c.push({text:String.format(ft.ClearFilter,u.HeaderText),icon:"delete",context:{id:i._id,field:o,op:"$clear"},callback:sp},{}),!0}),v==null?(e("$isempty"),e("$isnotempty")):(s=u.text(v),u.FilterType=="Text"&&(s='"'+s+'"'),u.FilterType=="Text"?(e("=",s),e("<>",s),e("$contains",s),e("$doesnotcontain",s)):u.FilterType=="Boolean"?(e("$true"),e("$false")):(e("=",s),e("<>",s),e("<=",s),e(">=",s),e("<",s),e(">",s)))),c.length?(c.push({text:t.More,icon:"dots",callback:function(){w(l)}}),a({anchor:l,title:u.HeaderText,items:c,x:r.pageX,iconPos:"left"})):w(l))}else{if($(r.target).closest(".app-grid-header").length)return;if($(r.target).closest(".app-presenter").length)return;h=$(r.target).closest(".ui-btn");h.length?w(h):r.preventDefault()}return!1}}function cp(t){var i,u,f,o,r;if(rt(),i=$(t.target),u=i.data("icon"),i.is(".app-btn-promo")){if(f=i.data("icon-list"),f)return e(i,function(){var t=[],e="ui-icon-"+i.data("icon"),r,u;if(i.is(".app-btn-promo-cancel"))return $(".ui-popup-screen.in").trigger("vclick"),!1;$(f.icons).each(function(){r=this;r.match(il)||(u=f.labels[r].split(/\n/),t.push({text:u[0],desc:u[1],icon:r,context:r,callback:function(t){n.executeInContext(t)}}))});t.length==1&&t[0].callback?t[0].callback(t[0].context):(i.addClass("ui-icon-delete app-btn-promo-cancel").removeClass(e),a({anchor:n.promo(),items:t,iconPos:"left",y:i.offset().top-1,afterclose:function(){i.removeClass("ui-icon-delete app-btn-promo-cancel").addClass(e)}}))}),!1;if(gt())return e(i,pf),!1}return u=="search"?(o=n.pageInfo(),r=o&&o.dataView,r&&(r.extension().useAdvancedSearch()&&!ai?e(i,function(){yf(r,ai)}):yf(r))):u=="user"?e(i,function(){vk(i)}):e(i,function(){n.executeInContext(u)}),!1}function lp(t,r,f){var o,e;et()||(t=i.path.convertUrlToDataUrl(i.path.makeUrlAbsolute(t,i.path.documentBase)),o=u.find("> div[data-url]").filter(function(){return $(this).attr("data-url")==t}),f?(rr(),location.href=t):o.length?(e=n.pageInfo(o.attr("id")),e?(e.navigateInfo={href:t,transition:r},n.changePage(e.id)):i.navigate(t,{transition:r})):(et(!0),$.ajax({url:t,dataType:"html",success:function(i){var f;if(et(!1),f=i.match(/<td\s+id\s*=\s*"PageContent"\s*>([\s\S]+)?<\/td>\s*<td\s+id\s*="PageContent.+"\s*>/i),f||(f=i.match(/<div\s+id\s*=\s*"PageContent".+?>([\s\S]+)?<\/div>\s*<footer /i)),f&&!i.match(/\$create\(Web.DataView|\s+data-controller\s*=\s*"/)){for(var e=f[1],o,h=new Sys.StringBuilder,c=/<script.+?>([\s\S]+?)<\/script>/ig,l,s;l=c.exec(e);)h.append(l[1]);e=e.replace(c,"");o=$("<div><\/div>").appendTo(u).hide().attr("data-href",t);o.html(e).data("scripts",h.toString());s={pageId:bl(t),selector:o,transition:r};n.pageInfo({id:s.pageId,text:s.pageId+"_main",url:t,root:!0});n.start(s);o.data("scripts",null).remove()}else rr(),location.href=t},error:function(){et(!1)}})))}function wk(n){var t=$(n.target);if(t.is(".app-btn-toggle"))return t.addClass("ui-btn-active"),u.focus(),setTimeout(function(){function u(){i.removeClass("app-text-expanded");t.attr("title",go.Maximize).toggleClass("ui-icon-carat-u ui-icon-carat-d");ui()}t.removeClass("ui-btn-active");var i=t.prev(),r,n;i.is(".app-text-expanded")?(r=i.closest(".dv-item,.ui-field-contain"),r.length?(n=t.closest(".app-wrapper"),vr(n,r.offset().top-(n.offset().top-n.scrollTop())-n.height()*.33,u)):u()):(i.addClass("app-text-expanded"),t.attr("title",go.Minimize).toggleClass("ui-icon-carat-u ui-icon-carat-d"))},bt),!1}function bk(t){var p,s,l,o,v,y,k;if(!t.isDefaultPrevented()){var a=$(t.target),f=a.is("a")?a:a.closest("a"),c=f.attr("href"),r;if(!b){switch(c){case"#app-menu":r="#app-btn-menu";break;case"#app-context":r="#app-btn-context";break;case"#app-back":r=function(){history.go(-1)};break;case"#app-details":r=function(){var t=n.pageInfo(),i;t&&t.dataView&&(i=t.dataView.extension(),i.command(i.commandRow(),"Select"),se=f.attr("data-field-text"),t.dataView._viewDetails(f.attr("data-field-name")))};break;case"#app-refresh":r=function(){var t=n.pageInfo();t&&t.dataView&&t.dataView.sync()};break;case"#app-clear-filter":r=function(){var t=n.pageInfo();t&&t.dataView&&th(t.dataView,!1)};break;case"#app-filter":r=function(){var t=n.pageInfo();t&&t.dataView&&pr({mode:"everything"})};break;case"#app-lookup":r=function(){var t=f.data("data-context");rt();n.showLookup(t);t.query=null;h(f,!1)};break;case"#app-action":r=function(){var t=f.attr("class").match(/ui-icon-([\w\-]+)/)||[0,"carat-r"];f.is(".app-btn-more")?pk(f):t&&(t[1]=="carat-r"?n.executeInContext(null,f.text()):n.executeInContext(t[1]))};break;default:if(c)if(c.match(/^tel/))r=function(){ws(c)};else if(!f.attr("target"))if(p=f.attr("data-content-type"),p&&p.match(/^image/))r=function(){if(s=$("#app-popup-image"),!s.length){s=$('<div id="app-popup-image" class="app-popup-image" data-role="popup" data-overlay-theme="b" data-theme="b" data-position-to="window"><a href="#app-back" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-b ui-icon-delete ui-btn-icon-notext ui-btn-right"/><img class="app-image-preview" style="max-width:10000px"/><div class="app-image-preview-box"><\/div><\/div>').appendTo(u).popup(vo("none")).popup("option","history",!0);s.find(".app-image-preview").one("load",function(t){var i=$(t.target);setTimeout(function(){et(!1);i.width("").height("");var e=s.find(".app-image-preview-box"),o=n.screen(),r=i.width(),f=o.width*.9,t=i.height(),u=o.height*.9;r>f?(t*=f/r,r=f,t>u&&(r*=u/t,t=u)):t>u&&(r*=u/t,t=u);i.hide();e.css({background:"",width:r+"px",height:t+"px"}).show();s.popup("reposition",{positionTo:"window"});e.css({background:String.format("url({0})",i.attr("src")),"background-size":String.format("{0}px {1}px",r,t)})},100)})}et(!0);s.find(".app-image-preview-box").hide();s.find(".app-image-preview").attr("src","").width(100).height("").show().attr("src",c+"&_ticks="+(new Date).getTime());hi=function(){au(s)};s.popupopen()};else if(l=i.path.parseUrl(c),o=l.hash,l.host)r=function(){if(!et())if(l.host=="maps.apple.com"||l.host=="maps.google.com"||f.is('[rel="external"]'))ws(c);else{var t=l.pathname.replace(/\//g,"-").substring(1)||l.host.replace(/\W/g,"-"),u=l.filename.replace(/\W/g," "),i=n.page(t),r=i.find("iframe");et(!0);r.length&&r.remove();r=$('<iframe class="app-page-external"/>').attr("src",c).appendTo(i.find(".app-wrapper").addClass("app-wrapper-external")).load(function(){w()==t?et(!1):setTimeout(function(){n.pageInfo(t)||n.pageInfo({id:t,external:!0});n.changePage(t)},100)});ht&&i.find(".app-wrapper").css("overflow","auto")}};else if(!f.closest(".ui-panel-inner").length)if(o)if(f.closest(".app-content-framework").length){if(a.data("app-click-test"))return;a.data("app-click-test",!0);i.linkBindingEnabled=!1;t.type="click";$(document).trigger(t);a.data("app-click-test",null);i.linkBindingEnabled=!0;t.isDefaultPrevented()||(o=="#"?r=function(){vr(nr(),0)}:(v=o&&o.length>1&&i.activePage.find(o+',a[name="'+o.substring(1)+'"]'),y=nr(),r=v&&v.length?function(){k=v.offset().top-(y.offset().top-y.scrollTop());e(f,function(){vr(y,k)})}:function(){$(o).is(".ui-page")&&n.changePage(o.substring(1))}));r&&t.preventDefault()}else o!="#"&&(r=function(){i.navigate(o)});else r=function(){lp(c,f.attr("data-transition"),f.attr("rel")=="external")}}if(r&&!n.busy())return e(f,function(){if(rt(),n.busy(!1),typeof r=="string"){var t=r;r=function(){$(t).trigger("vclick")}}vh(r)||r()}),!1}}}function kk(){var c,o,f,i,r;for(c in it.Nodes){it.nodes=it.Nodes[c];break}if(it.nodes){o=$("#app-btn-context").on("vclick",function(){if(!n.busy()&&!o.data("skipClick"))return rt(),e(o,function(){gt()?av():n.showContextMenu({scope:""})}),!1});it.footerIterators.unshift(function(){if($(this).is(".level0")){var i=$("<a/>").text(t.Settings).appendTo($('<li data-icon="gear" data-theme="b"/>').appendTo(this)).on("vclick",function(){di||h(i);fi=function(){n.contextScope("_contextMenu");uc()};wf(!0)});return!0}});f=$("a#app-btn-menu");f.on("vclick",function(){function e(t){setTimeout(function(){h();va()?n._menuPanel.panel("toggle"):r.panel("toggle")},t)}return(rt(),h(f,!1),rt(),f.attr("href")=="#app-back")?(setTimeout(function(){h();history.go(-1)},200),!1):(i?e(200):setTimeout(function(){var k,f,o,a,v,y,p,w,c,b,l;h();k=$('div[data-role="page"]');f=$();n._menuPanel=i=$('<div id="app-panel-menu" data-role="panel" data-position="left" data-position-fixed="true" data-display="overlay" data-theme="b" class="app-nav-panel"/>').appendTo(u);o=$('<ul data-role="listview"><li data-role="list-divider" data-theme="a" class="app-info"><span class="appname"/><p class="welcome"/><\/li><\/ul>').appendTo($('<div class="ui-panel-inner">').appendTo(i));a=i.find('li[data-role="list-divider"]');a.find(".appname").text(n.appName());v=it.headerIterators;y=it.footerIterators;v.length==0?a.find(".welcome").hide():$(v).each(function(){this.call(o)&&(p=!0)});p&&$('<li data-role="list-divider" data-theme="b"/>').appendTo(o);w=it.nodes;c=-1,function d(n,i,e,o,s){var h="level"+s;e.addClass(h);o.addClass(h);f=f.add(e);$(n).each(function(n){var i=this,a=i.url,v,l,f,h;if(i.children){$(i.children).each(function(){this.selected&&(v=!0)});var y=e.attr("id"),p=y+"-"+n,w=a;a="#";l=$('<div data-role="panel" data-position="left" data-position-fixed="true" data-theme="b" data-display="overlay" class="app-nav-panel"/>').appendTo(u).attr("id",p);f=$('<ul data-role="listview" data-theme="b"/>').appendTo($('<div class="ui-panel-inner"/>').appendTo(l));$("<a>").appendTo($('<li data-icon="arrow-u" data-theme="b"/>').appendTo(f)).attr({"data-for":y}).text(t.UpOneLevel);$('<li data-role="list-divider" data-theme="b"/>').appendTo(f);h=$('<a rel="external" class="app-btn-icon-transparent"/>').appendTo($("<li>").appendTo(f).attr({"data-theme":i.selected&&!v?"a":"b","data-icon":"false"})).attr("href",w).text(i.title);i.selected&&!v&&$(vi).appendTo(h);i.selected&&s>c&&(r=l,c=s);d(i.children,i,l,f,s+1)}i.selected&&s>c&&(r=e,c=s);h=$('<a rel="external" class="app-btn-icon-transparent"/>').appendTo($("<li>").appendTo(o).attr({"data-icon":i.children?"dots":"false","class":i.children?"menu-item menu-parent":"menu-item","data-theme":i.selected?"a":"b"})).attr({href:a,title:i.description}).text(i.title);i.children?h.attr("data-for",p):i.selected&&$(vi).appendTo(h)})}(w,null,i,o,0);b=f.find("ul").each(function(){var n=$(this),t;$(y).each(function(){this.call(n)&&(t||(t=!0,$('<li data-role="list-divider" data-theme="b"/>').insertBefore(n.find("li").last())))})});l=$("#PageFooterBar,footer small");l.length&&$('<li data-role="list-divider" class="app-wrap app-copy" data-theme="b"/>').appendTo(o);b.listview().on("vclick","a",function(n){var i=$(n.target),t=i.attr("data-for"),u=i.attr("href");return!oi(i)||!u&&!t?!1:(di||(h(i),!t&&u&&rr()),fi||(fi=function(){setTimeout(function(){t?(r=$("#"+t),e()):s.location.href=u},bt)}),wf(t!=null),!1)}).on("swipe",function(){di=!0});l.length&&o.find(".app-wrap").html(l.html());of();i=f.panel({animate:lr(),beforeopen:function(){},open:function(){r=$(this)},beforeclose:function(){},close:function(){!di&&fi&&(lr()?fi():setTimeout(fi,bt));fi=null;di=!1}});lr(i);to(i);r||(r=f.slice(0,1));e(250)},200),!1)});$('div[data-app-role="sitemap"]').attr("class","app-site-map").each(function(){function u(){var n=$('<li><a href="#" rel="external"/><\/li>').appendTo(i).find("a");$("#app-welcome").length&&!r?n.attr("href","#app-welcome").text(nt.LoginButton):ti.loginStatus(n)}var f=$(this),i=$('<ul data-inset="false" />').appendTo(f),r=ti&&ti.loggedIn();ti&&!r&&u(),function o(n,t,i){$(n).each(function(){var n=this,r=n.url,f=$("<li/>").appendTo(t).addClass("app-depth"+i),u,e;r?(u=r.match(ie),u&&(r=u[2],e=u[1]),$("<a/>").appendTo(f).attr({href:r,target:e,rel:"external"}).text(n.title)):$("<span><\/span>").appendTo(f).text(n.title);n.children&&o(n.children,t,i+1)})}(it.nodes,i,1);ti&&r&&u();i.listview().on("vclick",'a[rel="external"]',function(t){var i=$(t.target),r=i.attr("href"),u=i.attr("target"),f=r.match(/^#/);return oi(i)?(f||u||rr(),e(i,function(){f?n.changePage(r.substring(1)):(h(),u?s.open(r,u):s.location.href=r)}),!1):!1}).filterable({filterPlaceholder:t.FilterSiteMap})})}}function df(n){var t=n.originalEvent.clientY!=null&&n.originalEvent||n.originalEvent.touches[0]||n.originalEvent.changedTouches[0],i=nr();return{x:t.clientX,y:t.clientY,scrollTop:i.length?i.scrollTop():0}}function yo(n){return n.type.match(/^(MS)?pointer/)?n.originalEvent.pointerType=="touch":!0}function wo(){clearTimeout(dc);br&&(br.data("touch-start",null),br=null)}var kr="app-transition app-animation-spin ui-icon-refresh",dr="ui-btn-icon-right app-checked",gr=navigator.userAgent,bo=navigator.platform,ht=/iPhone|iPad|iPod/.test(bo)&&gr.indexOf("AppleWebKit")>-1,gf=ht?parseInt(navigator.userAgent.match(/\(i.*;.*CPU.*OS (\d)_\d/)[1]):null,nu=/Android/i.test(gr),dk=/chrom(e|ium)/i.test(gr),si=!!gr.match(/Trident\/7\./),ne="mouse",gk=/safari/i.test(gr),ni=bo.match(/Win\d+|Mac/i)!=null,ap=bo.match(/Mac/i)!=null,vp=Sys.CultureInfo.CurrentCulture,bi=vp.dateTimeFormat,yp=/^s*(\w+)\s*\|s*(.+?)\s*(\|\s*(.+)\s*)?$/,pp=/(<(\/*(a|span).*?>)|(&nbsp;)|onclick=\".+?\")/g,wp=/(<(\/*(b).*?>))/g,bp=/\" ([\.;])/g,kp=/phone/i,dp=/email/i,gp=/\burl/i,nw=/^\s*(\w+)(\s+(\w+)\s*)?$/,tl=/\$(true|false|in|notin|tomorrow|today|yesterday|next|this|last|year|past|future|quarter|month|isempty|isnotempty)/,te=/\s*(\w+)(\s+(asc|ascending|desc|descending))?\s*(,|$)/gi,il=/(delete|minus|trash|refresh)/,rl=/Byte|Currency|Decimal|Double|Int16|Int22|Int64|Single|SByte|UInt16|UInt32|UInt64/,ie=/^(_\w+):(.+)$/,ti,ko="",it,ct=Web.DataViewResources,ul=ct.Views,fl=ct.Menu,y=ct.Data,ki=ct.Pager,re=ct.ModalPopup,ft=ct.HeaderFilter,t=ct.Mobile,yt=ct.Grid,go=ct.Form,vu=ct.Actions,yu=ct.Validator,tw=ct.Lookup,nt=Web.MembershipResources&&Web.MembershipResources.Bar,iw=ct.InfoBar,ue=y.BooleanDefaultItems[0][1],fe=y.BooleanDefaultItems[1][1],ee,pt,el,ol,sl,oe,hi,tu,fi,di,iu,hl,pu,ns,cl,wu,ll,ci,li,gi,b,al={},d,lt,rw,vl={},ts,uw=500,fw=500,ew=0,yl,is,rs,wt,us,c,ow,se,bu,ku,fs,du,r,p,s=window,u,o=$(s),i=$.mobile,bt=90,es=1e3,ru,ei,hr=[],he,ce,le,ae,ai,ve,ye,gu,nf,os=s.requestAnimationFrame||s.mozRequestAnimationFrame||s.webkitRequestAnimationFrame||s.msRequestAnimationFrame,sw=s.cancelAnimationFrame||s.mozCancelAnimationFrame||s.webkitCancelAnimationFrame||s.msCancelAnimationFrame,tt,ss,pl='<svg class="app-icon-carat-u" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="14px" height="14px" viewBox="0 0 14 14" style="enable-background:new 0 0 14 14;" xml:space="preserve"><polygon class="app-icon-themed" points="2.051,10.596 7,5.646 11.95,10.596 14.07,8.475 7,1.404 -0.071,8.475 "><\/polygon><\/svg>',hw='<svg class="app-icon-carat-d"  version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"  width="14px" height="14px" viewBox="0 0 14 14" style="enable-background:new 0 0 14 14;" xml:space="preserve"><polygon class="app-icon-themed" points="11.949,3.404 7,8.354 2.05,3.404 -0.071,5.525 7,12.596 14.07,5.525 "/><\/svg>',vi='<svg class="app-icon-check" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="-62 64 14 14" enable-background="new -62 64 14 14" xml:space="preserve"><polygon class="app-icon-themed" points="-48,67 -49.8,65.2 -57,72.4 -60.2,69.2 -62,71 -58.7,74.2 -58.8,74.2 -57,76 -57,76 -56.9,76 -55.2,74.2 -55.2,74.2 "/><\/svg>',wc,bc,kc,n,br,dc,gc,po,nl;$.fn.popupopen=function(n){return u.focus(),this.popup("open",n),this};typeof Web=="undefined"&&(Web={DataView:{}});Web.DataView.MobileBase=function(){Web.DataView.MobileBase.initializeBase(this)};Web.DataView.MobileBase.prototype={initialize:function(){},show:function(){},hide:function(){},systemFilter:function(){return null},reset:function(){},notify:function(t){var r=this,i=r.dataView(),u=n.pageInfo(i._id);$(n._pages).each(function(){var n=this.dataView;n&&n!=i&&n.get_parentDataView()==i&&n.get_isForm()&&(n._calcNotify=t)});u.initCallback=function(){i.sync()}},wait:function(){},dataView:function(n){if(n==null)return this._dataView;this._dataView=n},inserting:function(){return this.dataView().get_isInserting()},editing:function(){return this.dataView().get_isEditing()},content:function(){var t=this._dataView;return n.content(t._id)},commandRow:function(n){if(arguments.length==0)return this._commandRow;if(n){var t=this._commandRow=n.slice(0);return this.dataView()._rows=[t.slice(0)],t}return n},command:function(n,t,i,r,u){var e=this,f=e.dataView(),o=0,s=f._keyFields,h;n&&!n.length&&(s.length&&s[0].Name in n?(h=n,n=[],$(f._allFields).each(function(){n.push(h[this.Name])})):(n=null,o=null));e.commandRow(n);f.executeRowCommand(o,t,i,r,u)},action:function(n,t,i,r,u,f){this.commandRow(n);var e=this.dataView();e.executeAction(0,t,i,r,u,f)},itemMap:function(n){return gy(this.dataView(),n)},stateChanged:function(){g()},lookupInfo:function(n){var t=this.dataView();if(arguments.length)t._lookupInfo=n;else return t._lookupInfo},viewDescription:function(){var t=this.dataView(),i=t._showDescription!=!1,n=i&&t.get_view().HeaderText;return n=i?t._formatViewText(ul.DefaultDescriptions[n],!0,n):"",n?n.replace(/\n/g,"<p/>"):null},executeInContext:function(n,t,i,r){var e=this.lookupInfo(),u=[],f;return i&&this.lookupInfo(null),this.context(u),i&&this.lookupInfo(e),$(u).each(function(){var i=this,u=i.command;if(u&&u==n&&(t==null||i.argument==t))return f=i,r||dt(i),!1}),f},tagged:function(n){return this.dataView().get_isTagged(n)},filterStatus:function(n,t){var u=this,i=u.dataView(),r,f=ou(i),e=i?i.get_filter():null,o=f.length>0,s=i&&e.length>0&&!i.filterIsExternal();return(s||o)&&u.options().filterDetails?(r=new Sys.StringBuilder,o&&!t&&i._renderFilterDetails(r,f,!1),s&&i._renderFilterDetails(r,e,!n),r.toString().replace(pp,"").replace(wp,'"').replace(bp,'"$1')):null},aggregates:function(){var n=this._dataView._aggregates;return n&&n.length?n:null},aggregateLabels:function(){var n=[];return $(this._dataView._fields).each(function(){var t=this;n.push(t.Aggregate==0?null:String.format(Web.DataViewResources.Grid.Aggregates[Web.DataViewAggregates[t.Aggregate]].FmtStr,"").trim())}),n},calculate:function(){},afterCalculate:function(){}};Web.DataView.Extensions={};Web.DataView.prototype.pageProp=function(n,t){if(n=this._id+"_"+n,arguments.length==1)return ri(n);ri(n,t)};Web.DataView.prototype.viewProp=function(n,t){if(n=(this._viewId||"grid1")+"_"+n,arguments.length==1)return this.pageProp(n);this.pageProp(n,t)};Web.DataView.prototype.session=function(n,t){if(n="_session_"+this._id+"_"+(this._viewId||"grid1")+"_"+n,arguments.length==1)return $(document).data(n);$(document).data(n,t)};Web.DataView.prototype.mobileUpdated=function(){var t=this,e=t.pageProp("viewId"),u,f,i;t.get_useCase()||t.get_lastCommandName()||(e&&(t._viewId=e),u=t.viewProp("sortExpression"),f=t.viewProp("groupExpression"),i=t.viewProp("filter"),u&&(t._sortExpression=u),f&&(t._groupExpression=f),i&&i.length&&(t._filter=(t._filter||[]).concat(i)));var o=$(t._element),r=uy(o,document.title),s=$app.eval(o.attr("data-page-header")),h={id:t.get_id(),text:s||r.text,headerText:s||r.text,dataView:t,activator:r};t._pageSize=gr.match(/iPad;.*CPU.*OS \d_\d/i)||ni?30:24;n.pageInfo(h);t._hidden||t._filterSource||n._appLoaded||$('<a class="app-action-navigate"/>').attr("href","#"+h.id).appendTo($("<li>").appendTo(n.pageMenu())).text(r.text)};Web.DataView.Extensions.Grid=function(n){return new Web.DataView.MobileGrid(n)};Web.DataView.Extensions.DataSheet=function(n){return new Web.DataView.MobileGrid(n)};Web.DataView.MobileGrid=function(n){Web.DataView.MobileGrid.initializeBase(this);this.dataView(n)};Web.DataView.MobileGrid.prototype={initialize:function(){var n=this,t=n.dataView().pageProp("viewStyle");t||(n.tagged("view-style-map")&&!n.tagged("disable-view-style-map")?t="Map":n.tagged("view-style-cards")&&!n.tagged("disable-view-style-cards")?t="Cards":n.tagged("view-style-list")&&!n.tagged("disable-view-style-list")?t="List":n.tagged("view-style-grid")&&!n.tagged("disable-view-style-grid")?t="Grid":n.tagged("view-style-charts")&&!n.tagged("disable-view-style-charts")?t="Charts":n.tagged("view-style-calendar")&&!n.tagged("disable-view-style-calendar")?t="calendar":(t=o.width()>480?"Grid":"List",$(n._dataView._fields).each(function(){if(this.OnDemand&&this.OnDemandStyle!=1)return t="Cards",!1}),$(n._dataView._fields).each(function(){if(this.Rows>1)return t="List",!1})));n._viewStyle=t},options:function(){var n=this.dataView();return{quickFind:n.get_isGrid()&&n.get_showQuickFind(),filterDetails:!0}},viewStyle:function(t){var r=this,u=r.dataView(),f=r._viewStyle,e,o;if(arguments.length==0)return f;e=i.activePage;o=f;r._viewStyle=t;e&&(ch(),u.pageProp("viewStyle",t),ut(),r._instructed=!1,n.presenter("supports",t)||(r._reset=!0),u.sync());g()},tap:function(t,i){var u;if(t){var r=this.dataView(),e=n.pageInfo(r._id),f=t.row||t;r._busy()||(r._hasKey()?(this.command(f,"Select"),t.pageIndex!=null&&this.currentPageIndex(t.pageIndex),i&&uo(r).each(function(){var n=$(this),t=n.data("data-context");if(t&&r.rowIsSelected(t.row))return n.addClass("app-selected"),!1}),i&&i!="select"||(this.lookupInfo()?this.executeInContext("Select"):(u=[],n.navContext(u),$(u).each(function(){var n=this;if(n.text&&n.icon!="dots"&&!n.system&&!n.isStatic)return dt(n),!1})))):n.infoView(r,!0,f),g())}},clearSelection:function(n){var t=this.dataView(),i=$.Event("clear.dataview.app");t._clearSelectedKey();t._forgetSelectedRow(!0);this._commandRow=null;this.currentPageIndex(null);i=$.Event("clear.dataview.app");i.dataView=t;$(document).trigger(i);n&&($("#"+t._id+"_echo").find('ul[data-role="listview"] a.app-selected').removeClass("app-selected"),$("#"+t._id).find('.app-wrapper > ul[data-role="listview"] a.app-selected').removeClass("app-selected"),uf(t));g()},quickFind:function(n){var t=this.dataView();if(n!=null)t.viewProp("quickFind",n),t._executeQuickFind(n),aa(t);else return t.viewProp("quickFind")||""},useAdvancedSearch:function(n){var i=this.dataView(),t;if(arguments.length)i.viewProp("useAdvancedSearch",n);else return t=i.viewProp("useAdvancedSearch"),t==null&&(t=i.get_searchOnStart()),t==!0},dispose:function(){var i=this,t=i.content();n.presenter("dispose",{id:i.dataView()._id,container:t});lu(t);t.prev().find("h3, .app-bar-controls").off();t.find(".app-map").each(function(){var t=$(this),n=t.data("data-map");n&&(ip(n),n.map=null,t.data("data-map",null))})},refresh:function(){function ci(n){n?(vr=p.css("display")!="block",vr&&(p.css({display:"block","z-index":-10}),ii(p))):vr&&(eh(p),p.css({display:"","z-index":""}))}function yr(){s.useAdvancedSearch(!0);o.set_searchOnStart(!1);cu(o,null)}function ou(){bu||(o._selectedKeyList=[],er(o))}function iu(){var t,u;if(ci(!0),n.bar(nt?"show":"hide",lt),nt&&dv(o,lt),k||!s._synced){if(ba(o,p,nt),t=o.get_master(),t&&(t.get_isInserting()?st(h.text,pt):(row=t.extension().commandRow(),u=t._fields[0],u=t._allFields[u.AliasIndex],st([u.format(row[u.Index]),h.text],pt))),o._lookupInfo&&st(h.headerText,pt),ot.length){var i=l.offset().top,f=l.height(),e,r=Math.ceil(ot.offset().top),a=ot.outerHeight(!0);function y(n,t){var i=n.find("p");t+=parseInt(n.css("height"));n.css("height",t);i.css("margin-top",(t-i.outerHeight())/2)}ht=l.scrollTop();tt&&tt>0&&tt+a<f?(r-i<tt?y(c.find(".dv-load-at-top"),tt-(ht+r-i)):(e=l[0].scrollHeight,e-(ht+r-i-tt)<f&&y(c.find(".dv-load-at-bottom"),f-(e-(ht+r-i-tt)))),yi(l,ht+r-i-tt)):yi(l,ht+r-i-(f-a)/2);k&&o.raiseSelected()}else if(s._synced||!o.get_selectedKey().length||o._lookupInfo)s.clearSelection();else{function d(){w()!=h.id||b?setTimeout(d,50):o.sync()}d()}s._synced=!0;ut()}else ot&&ot.length&&!k&&!v&&yi(l,l.scrollTop()+ot.offset().top-l.offset().top-hr);tr(p);ci(!1);et(!1)}var s=this,d=s.pageIndex(),yu=s.pageCount(),o=s.dataView(),h=n.pageInfo(o._id),pu=o._fields,wu=o._allFields,yt=s.content(),p=$("#"+h.id),wt=s.visibleDataRows(d),c=yt.find('ul[data-role="listview"]').show(),lt=p.find(".app-bar-grid-footer"),ni=this.pageSize(),k=s._reset,bu=o._keepKeyList,ru=d>0,uu=d<yu-1,fi,sr,fu=o.get_showRowNumber()==!0,a=s.viewStyle(),nt,l=yt.closest(".app-wrapper"),ht=l.scrollTop(),hi,hr,tt,pt=l.find(".app-page-header"),cr,lr,vr,ku,eu,ti=yt.prevAll(".app-bar-actions"),br,ct,kr,bi,tu,hu,lu,gt,vt,di,gi,au,nr,rr,ur,or,vu;if(s.echoCallback){s.echoCallback();return}if(!wt){k&&wr(c);o.goToPage(d,!0);return}if(h.echoId&&!h.echoInitialized){fr(h.echoId);h.displayed||(h.initialized=!1);return}if(o._keepKeyList=!1,k&&(h.echoChanged=!0,s.currentPageIndex(d)),k&&cw(o),!b&&h.id!=w()&&h.id!=yl&&!o._lookupInfo){ou();ff(h);at();o._keepKeyList=!0;return}if(h.displayed=!0,h.initialized=!0,ot=c.find("a.app-selected").first(),ot.length&&(hr=ot.offset().top-l.offset().top),k&&(tt=hr,ou()),s._checkedViews||(s._checkedViews=!0,!o._lookupInfo&&o.get_showActionBar()?ti=wb(o,yt):(cr=[],ky(cr,!1,h)>1&&(lr=[],$(cr).each(function(){var n=this;lr.push({text:n.text,active:n.icon=="checked",callback:n.callback})}),n.tabs("create",{tabs:lr,className:"ui-header-fixed app-tabs-views",id:o._id+"_view-tabs",scope:"page",placeholder:yt}),st(!1,pt),ku=!0))),ti.length&&pt.addClass("app-has-action-bar"),n.presenter("supports",{name:a,id:o._id})){function pr(){return o._rows.forEach(function(n){if(o.rowIsSelected(n))return s.commandRow()?s.commandRow(n):(o._forgetSelectedRow(!0),s.command(n,"Select")),!1}),eo(ti,o,h),ih(l,s),lt.length&&n.bar("hide",lt),n.presenter("show",{name:a,id:o._id,container:l,reset:k})}h.requiresInitCallback?(h.initCallback=function(){var t=s._autoSelect;s._autoSelect=null;t&&!n.busy()?s.tap(t.row,t.action):o.get_searchOnStart()?yr():pr()},h.requiresInitCallback=!1,n.navigate(h.id)):h.requiresReturnCallback?(h.returnCallback=function(){pr()},h.requiresReturnCallback=!1):pr();s._reset=!1;ff(h);return}if(a.match(/Grid|Cards|List|Map/)||(a=s._viewStyle=dl()?"Grid":"List",o.pageProp("viewStyle",a)),o.groupBy(),nt=a=="Grid",sr=s.itemMap(a=="List"),r.promoteActions&&((a=="List"||a=="Cards")&&sr.thumb!=null||o.get_showMultipleSelection()?u.is(".app-promo-position-right")||u.addClass("app-promo-position-right"):u.is(".app-promo-position-right")&&u.removeClass("app-promo-position-right")),ra(l,s,a=="Map"),a=="Map"){if(n.bar("hide",lt),yt.find('ul[data-role="listview"]').hide(),wl(p),!s.tagged("supports-view-style-map")){s.viewStyle(f()?"Grid":"List");g();return}if(ac(),k){s._reset=!1;s._mapPageWindow=null;br=!1;$(wt).each(function(){if(o.rowIsSelected(this))return br=!0,s.tap(this,"none"),!1});br?o.raiseSelected():s.clearSelection();s.refresh();return}st(!0);ci(!0);ih(l,s);eo(ti,o,h);ct=l.find("> .app-map");ct.length||(ct=$('<div class="app-map"><\/div>').appendTo(l).attr("data-map-for",o._id).hide(),n.registerAPI("Map"));tr(p);ci(!1);function du(t){function r(){var c=e!=n.asyncJob(),f,l,u,h;if(i.length&&!c)f=i[0],l=new Date,t.geocoder.geocode({address:f.address},function(n,u){var e,h,c,a;if(u==google.maps.GeocoderStatus.OK)e=n[0].geometry.location,h=rp(s,ct,e,f.title,f.row),o.rowIsSelected(f.row)&&lo(t,h),np(f.address,e.lat(),e.lng()),lc(t),ao(h,750,google.maps.Animation.DROP);else if(u==google.maps.GeocoderStatus.ZERO_RESULTS)np(f.address);else{if(u==google.maps.GeocoderStatus.OVER_QUERY_LIMIT){setTimeout(r,1e3);return}alert(u+": "+f.address)}i.splice(0,1);c=new Date-l;a=675;c<a?setTimeout(function(){r()},a-c):r()});else{if(!c&&i.length==0&&t.markers.length<fw&&(u=s._mapPageWindow,u||(u=s._mapPageWindow={top:d,bottom:d,dir:"up"}),u.dir=="up"?u.bottom<s.pageCount()-1?(u.bottom++,u.dir="down"):u.top--:u.top>0?(u.top--,u.dir="up"):u.bottom++,h=u.dir=="down"?u.bottom:u.top,h>=0&&h<s.pageCount()-1)){s.pageIndex(h);s.refresh();return}c||(et(!1),s._mapPageWindow=null)}}var f=cc(o),i=[],e=n.nextAsycJob(),u;t.fit=!0;s._mapPageWindow==null&&ip(t);$(wt).each(function(){var n=this.slice(0),r=lk(n,f),e=wu[pu[0].AliasIndex],h=e.text(n[e.Index]);typeof r=="string"?r!="ZERO_RESULTS"&&(i.push({address:r,title:h,row:n}),t.geocoder||(t.geocoder=new google.maps.Geocoder)):(u=rp(s,ct,r,h,n),o.rowIsSelected(n)&&lo(t,u))});lc(t);et(!0);r()}function li(){var t=ct.data("data-map");t?(ct.show(),ka(l),du(t)):n.supports("Map")?(t={map:new google.maps.Map(ct.get(0),{zoom:8}),geocoder:null,markers:[]},ct.data("data-map",t).show(),s.refresh()):setTimeout(li,100)}h.requiresInitCallback?(h.initCallback=function(){var t=s._autoSelect;s._autoSelect=null;t&&!n.busy()?s.tap(t.row,t.action):o.get_searchOnStart()?yr():li()},h.requiresInitCallback=!1,n.navigate(h.id)):h.requiresReturnCallback?(h.returnCallback=function(){li()},h.requiresReturnCallback=!1):li();s._reset=!1;ff(h);return}if(si||(hi=$('<div class="app-scrollable-cover"/>').appendTo(l.parent()).css({position:"absolute",left:l.offset().left,top:l.offset().top,width:l.outerWidth(),height:l.outerHeight(),zIndex:2,backgroundColor:nu?"transparent":"#fff"})),!c.length&&(c=$('<ul data-role="listview" class="app-listview"/>').addClass(af(o)).appendTo(yt).listview().on("taphold",function(n,t){if(t&&(n=t),bb())return!1;if(!o._busy()){var r=$(n.target),i=r.closest("a"),l=i.data("data-context"),u=o.multiSelect()&&!1;return i.closest("li").is(".dv-item")&&!i.is(".app-divider")&&(i.is(".app-selected")?(i.removeClass("app-selected"),u||(s.clearSelection(),s.lookupInfo()?e(i,function(){s.executeInContext("Clear")}):e(i,function(){}))):o._hasKey()&&(u||bh(c),i.addClass("app-selected"),s.tap(l,"none"),h.echoChanged=!0,e(i,function(){})),fi=!0),s.viewStyle()=="Grid"&&!f()&&r.is("span")&&sb(r),!1}}).on("vclick",function(t){function p(n){o._busy()||(s._loadAtTop=!n,s.pageIndex(s.pageIndex(n?"bottom":"top")+(n?1:-1)),s.refresh())}var r=$(t.target),i=r.closest("a"),v,f,l,a,y,u,w;if(!r.is(".app-btn-toggle,[data-href]")){if(l=r.closest(".app-field"),l.length&&(a=l.find("[data-href]"),a.length))return setTimeout(function(){a.trigger("vclick")},10),!1;if(!i.length||i.is(".app-divider")||da(t)){if(y=r.closest(".app-group"),y.length)return r.is(".app-group")||(w=r.closest(".app-group").find(".app-group-path,.app-group-title").addClass("ui-btn-active"),setTimeout(function(){w.removeClass("ui-btn-active");fc(!0)},bt)),!1}else{if(i.is(".dv-load-at-bottom"))p(!0);else if(i.is(".dv-load-at-top:visible"))ut(),setTimeout(function(){p(!1)},50);else{if(fi){fi=!1;return}if(!oi(r)||n.busy())return!1;if(t.ctrlKey)return c.trigger("taphold",t),fi=!1,!1;if(i.is(".dv-action-none")||ev(t,o))return!1;f=o.multiSelect();f&&wh(t)?hv(o,i):f&&!1?c.find("a.app-selected").first().length&&(i.is(".app-selected")?i.removeClass("app-selected"):i.addClass("app-selected")):(f&&!1||(u=i.data("data-context"),u?o._hasKey()?(c.find("a.app-selected").removeClass("app-selected"),i.addClass("app-selected"),ov(t)?(r=sv(r),v=!0,e(r,function(){s.tap(u,"none");kf(r)})):s.tap(u),h.echoChanged=!0):s.tap(u):i.is(".dv-action-refresh")?o.sync():i.is(".dv-action-new")?s.executeInContext("New",null,!1):i.is(".dv-action-filter-clear")&&th(o,!0)),v||e(r))}return!1}}}).contextmenu(function(n){return hp(s.dataView(),n)}),gh(o,c),!lt.length)){kv(o);lt=$('<div class="app-bar-grid-footer"><\/div>').appendTo($app.touch.bar("create",{type:"footer",page:p}));kr=$('<div class="app-hscrollbar"><\/div>').appendTo(lt).height(ei.height+1).attr("data-view",o._id);$('<div class="app-hscrollbar-inner"><\/div>').appendTo(kr);kr.on("scroll",gv)}k&&wr(c);ub(c,a);eo(ti,o,h);nc(o,c);var it=c.find(".dv-item"),kt=it.length>ni*2,dt=c.find("li").last(),rt,ai,v=s._loadAtTop,ot,ri,dr,gr=dt&&dt.length&&dt.prev(),gu=gr&&gr.position().top,su,vi,pi;su=ik(c);(ru&&dt.length==0||kt&&!v&&!c.find("li.dv-load-at-top-parent").length)&&(pt.hide(),rt=$(String.format('<li data-icon="false" class="dv-load-at-top-parent"><a class="dv-load-at-top"><p>{0}<\/p><\/a><\/li>',ft.Loading)),kt?(rt.insertBefore(it.get(0)),ru=!0):rt.appendTo(c));v?(rt=c.find("li").first(),ri=rt.length&&rt.next(),dr=ri&&ri.position().top+su,wt=wt.slice(0).reverse()):dt.remove();ai=d*ni;bi=o._enumerateExpressions(Web.DynamicExpressionType.Any,Web.DynamicExpressionScope.ViewRowStyle,o.get_viewId());$(wt).each(function(n){var t=this,i=$('<li class="dv-item" data-icon="false"/>'),f=v?ai+ni-n:ai+n+1,r=$('<a class="ui-btn"/>').appendTo(i).data("data-context",{row:this.slice(0),pageIndex:d}),u;o.rowIsSelected(t)&&(r.addClass("app-selected"),s.commandRow()?s.commandRow(t):(o._forgetSelectedRow(!0),s.command(t,"Select")));v?i.insertAfter(rt):i.appendTo(c);nt?vf(o,t,fu?f:null,r):ar(o,t,sr,fu?f:null,i,r,a=="List");bi&&bi.length&&(u=o._evaluateJavaScriptExpressions(bi,t,!0),u&&i.addClass(u))});(uu&&!v||kt&&v&&!c.find(".dv-load-at-bottom-parent").length)&&(dt=rr=$(String.format('<li data-icon="false" class="dv-load-at-bottom-parent""><a href="#" class="dv-load-at-bottom"><p>{0}<\/p><\/a><\/li>',ft.Loading)).appendTo(c));v&&d==0&&rt.remove();o._totalRowCount||(vi=$('<li data-icon="refresh"><a class="dv-action-refresh"><p/><\/a><\/li>').appendTo(c).find("a"),vi.attr("title",ki.Refresh).find("p").text(y.NoRecords),o._filter&&o._filter.length&&!o.filterIsExternal()&&(pi=$('<li data-icon="filter"><a class="dv-action-filter-clear"><p/><\/a><\/li>').appendTo(c).find("a"),pi.attr("title",t.ClearFilter).find("p").text(t.ClearFilter)));uu||(tu=s.aggregates(),tu&&nt&&o._totalRowCount>0&&(hu=$('<li data-icon="false" class="dv-item"/>').appendTo(c),lu=$('<a class="app-divider app-calculated"/>').appendTo(hu),vf(o,tu,null,lu,s.aggregateLabels())),r.promoteActions?eu=!0:(gt=s.executeInContext("New",null,!1,!0),gt&&(di=$('<li class="dv-action-new">').appendTo(c).attr("data-icon",gt.icon),vt=$('<a class="dv-action-new"/>').appendTo(di).attr("title",t.LookupNewAction),nt?$("<p>").appendTo(vt).text(gt.text):($("<h3>").appendTo(vt),gi=di.prev(),gi.is(".dv-item")&&(vt.html(gi.find("a").html()).find("p,img,span").css("visibility","hidden"),gi.is(".ui-li-has-thumb")&&di.addClass("ui-li-has-thumb")),vt.find("h3").text(gt.text),o._totalRowCount||$("<p>").appendTo(vt.html("")).text(gt.text)))));ai==0&&(st(!0),au=c.find("li").first(),nr=s.instruction(),(nr||nt)&&(rr=$('<li data-role="list-divider" class="app-list-instruction"/>').insertBefore(au),nr&&$('<span class="app-view-instruction"/>').appendTo(rr).html(nr),nt&&!!o._totalRowCount&&kh(o,rr)));v&&rt&&rt.find(".ui-btn").css("height","").find("p").css("margin-top","");kt&&(v?(it=it.slice(ni*(nu?2:2)),it.find("a").data("data-context",null),it.remove(),c.find("li.dv-action-new").remove()):(pt.hide(),ur=$(String.format('<li style="clear:left;height:{0}px"><\/li>',i.getScreenHeight()*10)).appendTo(c),c.find("li.app-list-instruction").remove(),c.find("li.app-li-card").remove(),it=it.slice(0,ni),it.find("a").data("data-context",null),it.remove()));rk(o,c);ir(c);c.listview("refresh");eu&&c.find("li.dv-item").last().addClass("app-has-promo");ot=c.find("a.app-selected");tt==null&&(kt?v?(or=ri.position().top,yi(l,ht+or-dr)):(vu=gr.position().top,yi(l,ht+vu-gu)):v?(or=ri.position().top,yi(l,ht+or-dr)):v==null&&yi(l,0));ur&&setTimeout(function(){ur.prev().addClass("ui-last-child");ur.remove()},100);nt&&(vi&&vi.removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left"),vt&&vt.removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left"),pi&&pi.removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left"));h.requiresInitCallback?(iu(),h.initCallback=function(){var t=s._autoSelect,i=o._lookupInfo;s._autoSelect=null;t&&!n.busy()?s.tap(t.row,t.action):o.get_searchOnStart()?yr():wi(200)},h.requiresInitCallback=!1,n.navigate(h.id)):h.requiresReturnCallback?(iu(),h.returnCallback=function(){wi(200)},h.requiresReturnCallback=!1):(iu(),wi(k?10:200),ui());hi&&(nu&&kt?setTimeout(function(){hi.remove()},300):hi.remove());s._reset=!1;s._loadAtTop=null;ff(h)},reset:function(){var f=this.dataView(),t=n.pageInfo(f._id),e="#"+t.id,r=i.navigate.history,u;this._reset=!0;$(r.stack).each(function(n){return n>r.activeIndex?!1:this.hash==e?(u=!0,!1):void 0});u||(t.initialized=!1,t.echoInitialized=!1,t.echoId=!1)},visibleDataRows:function(n){var u=this._dataView,i=u._cachedPages,t,r;if(i)for(t=0;t<i.length;t++)if(r=i[t],r.index==n)return r.rows;return null},currentPageIndex:function(n){return arguments.length&&(this._currentPageIndex=n),this._currentPageIndex},pageIndex:function(n){var t=this._dataView,i,r;if(typeof n=="string")return n=="bottom"&&(i=this.content().parent().find("ul li.dv-item").last().find("a").data("data-context"),i)?i.pageIndex:n=="top"&&(r=this.content().parent().find("ul li.dv-item").first().find("a").data("data-context"),r)?r.pageIndex:t.get_pageIndex();if(n==null)return t.get_pageIndex();t.set_pageIndex(n)},pageCount:function(){var n=this._dataView;return n.get_pageCount()},pageSize:function(){var n=this._dataView;return n.get_pageSize()},instruction:function(n){var f=this,u=f.lookupInfo(),e=f.dataView(),h=f.viewDescription()||"",i=h?[h]:[],s=f.filterStatus(),o=e.groupExpression(),r;return u&&(i.length&&i.push(" "),i.push(String.format(u.field.ItemsDescription||t.LookupInstruction,u.aliasField.HeaderText)),u.value&&(r=u.text,r&&r.length>50&&(r=r.substring(0,50)+"..."),i.push(String.format(t.LookupOriginalSelection,r)))),n!=!1&&(i.length||s||o)&&e._totalRowCount>1&&(i.length&&(i.push(" "),i.push(String.format(t.ShowingItemsInfo,e._totalRowCount))),$(o).each(function(n){var r=e.findField(this);r&&(n==0&&(i.length&&i.push(" "),i.push(t.GroupedBy," ")),n&&(n==o.length-1?i.push(" ",y.Filters.Labels.And," "):i.push(", ")),i.push(r.HeaderText),n==o.length-1&&i.push("."))})),s&&(i.length&&i.push(" "),i.push(String.format('<span class="app-filter" title="{1}">{0}<\/span>',s,t.Filter))),i.join("")},context:function(r,u){var c=this,e=c.dataView(),w=e.extension(),l=e._totalRowCount,b=e.get_view().Label,k=e.get_sortExpression(),s=c.commandRow()||[],o=this.lookupInfo(),a=s&&s.length,p;if(l!=-1)if(e.get_showViewSelector()&&r.push({text:b,count:l,theme:"b",icon:"dots",system:!0,toolbar:!1,callback:sk}),(e.get_showQuickFind()&&(l>1||e.get_filter().length>e.get_externalFilter().length)||ou(e).length)&&r.push({text:yt.PerformAdvancedSearch,desc:la(e),icon:"search",toolbar:!1,system:!0,context:{dataViewId:e._id},callback:na}),r.push({text:t.Sort,icon:"sort",desc:oy(e),toolbar:!1,system:!0,callback:tk}),r.push({text:t.Filter,icon:"filter",desc:w.filterStatus(!0),toolbar:!1,system:!0,callback:pr}),r.push({text:t.Group,icon:"group",desc:sy(e),toolbar:!1,system:!0,callback:fc}),o&&o.value==null||r.push({}),sc(e,r,s),o?i.activePage.find(".dv-heading.app-disabled").length&&!lh()&&r.push({text:a?c.instruction():null}):hc(e,r,s),o){function v(n,t,i){function y(){r.siblings("input:text").focus()}ut();var r=$("#"+o.pageId+" .app-field-"+o.field.Name),c=o.field.Copy,l,u,a,v,s;if(o.value=n,o.text=t,v=r.val(),r.val(n),r.prev().text(o.text),n&&c){for(s=[],l=/(\w+)\s*=\s*(\w+)/g,u=l.exec(c);u;)a=e.findField(u[2]),s.push({Name:u[1],NewValue:a?i[a.Index]:null}),u=l.exec(c);s.length&&o.field._dataView.extension().afterCalculate(s)}cf(!0);gi=function(){f()?setTimeout(y,200):setTimeout(function(){h(r.prev())},200);v!=r.val()&&de(r)};setTimeout(function(){history.go(-1)},100)}a&&r.push({text:t.LookupSelectAction,icon:"check",command:"Select",callback:function(){var i=o.field.ItemsDataValueField,r=o.field.ItemsDataTextField,e=n.pageInfo(),t=e.dataView,u,f;i||$(t._allFields).each(function(){if(this.IsPrimaryKey)return i=this.Name,!1});r||$(t._allFields).each(function(){var n=this;if(!n.Hidden&&!n.OnDemand)return r=n.Name,!1});u=t.findField(i);f=t.findField(r);v(s[u.Index],s[f.Index],s)}});o.value&&r.push({text:t.UnSelect,icon:"delete",command:"Clear",callback:function(){v(null,y.NullValueInForms)}});String.isNullOrEmpty(o.field.ItemsNewDataView)||r.push({text:t.LookupNewAction,icon:"plus",command:"New",callback:function(){c.executeInContext("New",o.field.ItemsNewDataView,!0)}});r.push({});a&&!o.field.tagged("lookup-details-hidden")&&r.push({text:t.LookupViewAction,callback:function(){Web.DataView._defaultUseCase="ObjectRef";c.executeInContext("Select","editForm1",!0)}});hc(e,r,s);r.push({text:ki.Refresh,icon:"refresh",callback:function(){e.sync()}})}else u||(u=["Grid","ActionColumn","ActionBar"]),u.length==1&&u[0]=="Grid"&&$(e._views).each(function(){var n=this;if(n.Type=="Form"&&n.Id.match(/edit/))return p=n.Id,!1}),bf(u,e,r,s,p)}};Web.DataView.Extensions.Form=function(n){return new Web.DataView.MobileForm(n)};Web.DataView.MobileForm=function(n){Web.DataView.MobileForm.initializeBase(this);this.dataView(n)};Web.DataView.MobileForm.prototype={initialize:function(){this._editors={};this._initRow()},_initRow:function(){var n=this.dataView(),t=this.inserting()?n._newRow:n._rows[0];return n._mergeRowUpdates(t),this.commandRow(t)},reset:function(){this._reset=!0;this._initRow()},options:function(){return{quickFind:!1,filterDetails:!1}},dispose:function(){this._dispose()},_dispose:function(t){var i=this.content(),f,s,r,e,o,u;this._newValues=null;i.find(".app-drop-box").each(function(){$app.upload("destroy",{container:this})});i.find('input[data-input-type="datepicker"]').datepicker("destroy");i.find('select[data-role="slider"]').slider("destroy").remove();i.find("select").selectmenu("destroy");f=i.find(".app-container-scrollable").data("data-field",null).find("fieldset");f.find(":checkbox,:input").off().checkboxradio("destroy");f.controlgroup("destroy");for(s in this._editors)r=this._editors[s],r.field=null,r.originalField=null,$(r.item).remove(),delete r.item,$(r.label).remove(),delete r.label,$(r.readers).remove(),delete r.readers,$(r.writers).remove(),delete r.writers;this._editors={};i.find("div.app-status-bar, div.app-bar-buttons,div.app-stub,div.app-form-grid").remove();e=i.parent().find('div[data-role="header"]');e.find('div[data-role="navbar"]').navbar("destroy").remove();e.toolbar("destroy").remove();lu(i);o=i.find(".ui-collapsible-set");o.find(".ui-collapsible-heading a").off();o.remove();u=i.find(".app-echo").each(function(){var i=$(this).attr("data-for"),t=n.pageInfo(i);t&&(t.echoId=null,t.echoInitialized=!1)});u.find(".app-echo-toolbar").find(".ui-icon-dots, h3, .app-echo-controls, .app-echo-see-all").off();u.find(".app-echo-inner").off();u.find(".app-echo-footer").off();u.remove();n.tabs("destroy",{container:i});t&&g()},viewStyle:function(){return"Form"},refresh:function(){function ut(n){bar=$(t.find(".app-bar-buttons")[1]);n?bar.removeClass("app-bar-buttons-hidden"):t.find(".ui-collapsible").filter(uu).find(".ui-collapsible-heading:not(.ui-collapsible-heading-collapsed)").length?bar.removeClass("app-bar-buttons-hidden"):bar.addClass("app-bar-buttons-hidden")}function ct(n,t){if(arguments.length==2)r.viewProp("categoryState"+n,t);else return r.viewProp("categoryState"+n)==!0}function ui(){it&&c.length&&(et=c.outerWidth(),ot=c.offset().left,d=o.width(),lh()&&(d-=$("#app-sidebar").outerWidth()),ot+et+20>d&&ft.scrollLeft(c.is(".Last")?ot+et-d+(c.outerWidth(!0)-c.find(".Self").outerWidth()):ot-(d-et)/2));ys(t);wi(200);setTimeout(function(){fh(t)},100)}var u=this,r=u.dataView(),s=n.pageInfo(r._id),wt=r._fields,fi=r._allFields,bt=r._categories,t=u.content(),a,kt=[],f,v,y,tt,it,ht=this.inserting(),ei=this._reset,dt,p=r.get_showActionButtons(),gt=r._confirmContext,w=$("#"+s.id),k=w.find(".app-page-header"),ti,ft,c,et,ot,d,lt,vt,pt;s.headerText=gt&&gt.WindowTitle||r.get_view().Label;ht&&k.attr("data-locked","false").data("data-text",null);st(s.headerText,k);t.closest(".ui-page").addClass("app-form-page");ei&&(u._dispose(),u._commandRow=null);dt=u._editors;a=u.commandRow()||u._initRow()||[];it=r.statusBar();it&&(ft=$('<div class="app-status-bar"/>').html(it).appendTo(t),c=ft.find(".Current"),ni||ft.css("overflow-x","auto"));lt=u.viewDescription();lt&&(vt=$('<ul data-role="listview" class="app-list-instruction"/>').appendTo(t),$('<li data-role="list-divider" class="app-list-instruction"/>').appendTo(vt).html(lt),vt.listview());(p=="TopAndBottom"||p=="Top")&&$('<div class="app-bar-buttons"/>').appendTo(t);ht||(y=wt[0],y=y.text(a[y.AliasIndex],!1));var g=4,l=0,nt=0,ii,yt,h=[],ri=0,oi=0;$(bt).each(function(){var n=this;f!=n.Tab&&(f=n.Tab,l=0,nt=0,firstCategory=!0,ri++);(firstCategory||n.NewColumn)&&l++;f&&(h[ri-1]=l);firstCategory=!1});h.length?$(h).each(function(n){var i=this;i>g&&(i=g);h[n]=i==1?null:$("<div><\/div>").appendTo(t).addClass("app-form-grid ui-grid-"+String.fromCharCode(97+i-2))}):l>1&&(l>g&&(l=g),ii=$("<div><\/div>").appendTo(t).addClass("app-form-grid ui-grid-"+String.fromCharCode(97+l-2)));f=null;v=ii;$(bt).each(function(n){var i=this;f&&f.text==i.Tab||(f={text:i.Tab,content:[]},h.length&&(v=h[oi++]),nt=0,yt=null,kt.push(f));v&&(f.content.length||f.content.push(v),(nt==0||this.NewColumn)&&nt<g&&(yt=$("<div>").appendTo(v).addClass("ui-block-"+String.fromCharCode(97+nt++))));var l=$('<div class="ui-collapsible-set ui-group-theme-inherit"><\/div>').appendTo(yt||t),w=$('<div class="ui-collapsible ui-collapsible-themed-content ui-first-child ui-last-child"><\/div>').appendTo(l.addClass("app-category-"+i.Id)),b=r._processTemplatedText(a,i.Description),d=r._formatViewText(ul.DefaultCategoryDescriptions[b],!0,b),p,tt,o=$('<h3 class="ui-collapsible-heading"/>').appendTo(w),s=$('<a class="ui-collapsible-heading-toggle ui-btn ui-btn-a"/>').appendTo(o).text(i.HeaderText),c=$('<div class="ui-collapsible-content ui-body-a" aria-hidden="false"><\/div>').appendTo(w);$(pl).appendTo(s);$(hw).appendTo(s);v||f.content.push(l);p=$('<ul data-role="listview" data-theme="a" data-inset="false" class="app-formview"/>').addClass(af(r)).appendTo(c);String.isNullOrEmpty(d)||$("<div><\/div>").appendTo($('<li data-role="list-divider" class="app-list-instruction"/>').appendTo(p)).html(d.replace(/\n/g,"<p/>"));$(wt).each(function(){var n=this,r=n,o,u,t,f,e;n.CategoryIndex==i.Index&&(n=fi[n.AliasIndex],o=a[r.Index],u=n.text(a[n.Index],!1),ht||tt||(tt=!0,t=st(null,k),$('<span class="dv-object-identifier"/>').text(y).appendTo(s).hide(),typeof t=="string"&&(t=[0,t]),t[0]=y,st(t,k),k.attr("data-locked","true")),f=$('<li class="ui-field-contain"/>').appendTo(p),e=$('<label class="app-static-label"/>').appendTo(f).text(n.HeaderText),r.AllowNulls||e.addClass("app-required"),dt[r.Name]={field:n,originalField:r,item:f,label:e,value:o,originalValue:a[r.Index],text:u,trimmedText:n.trim(u),readers:[],writers:[]})});l.find("ul").listview();s.on("vclick",function(t,i){function f(){o.toggleClass("ui-collapsible-heading-collapsed");s?(c.show(),r.find(".dv-object-identifier").hide().closest(".ui-collapsible").find(".dv-heading").removeClass("app-disabled"),ut(!0),rt(),u.inserting()||ct(n,!1),at()):(c.hide(),u.inserting()||ct(n,!0),ut(),rt(),at())}var r=$(this),s=o.is(".ui-collapsible-heading-collapsed");i==!1?f():e(r,f)});(i.Collapsed||ct(n))&&(o.addClass("ui-collapsible-heading-collapsed"),c.hide());i.HeaderText||o.hide().closest(".ui-collapsible").addClass("app-divider")});n.tabs("create",{id:r._id+"_tabset",tabs:kt,className:"app-tabs-form",scope:r.get_selectedKey(),change:function(n){rt();ge(t);$(n.content).each(function(){this.find("textarea").textinput("refresh")});ut()}});$(h).each(function(n){var i=h[n];i&&i.appendTo(t)});(p=="TopAndBottom"||p=="Bottom")&&$('<div class="app-bar-buttons"/>').appendTo(t);tt=[];u.context(tt);p!="None"&&n.refreshAppButtons(tt,{buttonBars:t.find(".app-bar-buttons"),toolbar:!1});vv(r,t);ti=$('<div class="app-stub"/>').appendTo(t);t.find(".app-echo").length&&ti.height(i.getScreenHeight()*.6);u.stateChanged();u._reset=!1;s.requiresInitCallback?(pt=w.css("display")!="block",pt&&w.css({display:"block","z-index":-10}),ut(),ge(t),p!="None"&&n.refreshAppButtons(tt,{buttonBars:t.find(".app-bar-buttons"),toolbar:!1}),tr(w),pt&&w.css({display:"","z-index":""}),s.requiresInitCallback=!1,b=!1,s.initCallback=ui,n.navigate(s.id)):ui();ff(s)},collect:function(){var t=this,u=[],n,o=t.dataView(),h=o._allFields,s=this.commandRow(),e=t.inserting(),i,r;return s?($(h).each(function(){var h=this,c=$("#"+o._id+" .app-field-"+h.Name+":input"),a,l;h.OnDemand||(i=s[h.Index],n={Name:h.Name,OldValue:e?null:i,NewValue:i,Modified:e&&i!=null},n.ReadOnly=h.ReadOnly&&!(h.IsPrimaryKey&&e),c.length?(l=c.is("select")?c.find("option:selected").data("value"):c.val().trim(),l===""&&(l=null),n.NewValue=l,si||f()||h.Type.match(/^Date/)&&(n.NewValue=h.TimeFmtStr?rv(n.NewValue):cb(n.NewValue)),n.Modified=!0):(a=t._editors[h.Name],a?(n.NewValue=a.value,n.Modified=!0):(r=t._newValues,r&&h.Name in r&&(n.NewValue=r[h.Name],n.Modified=!0))),u.push(n))}),u):u},_readWrite:function(){function d(n,t){$(n).each(function(){t?u.item.children().length==1&&this.appendTo(u.item):this.detach()})}function w(){g=pt+"_"+n.Name+"_Input";ft.attr("for",g);i.appendTo(v).attr("id",g).addClass(p);n.Len>0&&i.attr("maxlength",n.Len);n.Watermark&&i.attr("placeholder",n.Watermark);st&&i.attr("data-causes-calculate",st);ct&&i.attr("data-causes-populate",ct);lt&&i.attr("data-causes-copy",lt)}function ti(t){if(!r||r.match(/^null/))t.text(y.NullValueInForms);else{var e=s.resolveClientUrl(s.get_appRootPath()),u=$('<a rel="external"/>').appendTo(t).attr("href",String.format("{0}blob.ashx?{1}=o|{2}",e,n.OnDemandHandler,h)),i,o=n.Name.toLowerCase();n.OnDemandStyle!=1?($('<img class="app-image-thumb">').appendTo(u).attr({src:String.format("{0}blob.ashx?{1}=t|{2}&_nocrop",e,n.OnDemandHandler,h),title:y.BlobDownloadHint}),$(s._allFields).each(function(){var n=this,t=n.Name.toLowerCase();if(t==o+"contenttype"||t==o+"content_type")return i=tt[n.Index],!1}),$(s._allFields).each(function(){var n=this,t=n.Name.toLowerCase();if(t=="contenttype"||t=="content_type")return i=tt[n.Index],!1}),i||(i="image"),i.match(/^image/i)?u.attr("data-content-type",i):f()&&u.attr("target","_blank")):(u.text(y.BlobDownloadLink).addClass("ui-btn ui-btn-icon-left ui-icon-arrow-d ui-btn-inline ui-mini ui-shadow ui-corner-all").appendTo(t.parent()),f()&&u.attr("target","_blank"),t.remove())}}var a=this,s=a.dataView(),pt=s._id,ut=a.editing(),fi=a.inserting(),wt=a._editors,bt,r,h,k,u,n,e,kt,ft,v,c,i,g,o,p,ri=a.content(),et=ri.find(".ui-collapsible ul"),l,ot,dt={},gt={},nt,st,ct,lt,at,vt,tt=a.commandRow(),ui,ii,it,b,rt,yt;ut?et.addClass("app-form-editing"):et.removeClass("app-form-editing");$(s._allFields).each(function(){var r=this,n=r.ContextFields,i,t;if(r.Calculated&&n&&$(n.split(/\s*,\s*/)).each(function(){s.findField(this)&&(dt[this]=!0)}),n)for(i=/(\w+)\s*=\s*(\w+)/g,t=i.exec(n);t;)gt[t[2]]=!0,t=i.exec(n)});for(bt in wt)u=wt[bt],n=u.field,e=u.originalField,ft=u.label,v=u.item,r=u.value,h=u.text,ut||(h=u.trimmedText),p="app-field-"+n.Name,c=e.ItemsStyle,nt=e.Name+"."+s._id+".app",st=e.CausesCalculate||dt[e.Name]?nt:null,ct=gt[e.Name]?nt:null,lt=String.isBlank(e.Copy)?null:nt,vt=n.Index!=e.Index&&!e.ItemsStyle,ut&&!e.isReadOnly()?(d(u.readers,!1),u.writers.length?d(u.writers,!0):(vt?(n=e,p="app-field-"+n.Name,i=$('<input type="text" />'),w(),i.val(r==null?"":r),o=i.textinput({clearBtn:!b,clearBtnText:t.ClearText}),ni?o.parent().find(".ui-input-clear").attr("tabindex",-1):o.parent().find(".ui-input-clear").remove(),u.label.text(n.HeaderText)):String.isNullOrEmpty(c)?n.OnDemand?(o=$('<div class="ui-input-text ui-body-inherit ui-corner-all app-drop-box-input"><\/div>').appendTo(v).addClass(p),ti(o),$app.upload("create",{container:$("<div><\/div>").appendTo(o).addClass("drop-box-"+n.Index),dataViewId:s._id,fieldName:n.Name})):(ot=!1,b=n.Rows>1,i=b?$("<textarea/>"):$('<input type="text" />'),b?(i.attr("rows",n.Rows),(ni||!ht||!0)&&i.attr("data-autogrow","false"),i.css("white-space","pre-wrap")):n.TextMode==1?i.attr("type","password"):n.Type=="String"?oo(n)?i.attr("type","tel"):so(n)?i.attr("type","email"):fy(n)&&i.attr("type","url"):n.Type.match(/^Date/)?(i.addClass("app-input-date"),si||f()?ot=!0:n.TimeFmtStr?(i.attr("type","datetime-local"),h=iv(r)):(i.attr("type","date"),h=tv(r))):n.Type!="TimeSpan"&&i.data("format",{type:"number",value:r,text:r==null?"":h,field:n}),w(),i.val(r==null?"":h),o=i.textinput({clearBtn:!b,clearBtnText:t.ClearText}),b?o.textinput("refresh"):ni?o.parent().find(".ui-input-clear").attr("tabindex",-1):o.parent().find(".ui-input-clear").remove(),ot&&$(i).attr({"data-input-type":"datepicker","data-format-string":n.DataFormatString}).datepicker()):(kt=n,n=e,p="app-field-"+n.Name,r=u.originalValue,c=="Lookup"||c=="AutoComplete"?(i=$('<input type="hidden"/>').val(r),w(),o=$("<div><\/div>").appendTo(v),i.appendTo(o),ui=$('<input type="text" class="app-lookup-input"/>').insertBefore(i).attr("id",g),ii=$('<a href="#app-lookup" class="ui-btn ui-icon-carat-r ui-btn-icon-right ui-corner-all app-lookup"/>').insertBefore(i).text(h).data("data-context",{field:e,aliasField:kt,value:r,text:h,pageId:pt}),ni&&ii.attr("tabindex",-1)):c=="CheckBox"?(i=$('<select data-role="slider"/>'),it=0,$(cr(e,u)).each(function(){var n=this[0],t=this[1],r=$("<option/>").attr("value",n!=null?n.toString():"").data("value",n).text(t).appendTo(i);t.length>it&&(it=t.length)}),w(),i.val(r!=null?r.toString():""),o=i.slider(),i.next().css("width",it+2+"em")):c=="CheckBoxList"||c=="RadioButtonList"||c=="ListBox"?(i=$('<input type="hidden"/>'),w(),i.val(r!=null?r.toString():"").attr("data-field",n.Name),wa(n,i,u),o=i):(i=$("<select/>").addClass("app-lookup"),$(cr(e,u)).each(function(){var n=this[0],t=this[1],r=$("<option><\/option>").attr("value",n!=null?n.toString():"").data("value",n).text(t).appendTo(i)}),w(),i.val(r!=null?r.toString():""),o=i.selectmenu().selectmenu("refresh"))),u.item.children().each(function(n){n>0&&u.writers.push($(this))}))):(ft.attr("for",""),d(u.writers,!1),u.readers.length?d(u.readers,!0):(o=$('<div class="ui-input-text ui-body-inherit ui-corner-all app-static-text"><\/div>').appendTo(v),fieldText=$("<div><\/div>").appendTo(o).addClass(p).addClass("app-field"),u.readers.push(o),n.Index==s._fields[0].AliasIndex&&v.addClass("dv-heading"),n.OnDemand?ti(fieldText):(n.Type=="Boolean"&&r!=null?(k=n.Items,k&&k.length>=2?$(String.format('<span class="glyphicon glyphicon-{0}"/>',k[k.length-1][1]==h?"check":"unchecked")).appendTo(fieldText):fieldText.html("&nbsp;"),fieldText.attr("title",h)):bs(n,h,fieldText),l=null,fieldText.contents().wrap('<span class="app-field-data"/>'),r&&(at=fo(e,tt),at&&fieldText.attr("data-href",at)),oo(n,!0)&&r?l=$('<a class="ui-btn-right ui-btn ui-icon-phone ui-btn-icon-notext ui-shadow ui-corner-all app-btn" rel="external"/>').appendTo(fieldText).attr("href","tel:"+r):so(n,!0)&&r?l=$('<a class="ui-btn-right ui-btn ui-icon-mail ui-btn-icon-notext ui-shadow ui-corner-all app-btn" rel="external"/>').appendTo(fieldText).attr("href","mailto:"+r):fy(n,!0)&&r?l=$('<a class="ui-btn-right ui-btn ui-icon-eye ui-btn-icon-notext ui-shadow ui-corner-all app-btn" rel="external"/>').appendTo(fieldText).attr({href:r}):kb(n,!0)&&r?l=$('<a class="ui-btn-right ui-btn ui-icon-location ui-btn-icon-notext ui-shadow ui-corner-all app-btn" rel="external"/>').appendTo(fieldText).attr({href:tp(a.commandRow(),cc(s),"q")}):db(e)&&e.ItemsDataController&&r&&!e.tagged("lookup-details-hidden")&&(l=$('<a href="#app-details" class="ui-btn-right ui-btn ui-icon-carat-r ui-btn-icon-notext ui-shadow ui-corner-all app-btn"/>').appendTo(fieldText).attr("data-field-name",e.Name).attr("data-field-text",n.HeaderText+" - "+s.get_view().Label)),l&&l.attr("title",n.HeaderText+":\n"+r),vt&&u.label.text(n.HeaderText))),d(u.writers,!1));rt=s._enumerateExpressions(Web.DynamicExpressionType.Any,Web.DynamicExpressionScope.ViewRowStyle,s.get_viewId());rt&&rt.length&&(yt=s._evaluateJavaScriptExpressions(rt,tt,!0),yt&&et.addClass(yt))},stateChanged:function(){var n=this,r=n.dataView(),t=n.content(),u=n.editing(),i;n._readWrite();n.calculate(r);u&&(i=t.find(".ui-collapsible").filter(uu).find(".ui-collapsible-heading"),i.filter(":not(.ui-collapsible-heading-collapsed)").length||i.first().find(".ui-btn").trigger("vclick",!1),fh(t),r._raisePopulateDynamicLookups(),t.closest(".ui-page").filter(uu).length&&ge(t));ys(t);g()},context:function(n){var t=this,i=t.dataView(),r=t.commandRow(),u=t.editing();n.isSideBar||sc(i,n,r);u||hc(i,n,r);bf(["Form","ActionBar"],i,n,r)},calcNotify:function(){var t=this,n=t.dataView(),i=n._controller,r=n._calcNotify;n._calcNotify=null;t.inserting()||$app.execute({controller:i,view:n._viewId,_filter:n.get_filter(),success:function(u){var e=[],f=u[i];f&&f.length&&(f=f[0],$(n._allFields).each(function(){var t=this,n=t.ContextFields;n&&(n=n.split($app._simpleListRegex),n.indexOf(r)>-1&&e.push({Name:t.Name,NewValue:f[t.Name]}))}));e.length&&t.afterCalculate(e)}})},calculate:function(t){var o=this,i,u,f,r,s;if(typeof t=="string")i=n.dataView(),u=i.findField(t),u&&i._raiseCalculate(u,u);else{i=t;f=n.page(i._id);function e(){r||(r=[],$(i._collectFieldValues()).each(function(){var n=this,t=i.findField(n.Name);t&&(r[t.Index]=n.Modified?n.NewValue:n.OldValue)}))}$(i._expressions).each(function(){var u=this,s,o,t,n;u.Scope==3&&(e(),s=i._evaluateJavaScriptExpressions([u],r,!1),o=f.find(".app-field-"+u.Target),o.length&&(t=o.closest(".ui-field-contain"),s?t.show():t.hide(),n=t.closest("ul").find("> li").removeClass("ui-first-child ui-last-child").filter(":visible"),n.length&&($(n[0]).addClass("ui-first-child"),$(n[n.length-1]).addClass("ui-last-child"))))});$(i._expressions).each(function(){var u=this,o,n,t;u.Scope==2&&(e(),o=i._evaluateJavaScriptExpressions([u],r,!1),n=f.find(".app-category-"+u.Target),n.length&&(o?n.show().removeClass("app-hidden"):n.hide().addClass("app-hidden"),n.closest(".app-form-grid").length&&(t=n.parent(),t.find("> .ui-collapsible-set:not(.app-hidden)").length?t.show().removeClass("app-hidden"):t.hide().addClass("app-hidden"))))});f.find(".app-form-grid").each(function(){var n=$(this),t=n.find("> div:not(.app-hidden)"),i=n.attr("class").replace(/ui-grid-\w+/,"").trim();t.length==0?n.hide():(i+=" ui-grid-"+(t.length==1?"solo":String.fromCharCode(97+t.length-2)),n.attr("class")!=i&&n.attr("class",i),n.css("display",""),t.each(function(n){var i=$(this),t="ui-block-"+String.fromCharCode(97+n);i.attr("class")!=t&&$(this).attr("class",t)}))});$(i._expressions).each(function(){var t=this,u,n;t.Scope==5&&(n=i.findField(t.Target),n&&(n._originalTextMode==null&&(n._originalTextMode=n.TextMode),e(),u=i._evaluateJavaScriptExpressions([t],r,!1),n.isReadOnly()!=u&&(n.TextMode=u?4:n._originalTextMode,s=!0)))});s&&o._readWrite();o._refreshButtons()}},afterPopulateDynamicLookups:function(n){var t=this,i=t.dataView(),r=$("#"+i._id);$(n).each(function(){var o=this,f=t._editors[o.Name],i,n,u,e;f&&(i=f.originalField,u=i.ItemsStyle,n=r.find(".app-field-"+i.Name),u=="DropDownList"?(n=n.next(),e=n.val(),n.empty(),$(cr(i)).each(function(){var t=this[0],i=this[1],r=$("<option><\/option>").attr("value",t!=null?t.toString():"").data("value",t).text(i).appendTo(n)}),n.val(e),n.selectmenu("refresh")):(u=="RadioButtonList"||u=="ListBox"||u=="CheckBoxList")&&wa(i,n))})},afterCalculate:function(t){var i=this,r=i.dataView(),u=$("#"+r._id);n.causesCalculate(!1);$(t).each(function(){var e=this,s,t,h,o,l,a,c,n,p,v;"name"in e&&(e.Name=e.name,e.NewValue=e.value);s=i._editors[e.Name];s?(o=s.originalField,c=o.ItemsStyle,t=s.value=e.NewValue,e.NewValue==null?(h=s.text=y.NullValueInForms,s.trimmedText=s.text):(h=s.text=o.format(e.NewValue,!1),s.trimmedText=o.trim(s.text)),n=u.find(".app-field-"+o.Name),n.length&&(n.is("div")?o.htmlEncode()?n.text(s.trimmedText):n.html(s.trimmedText):c=="Lookup"||c=="AutoComplete"?n.val(t!=null?t.toString():"").prev().data("data-context").value=t:c=="CheckBox"?(n.val(t!=null?t.toString():""),n.slider("refresh")):c=="CheckBoxList"||c=="RadioButtonList"||c=="ListBox"?(n.val(t!=null?t.toString():""),$(cr(o)).each(function(i){if(this[0]==t){var r=n.prev();return r.find(":input:eq("+i+")").trigger("click"),r.find(":checkbox,:radio").checkboxradio("refresh"),!1}})):c?(n.next().val(t!=null?t.toString():""),n.next().selectmenu("refresh")):(l=n.data("format"),l&&(l.value=t,l.text=t==null?"":h),o.Type.match(/^Date/)&&(si||f()||(h=o.TimeFmtStr?iv(t):tv(t))),n.is(":focus")&&l?n.val(t==null?"":t):n.val(t==null?"":h)))):(i._newValues||(i._newValues={}),i._newValues[e.Name]=e.NewValue,o=r.findField(e.Name),o&&(a=r.findFieldUnderAlias(o),a!=o&&(n=u.find(".app-field-"+a.Name),n.length&&(p=n.prev(),h=e.NewValue==null?y.NullValueInForms:o.format(e.NewValue,!1),v=p.text(h).data("data-context"),v&&(v.text=h)))))});i._refreshButtons()},_refreshButtons:function(){var n;$(this.dataView()._actionGroups).each(function(){return $(this.Actions).each(function(){if(this._whenClientScript)return n=!0,!1}),n?!1:void 0});n&&g()}};Web.DataView.alert=function(t,i){function h(){r.popupopen()}var s;typeof t!="string"&&(t=t.toString());wc=i;var r=$("#app-popup-alert"),c=w(),f=$("div.ui-popup-active div").first();if(r.length==0){r=$(String.format('<div id="app-popup-alert" class="app-popup app-popup-alert" data-theme="a" data-overlay-theme="a" data-dismissible="false" data-history="false"><div class="ui-header ui-bar-a" role="banner"><h1 class="ui-title" role="heading" aria-level="1">{0}<\/h1><\/div><div role="main" class="ui-content"><div class="app-popup-text"><\/div><div class="app-popup-buttons"><a href="#" class="ui-btn ui-corner-all ui-mini">{1}<\/a><\/div><\/div><\/div>',n.appName(),re.Close)).appendTo(u).popup(vo());r.find("a").on("vclick",function(){return f.length?(hi=function(){f.popupopen()},oe=wc):hi=wc,e(this,function(){vt(r)}),!1})}s=r.find(".app-popup-text").css("max-height",o.height()*.8-n.toolbar().outerHeight()*2);t=(t||"").replace(/\n/g,"<p/>");t.match(/<\w+/)?s.html(t):s.text(t);f.length?(hi=h,vt(f)):h()};Web.DataView.confirm=function(t,i,r){function h(){f.popupopen()}var s;typeof t!="string"&&(t=t.toString());bc=i;kc=r;var f=$("#app-popup-confirm"),c=w(),o=$("div.ui-popup-active div").first();if(f.length==0){f=$(String.format('<div id="app-popup-confirm" class="app-popup app-popup-confirm" data-role="popup" data-theme="a" data-overlay-theme="a" data-dismissible="false" data-history="false"><div class="ui-header ui-bar-a" role="banner"><h1 class="ui-title" role="heading" arial-level="1">{0}<\/h1><\/div><div role="main" class="ui-content"><div class="app-popup-text"><\/div><div class="app-popup-buttons"><a href="#" class="app-btn-confirm ui-btn ui-corner-all ui-mini">{1}<\/a><a href="#" class="ui-btn ui-corner-all ui-mini">{2}<\/a><\/div><\/div><\/div>',n.appName(),re.OkButton,re.CancelButton)).appendTo(u).popup(vo());f.find("a").on("vclick",function(n){var t=$(n.target).is(".app-btn-confirm");return hi=o.length?function(){o.popupopen();oe=t?bc:kc}:t?bc:kc,e(this,function(){vt(f)}),!1})}s=f.find(".app-popup-text");t=(t||"").replace(/\n/g,"<p/>");t.match(/<\w+/)?s.html(t):s.text(t);o.length?(hi=h,vt(o)):h()};$app.showMessage=function(n){n&&this.alert(n)};it=Web.Menu={};it.Nodes={};it.headerIterators=[];it.footerIterators=[];s.$nextTabIndex=s.$closeHovers=function(){};typeof Web.Membership!="undefined"&&(Web.Membership.prototype.initialize=function(){var i=this;ve=i.get_authenticationEnabled();ye=i.get_displayMyAccount();gu=i.loggedIn();nf=i.get_user();it.headerIterators.push(function(){var s=$(this),c=i.get_cultures(),u,a,r,e,o;if(!String.isNullOrEmpty(c)&&!(__tf!=4)){var f={value:"Detect,Detect",text:nt.AutoDetectLanguageOption,selected:!1},l=[f];$(c.split(/;/)).each(function(){if(this.length){var n=this.split("|"),t={value:n[0],text:n[1],selected:n[2]=="True"};l.push(t);t.selected&&(f=t)}});a=$("<a/>").text(f.text).appendTo($('<li data-icon="location" data-theme="b"/>').appendTo(s)).on("vclick",function(){return di||h(a),fi=function(){d=[{text:t.Back,icon:"back",callback:function(){n._menuPanel.panel("toggle")}},{text:nt.ChangeLanguageToolTip,instruction:!0}];$(l).each(function(n){var t=this;d.push({text:t.text,icon:n==0?"":t.selected?"check":!1,context:t,callback:function(n){i.changeCulture(n.value)}});n==0&&d.push({})});k(d,"#app-panel-languague",{position:"left"})},wf(!0),!1});u=!0}if(r=this.find(".welcome"),gu)e=i.get_welcome(),String.isNullOrEmpty(e)?r.hide():r.html(String.localeFormat(e,i.get_user(),new Date));else if(i._allowLoginInMenu){r.hide();o=$("<a/>").text(nt.LoginLink).appendTo($('<li data-icon="lock" data-theme="b"/>').appendTo(s));o.on("vclick",function(){di||h(o);fi=function(){h();i.showLogin()};wf()});u=!0}return u});gu&&(ye||ve)&&it.footerIterators.push(function(){var n=!1,t;if(ye&&$(this).is(".level0")&&!1&&($(String.format("<li>{0}<\/li>",nt.MyAccount)).appendTo(this),n=!0),ve){t=$("<a/>").text(nt.LogoutLink).appendTo($('<li data-icon="power" data-theme="b"/>').appendTo(this));t.on("vclick",function(){di||h(t);fi=function(){io();i.logout()};wf()});n=!0}return n})},Web.Membership.prototype.dispose=function(){},Web.Membership.prototype.updated=function(){if(ti=this,hh(),this.get_idleTimeout())$(document).on("awake.app",function(){return!ti.idle()});this.idleInterval(!0);n&&this.mobileUpdated()},Web.Membership.prototype._idle=function(){rt();var n=this;n.idleInterval(!1);$app.alert(nt.UserIdle,function(){io();n.logout()})},Web.Membership.prototype.loginStatus=function(n){var t=this,i=t.loggedIn(),r=$(n).text(i?nt.LogoutLink:nt.LoginLink).on("vclick",function(){return e(r,function(){i?(io(),t.logout()):t.showLogin()}),!1})},Web.Membership.prototype.mobileUpdated=function(){function i(){b?setTimeout(i,200):n.loggedIn()||t!=w()||n.showLogin()}var n=this,t,r;$(document).on("start.app",function(){n._allowLoginInMenu=n.get_displayLogin();!r&&location.href.match(/(\?|&)ReturnUrl=/)&&n._allowLoginInMenu&&(t=w(),setTimeout(i,1e3))});this.loginStatus('a[data-app-role="loginstatus"]')},Web.Membership.prototype.showLogin=function(){var t=this._loginDialog,r,i;if(!t){this._login_CompletedHandler=Function.createDelegate(this,this._login_Completed);this._method_FailureHandler=Function.createDelegate(this,this._method_Failure);t=this._loginDialog=$(String.format('<div id="app-popup-login" data-role="popup" data-theme="a" data-overlay-theme="a" class="app-popup app-popup-login"><div role="banner" class="ui-header ui-bar-a"><h1 class="ui-title" role="heading" aria-level="1">{6}<\/h1><\/div><div role="main" class="ui-content"><div><label for="UserName">{1} {2}<\/label><\/div><input type="text" id="UserName" placeholder="{3}" autocorrect="off" autocapitalize="off"/><input type="password" id="Password" placeholder="{4}"/>{5}<div class="app-popup-buttons"><a href="#" class="login-button ui-btn ui-corner-all ui-mini">{7}<\/a><\/div><\/div><\/div>',nt.HelpCloseButton,nt.LoginLink,nt.LoginText,nt.UserName.replace(/:/,""),nt.Password.replace(/:/,""),this.get_displayRememberMe()?String.format('<label for="RememberMe"><input type="checkbox" id="RememberMe" />{0}<\/label>',nt.RememberMe):"",n.appName(),nt.LoginButton)).appendTo(u).popup(vo());r=this;this._userName=t.find("input:text").textinput().get(0);this._password=t.find("input:password").textinput().get(0);this._rememberMe=t.find("input:checkbox").checkboxradio().get(0);i=t.find("a.login-button").on("vclick",function(){return rt(),e(i,function(){h(i,!1);r.login()}),!1});t.find("input").on("keydown",function(n){if(n.which==13)return rt(),setTimeout(function(){i.trigger("vclick")},200),!1})}t.popupopen()});Web.Mobile=function(){var n=this;n._asyncJob=0;n._pageMap={};n._pages=[];n._toolbar=$("#app-bar-tools");n._actionButton=$(".app-btn-promo");n._toolbarButtons=n._toolbar.find(".app-btn");n._toolbarUserName=n._toolbar.find(".app-user-name");n._title=n._toolbar.find("h1").addClass("app-hidden");n._stickyHeaderBar=$("#app-bar-heading");n._menuButton=$("#app-btn-menu");n._contextButton=$("#app-btn-context");n._modalDataViews=[];n._modalStack=[]};Web.Mobile.prototype={settings:function(){return r},appName:function(){var n=this;return n._appName||(n._appName=$("#PageHeaderBar").text()||$('head meta[name="application-name"]').attr("content")),n._appName},height:function(){var n=o.height();return navigator.userAgent.match(/Mobile.+Safari/)&&!navigator.userAgent.match(/Chrome/)&&(n+=60),n},page:function(n){n||(n="Main");var t=$("#"+n);return t.length==0&&(t=$(String.format('<div data-role="page" id="{0}"><div data-role="content"><\/div><\/div>',n)).appendTo(u).page(),oh(t),ii(t)),t},activeLink:function(n,t){if($(i.activeClickedLink).is(".app-tab-active")||i.removeActiveLinkClass(!0),n){var r=$(n).closest("a");r.length&&(n=r);n.is(".app-btn-static")||(n.addClass("ui-btn-active"),(t==null||t)&&(i.activeClickedLink=n))}},blink:function(n,t){h(n);setTimeout(function(){h();setTimeout(function(){h(n);setTimeout(function(){h();t&&t()},200)},200)},200)},content:function(n){var t=this.page(n),i=t.find('div[data-role="content"] .app-wrapper').last();return i.length?i:t.find('div[data-role="content"]')},showContextPanel:function(n,t,i){k(n,"#"+t,i)},toggleContextPanel:function(n){this.contextScope()&&(n+="-scope");$(n).panel("toggle")},causesCalculate:function(n){if(arguments.length==0)return hr.length?hr[0]:null;n==!1?(hr.length&&hr.splice(0,1),ae=null):hr.push(n)},callAfterCalculate:function(n){vh(n)},pageVar:function(n,t){if(arguments.length==1)return ri(n);ri(n,t)},userVar:function(n,t){if(arguments.length==1)return l(n);l(n,t)},callWithFeedback:function(n,t){n=$(n);n&&n.length&&e(n,t)},pageHeader:function(t){var i=n.pageInfo(t.id),r=[t.text];t.text2&&(r[1]=t.text2);i&&(i.headerText=r,i.id==w()&&st(r))},dataView:function(){var n=this.pageInfo();return n?n.dataView:null},prevPageInfo:function(){var t=i.navigate.history.stack,r,u;return t.length>1&&(r=t[t.length-2].pageUrl,r&&(u=n.pageInfo(r))),u},pageInfo:function(n){if(n?n.selector!=null&&n.length!=null&&(n=n.attr("id")||""):n=w(),typeof n=="string")return this._pageMap[n];if(n)this._pageMap[n.id]=n,n.dataView&&n.dataView._id&&(this._pageMap[n.dataView._id]=n),this._pages.push(n);else return null},unloading:function(){rr()},refresh:function(n,t,i){g(n,t,i)},refreshEchoToolbarWithDelay:function(n,t){uf(n,t)},listPopup:function(n){a(n)},cardPopup:function(n){vc(n)},busyIndicator:function(n){et(n)},viewStyle:function(n,t,i){su(n,t,i)},bar:function(t,i){function c(){u=r.prev();u.is(".app-bar-actions")&&u.is(":visible")?r.css("top",u.offset().top+u.outerHeight()):r.css("top","")}function l(){r.children().each(function(){if($(this).css("display")!="none")return emtpy=!1,!1});!0&&(r.hide(),r.is(".app-bar-footer")&&n.promo().css("margin-bottom",""),a())}function a(){ii(r.closest(".ui-page"))}var r,u,f,e;if(t=="create"){var o=i.type,s=i.page,h=s.is(".ui-page")?s.find(".app-wrapper"):$(s).closest(".app-wrapper");return r=h.find(".app-bar-"+o),r.length||(o=="header"?(r=$('<div class="app-bar-header ui-header ui-bar-inherit ui-header-fixed"><\/div>').hide().insertBefore(h),c()):o=="footer"&&(r=$('<div class="app-bar-footer ui-footer ui-bar-inherit ui-footer-fixed"><\/div>').hide().insertAfter(h))),r}f=i;r=f.parent();t=="show"?(r.is(".app-bar-header")&&c(),r.show(),f.show(),r.is(".app-bar-footer")&&(e=n.promo(),e.length&&e.css("margin-bottom","").css("margin-bottom",pi(e.css("margin-bottom"))+r.outerHeight())),a(),n.tabs("fit")):t=="hide"?(f.hide(),l()):t=="remove"&&(f.remove(),l())},promo:function(n,t){function o(){!u.is(".ui-disabled")&&(r.promoteActions||gt())?$(".ui-popup-active").length?u.hide().addClass("app-hidden"):(u.show(),u.css("margin-bottom",""),f=i.activePage.find(".app-bar-footer"),f.length&&f.height()&&u.css("margin-bottom",pi(u.css("margin-bottom"))+f.outerHeight())):u.hide()}var u=this._actionButton,e,f;return arguments.length==0?u:typeof n=="boolean"?(n?o():u.hide(),u):typeof n=="string"?(e=u.data("icon"),e&&u.removeClass("ui-icon-"+e),u.addClass("ui-icon-"+n).data("icon",n).attr("title",t),n.match(il)?(u.hide().addClass("ui-disabled"),!1):(u.removeClass("ui-disabled"),o(),!0)):void 0},toolbar:function(n){var t=this._toolbar;return typeof n=="boolean"?n?t.show():t.hide():typeof n=="string"&&this._title.text(n),t},search:function(i,r){function o(t){t!=!1&&u.blur();h();n._toolbar.removeClass("app-logo-hidden");ee.show();pt.hide();g();n._contextButton.data("skipClick",!0);setTimeout(function(){n._contextButton.removeData("skipClick")},200)}function v(){if(ee=$(".ui-title,#app-btn-menu,.app-btn-cluster-right").hide(),pt=n._toolbar.find("#app-controls-find"),pt.length==0){pt=$('<div id="app-controls-find" class="app-bar-search"><form><input type="search" id="app-input-search" data-role="search" data-mini="true"/><a href="#" class="app-btn-search-cancel ui-btn-left ui-btn ui-icon-back ui-btn-icon-notext ui-shadow ui-corner-all"/><a class="app-btn-search-more ui-btn ui-btn-right ui-corner-all ui-btn-icon-notext ui-icon-carat-d"/><\/form><\/div>').insertBefore(n._toolbar.find(".ui-title"));pt.find(".app-btn-search-more").attr("title",yt.ShowAdvancedSearch).on("vmousedown",function(t){function i(){var i=n.pageInfo(u.attr("data-scope")||r.scope),t=i.dataView,s=u.val();t.extension().useAdvancedSearch(!0);e(f,function(){o();cu(t,s)})}if(!n.busy()){var f=$(t.target);return op(function(){i()})?!1:(i(),!1)}});n._searchInput=u=pt.find("input").textinput({mini:!0,clearBtnText:t.ClearText}).attr("type","text").keydown(function(t){if(t.keyCode==27)return u.blur(),!1;if(t.keyCode==40||t.keyCode==114){var f=n.pageInfo(u.attr("data-scope")||r.scope),i=f.dataView,s=u.val();return i.extension().useAdvancedSearch(!0),e(pt.find(".ui-icon-carat-d"),function(){o();cu(i,s)}),!1}}).focus(function(){n._toolbar.addClass("app-logo-hidden")}).blur(function(){var t=u.data("allow-blur")!=!1;if(!t){u.parent().addClass("ui-focus");return}no(!0);o(!1);setTimeout(function(){var t=n.dataView();t&&t._totalRowCount==-1&&t.sync()},200)});s=$('<span class="app-btn-options app-has-children"/>').appendTo(u.parent()).attr("title",t.QuickFindScope).on("vmousedown",function(){function f(n,t){t.toggleClass("app-checked");i[n]._selected=t.is(".app-checked");var r;$(i).each(function(){if(this._selected)return r=!0,!1});r||(i[n]._selected=!0,t.toggleClass("app-checked"));co(t)}var o=n.pageInfo(u.attr("data-scope")||i.scope),r=o.dataView,i=[{text:r.get_view().Label,_hint:r._controller+"."+(r._viewId||"grid1"),keepOpen:!0,context:0,callback:f}],h=(r.viewProp("quickFindHint")||"").split(";"),e;return $(n._pages).each(function(){var t=this,n=t.dataView;n&&n._filterSource==r._id&&(i.length==1&&i.push({}),i.push({text:n.get_view()&&n.get_view().Label||t.text,_hint:n._controller+"."+(n._viewId||"grid1")+"."+n._filterFields,keepOpen:!0,context:i.length,callback:f}))}),$(i).each(function(){var n=this;n._selected=h.indexOf(n._hint)!=-1;n._selected&&(n.icon="check",n.linkClassName="app-checked",e=!0)}),e||(i[0]._selected=!0,i[0].icon="check",i[0].linkClassName="app-checked"),u.data("allow-blur",!1),a({anchor:s,highlightAnchor:!1,iconPos:"right",y:s.offset().top+s.outerHeight()*.8,title:t.QuickFindScope,items:i,afteropen:function(){setTimeout(function(){u.parent().addClass("ui-focus")})},afterclose:function(){u.focus();u.data("allow-blur",null);var n=[];$(i).each(function(t){var i=this;i.text&&i._selected&&(t>0&&n.push(";"),n.push(i._hint))});r.viewProp("quickFindHint",n.length==1?null:n.join(""))}}),!1});u.parent().find(".ui-input-clear").on("vmousedown",function(){return ke(u,0),$(this).trigger("click"),!1});pt.find("form").submit(function(){return o(),l(u.val()),!1});var i=pt.find(".ui-icon-back").attr("title",re.CancelButton).on("vclick",function(){return e(i,function(){o()}),!1})}u.attr("data-scope",r.scope)}function l(t){var f=n.pageInfo(u.attr("data-scope")||r.scope),i=f.dataView,e=i.extension();i._busy()||(er(i),ca(i,t),n.toolbar(n.title()),ch())}var u=$(n._searchInput).attr("data-scope",r.scope),f=r&&r.text,s,c;if(i=="configure")r.focus?(v(),pt.show(),no(!1),r.placeholder&&u.attr("placeholder",r.placeholder),f?(u.val(f),c=u.parent().find("a"),f?c.removeClass("ui-input-clear-hidden"):c.addClass("ui-input-clear-hidden")):u.val(""),u.focus().select(),r.setCursor&&ke(u,u.val().length)):(ee&&ee.show(),pt&&pt.hide(),typeof f!="undefined"&&u.val(f)),u.attr("data-scope",r.scope);else if(i=="execute")l(r.text);else return u.val()},stickyHeaderBar:function(){return this._stickyHeaderBar},enumerateFields:function(n,t,i,r){var u=n._allFields,f=i==null;r||(r=n.extension().commandRow());f?(i=[],$(u).each(function(){this.ShowInSummary&&!this.Hidden&&i.push(this)})):t.push({text:n.get_view().Label,theme:"a",isStatic:!1,instruction:!0});$(i).each(function(){var i=u[this.AliasIndex],f=r[i.Index],e=i.text(f);i.OnDemand?i.OnDemandStyle!=1&&f&&!f.match(/^null/)&&t.push({src:String.format("{0}blob.ashx?{1}=t|{2}{3}",n.resolveClientUrl(n.get_appRootPath()),i.OnDemandHandler,f,i.OnDemandStyle==2?"&_nocrop":""),desc:i.HeaderText,display:"before"}):oo(i)&&f?t.push({text:e,desc:i.HeaderText,href:"tel:"+e,icon:"phone"}):so(i)&&f?t.push({text:e,desc:i.HeaderText,href:"mailto:"+e,icon:"mail"}):t.push({text:e,desc:i.HeaderText,isStatic:!0,display:"before"})})},infoView:function(n,i,r,u){var o=[],h=i?"left":u||"",s,e,f;for(i||o.push({text:t.Back,callback:yr,icon:"back"});n;)s=n.extension().itemMap(),e=n._allFields,f=[e[s.heading]],$(s.desc).each(function(){f.push(e[this])}),$(n._fields).each(function(){this.Hidden||f.indexOf(e[this.AliasIndex])!=-1||f.push(this)}),this.enumerateFields(n,o,f,r),n=$app.find(n._filterSource);k(o,"#app-panel-info-view"+(h?"-standalone":""),{position:h,className:"app-panel-info-view"})},modalDataView:function(n){var t=this,i,r;n?(i=t.pageInfo(n),r=t.page(n),se&&(i.text=se,se=null),i.dataView._lookupInfo||(r.is("app-modal-page")||r.addClass("app-modal-page app-form-page"),i.dataView._isModal=!0),t._modalDataViews.push(n),t.changePage(n)):($(t._modalStack).each(function(n){var i=this,r=$("#"+i.id),u=i.dataView;u.dispose();r.page("destroy").remove();n=t._modalDataViews.indexOf(i.id);t._modalDataViews.splice(n,1);n=t._pages.indexOf(i);t._pages.splice(n,1)}),t._modalStack=[])},unloadPage:function(n,t){var i=this.pageInfo(n),u;if(i&&(u=this._modalDataViews.indexOf(i.id),u>=0)){var e=i.dataView,o=$app.find(e._parentDataViewId),r=this.pageInfo(t),f=r?this._modalDataViews.indexOf(r.id):-1;(r&&(o==r.dataView||r.home)||t.attr("id")=="Main"||f>=0&&u>f)&&this._modalStack.indexOf(i)==-1&&this._modalStack.push(i)}},sidebar:function(){return hu()},desktop:function(){return f()},rowContext:function(n,t){kf(n,t)},animate:function(){return lr()},clearHtmlSelection:function(n){sf(n)},lastTouch:function(){return tt},animatedScroll:function(n,t,i){vr(n,t,i)},scroll:function(n,t){yi(n,t)},configureFilter:function(t){n.contextScope(t.scope);pr(t);n.contextScope(null)},busy:function(n){var t=this,i=t._busy==!0;if(arguments.length==1)t._busy=n;else return i?!0:(t._busy=!0,setTimeout(function(){t._busy=!1},f()?250:350),!1)},executeInContext:function(t,i){var r=[];n.navContext(r);$(r).each(function(){var r=this;if(t&&r.icon==t||!t&&r.text==i)return n.busy()||dt(r),!1})},navigate:function(t){typeof t=="string"?setTimeout(function(){t.match(/^#/)&&(t=t.substring(1));n.changePage(t)},300):t.id&&$("#"+t.id).length?($("#"+t.id).trigger("navigating.app"),n.changePage(t.id)):t.href&&lp(t.href,t.transition)},changePage:function(n,t){var a=i.activePage,v,f=this.pageInfo(n),c=$.Event("navigating.app");if(f&&(f.navigating?f.navigating=!1:($("#"+n).trigger(c),c.isDefaultPrevented()&&(f.initialized=!1,f.navigating=!0))),ut(),cf(!0),this.pageInit(n)){v=this.page(n).css("padding-top",a.css("padding-top"));var l=r.pageTransition,u=this.pageInfo(n),y=u.home?"fade":u.transition||l,p=i.navigate.history,o,e,s,h=u.navigateInfo;if(h){u.navigateInfo=null;i.navigate(h.href,{transition:h.transition});return}e=u.replaceUrl;i.changePage("#"+n,{changeHash:!(t==!1)&&!u.home,transition:y});o=p.stack;s=o[o.length-1];e&&(u.replaceUrl=null,absUrl=i.path.makeUrlAbsolute(e,i.path.documentBase),$("#"+n).attr("data-url",e),i.navigate.navigator.squash(e),s.url=absUrl);u.home&&(s.transition=l,i.path.documentBase.hrefNoHash=i.path.documentBase.hrefNoSearch,i.path.documentBase.href=i.path.documentBase.hrefNoSearch+i.path.documentBase.hash)}},title:function(){return title=document.title},navContext:function(n,i){var f=this,u=f.contextPageInfo(),v=u,r=u&&u.dataView,h=r,e=h&&h.extension(),a=r&&r.get_useCase(),o=r&&r.extension(),c=!0,l=-1;o&&(i||o&&o.context(n),u.dataView._parentDataViewId&&(u=f.pageInfo(u.dataView._parentDataViewId),r=u.dataView,l--));!e||e.inserting()||e.lookupInfo()||$(f._pages).each(function(){var o=this,u=o.dataView,v=u&&u.extension(),h,e=!1;u&&(h=!u._hidden&&!u._parentDataViewId,h&&(r&&r._filterSource?(h=$app.find(r._filterSource)==u,e=h,h||(h=$app.find(u._filterSource)==r)):h=u._filterSource?$app.find(u._filterSource)==r:!1));!h||a||o.external||(c&&(i||n.push({}),c=!1),e&&!f.contextScope()&&sc(u,n,u.extension().commandRow()),e||f.contextScope()&&e||u._autoHide==0&&!r.extension().commandRow()||n.push({text:e?t.Back:o.text,icon:e?"back":null,count:e?null:v&&!v._reset?u._totalRowCount:null,callback:e?function(){s.history.go(l)}:function(){f.changePage(o.id)},system:!0,navigateTo:e?"master":"detail",context:o&&o.id,activator:o&&o.activator}))});n.isSideBar||n.isTaskAssistant||(n.length&&n.push({}),rs||(rs={text:t.More,system:!0,callback:function(){w()=="taskassistant"?history.go(-1):vv()}}),p.siteContent&&(wt||(wt={text:"Edit",system:!0,callback:fa},wt.isStatic=!0,wt.icon="glyphicon-edit",wt.desc="Page",us={text:"Properties",system:!0,callback:bw},us.icon="glyphicon-wrench"),wt.disabled||(n.push(wt),n.push(us),n.push({}))),n.push(rs),p.help&&!s.location.pathname.match(/\/help(\/|$)/)&&ti&&(is||(is={text:nt.HelpLink,system:!0,callback:function(){ti.help()}}),n.push(is)))},refreshAppButtons:function(f,e){var et=this,b=et._title,bt=b.is(".app-hidden"),dt=b.removeClass("app-hidden").offset().left+b.outerWidth()-1,l,s,k=n._contextButton,ni=!0,d=[],a,h=[],g={search:yt.PerformAdvancedSearch,user:nf},w,v=[],nt=[],ot,st,ht,ct,lt,p=n.dataView(),it=0,c,at=e&&e.buttonBars||i.activePage.find(".app-bar-buttons"),y=p&&n.content(p._id).prevAll(".app-bar-actions"),rt,vt,pt,ut,wt,ft,tt;if(bt&&b.addClass("app-hidden"),(!e||e.toolbar)&&(gt()?k.show().attr("title",yt.HideAdvancedSearch).addClass("ui-icon-carat-u").removeClass("ui-icon-dots"):(k.attr("title",t.More).removeClass("ui-icon-carat-u").addClass("ui-icon-dots"),f.length?k.show():(k.hide(),ni=!1)),pw(),et._toolbarButtons.each(function(){l=$(this);l.show();l.offset().left>dt&&d.push(l);l.hide()}),a=d.length,a>0)){for($(f).each(function(){var n=this;s=n.icon;showOnToolbar=n.toolbar!=!1&&s!="dots"&&s!="back";s&&(!y||y.length==0||n.uiScope=="ActionBar"&&(s=="plus"||s=="edit")||n.system&&s!="info")&&!be(s)&&(s=="search"?lt=!0:s=="refresh"?st=!0:s=="phone"?ot=!0:s=="mail"?ct=!0:s=="eye"&&showOnToolbar?ht=!0:showOnToolbar&&h.indexOf(s)==-1?h.push(s):s=null,s&&(g[s]=n.text+(n.desc?"\n"+n.desc:"")),n.uiScope=="ActionBar"&&nt.push(s))}),ct&&h.push("mail"),ot&&h.push("phone"),ht&&h.push("eye"),st&&h.push("refresh"),h.length&&(!p||p.get_isGrid()&&!p.get_isEditing())&&r.promoteActions?(ut=h.indexOf("plus"),ut>0&&(h.splice(ut,1),h.unshift("plus")),w=h[0],n.promo(w,g[w])&&(n.promo().data("icon-list",{icons:h.slice().reverse(),labels:g}),v.push(w),h.splice(0,1))):gt()?kt():n.promo(!1),lt&&(h.length<a?h.push("search"):h[a-1]="search"),gu&&h.length<a&&o.width()>767&&h.push("user");nt.length>0;)s=nt[0],nt.splice(0,1),h.indexOf(s)!=-1&&h.splice(h.indexOf(s),1);for(h.length<a&&(it=a-h.length),c=0;c<it;c++)$(d[c]).hide();while(c<a)l=$(d[c]),s=h[c-it],wt=l.data("icon"),l.removeClass("ui-icon-"+wt).addClass("ui-icon-"+s).data("icon",s).show(),l.attr("title",g[s]),v.push(s),c++}for(at.length&&at.each(function(){var i=$(this),n,e,s,r,o,h;if(i.is(":visible"))if(i.children().remove(),ft)i.append(ft.html());else if(ft=i,tt||(tt=[],$(f).each(function(){var n=this,t=n.icon;!n.system&&t!="dots"&&n.text&&n.uiScope=="Form"&&tt.push(n)})),$(tt).each(function(){var n=this;$('<a href="#app-action" class="ui-btn ui-corner-all ui-mini"/>').text(n.text).appendTo(i)}),r=i.width(),n=i.find(".ui-btn").last(),n.length&&n.position().left+n.outerWidth()>r&&(i.find(".ui-btn").css("min-width","8em"),n.length&&n.position().left+n.outerWidth()>r)){if(i.find(".ui-btn").css("min-width","4em"),n.length&&n.position().left+n.outerWidth()>r)for(e=$('<a href="#app-action" class="ui-btn ui-corner-all ui-mini app-btn-more"/>').html("&nbsp;").attr("title",t.More).appendTo(i);n.length&&e.position().left+e.outerWidth()>r;)n=n.hide().prev();u.is(".app-buttons-text-only")||(o=0,s=i.find(".ui-btn:visible").each(function(){o+=$(this).outerWidth(!0)}),h=Math.ceil((r-o)/(s.length-(e?1:0))),i.find(".ui-btn:visible:not(.app-btn-more)").each(function(){var n=$(this);n.width(n.width()+h)}))}});v.length;)if(c=0,v[0]=="user")v.splice(0,1);else while(c<f.length)v.length&&f[c].icon==v[0]?(f.splice(c,1),v.splice(0,1)):c++;(!e||e.toolbar!=!1)&&y&&y.length&&(rt=y.find("h3").next(),vt=Math.floor(rt.offset().left)+rt.outerWidth(!0),pt=Math.floor(y.offset().left)+y.outerWidth()-8,ry(p,y.find(".app-bar-controls"),vt,pt,!0,w))},endModalState:function(t,r,u){var f=this.pageInfo(t._id),e=this.pageInfo(r._id);f.refreshCallback=function(){history.go(-1)};gi=function(){ut();i.navigate.history.clearForward();n.modalDataView();var r=t.get_parentDataView(),e;r&&(e=n.pageInfo(r._id),e.echoChanged=!0,r.get_isEditing()||(e.initCallback=function(){r.sync()}));u&&(f.echoInitialized!=null&&f.id!=w()?f.echoRefreshCallback=u:u())};et(!0);f.requiresReturnCallback=!0;t.sync()},renderContext:function(n,t,i){var r=!1,u;$(t).each(function(){var s,y,h;if(!i||i(this)){var t=this,o=t.icon,c=be(o),l=o=="check"||c?"false":o,e=$("<li>").attr({"data-icon":l,"data-theme":t.theme||"a"}).appendTo(n),f,a=!1,v;t.callback||t.dataRel?(f=$("<a/>").appendTo(e).text(t.text).data("context-action",t),t.count!=null&&$('<span class="ui-li-count"/>').appendTo(f).html(t.count),t.dataRel&&f.attr("data-rel",t.dataRel),t.isStatic&&f.addClass("app-summary-btn")):t.href?(e.attr("data-icon",l),f=$('<a rel="external"/>').appendTo(e).text(t.text).data("context-action",t).attr("href",t.href)):t.isStatic?e.html(t.text):t.src?$('<img class="ui-li-thumb"/>').appendTo(e.addClass("ui-li-has-thumb")).attr({src:t.src}):(r?e.remove():(v=e.attr("data-role","list-divider").html(t.text),!t.isStatic&&t.text&&t.instruction!=!1&&v.addClass("app-list-instruction")),r=!0,a=!0);a||(r=!1);t.desc&&(s=t.display=="before",s&&$('<p class="app-item-desc app-item-desc-before"/>').insertBefore((f?f:e).contents()).text(t.desc),y=$('<p class="app-item-desc"/>').appendTo(f?f:e).text(t.desc),s&&y.addClass("app-item-desc-after"));t.wrap&&e.addClass(t.callback?"app-wrap-text":"app-wrap");c&&(h=$('<span class="glyphicon"> <\/span>').addClass(o),u==null&&(u=n.closest(".app-sidebar, .ui-content.app-page-tasks").length>0),u?h.insertBefore(f.contents()):h.appendTo(f),e.addClass("app-has-glyphicon"));t.disabled&&e.addClass("ui-disabled");t.itemClassName&&e.addClass(t.itemClassName);t.linkClassName&&f.addClass(t.linkClassName);t.keepOpen&&(f.addClass("app-keep-open"),t.animate||t.count||f.addClass("app-btn-icon-transparent"));t.animate&&f.addClass("app-animated app-animation-spin");(t.selected||o=="check")&&$(vi).appendTo(f)}})},tabs:function(n,r){function f(n,t){if(!n||n=="page"||n=="user")return null;var i=ri(r.id)||[],u,f;if(n=n.toString(),typeof i=="string"&&(i=[]),$(i).each(function(t){var i=this;if(i.oid==n)return u=i,f=t,!1}),arguments.length==1)return u?u.tab:null;u?i.splice(f,1):u={oid:n};u.tab=t;i.push(u);i.length>10&&i.splice(0,1);ri(r.id,i)}function s(){function y(){n.find(".app-tab-active").is(":visible")||n.find(".app-tab-more").addClass("ui-btn-active")}var s=r.tabs,v=r.scope,p=r.placeholder||$((s[0].content||[])[0]),t=r.container||$('<div class="app-tabs ui-header ui-bar-inherit"><\/div>').insertBefore(p).addClass(r.className),n=$("<ul/>").appendTo(t),c=s[0].text,h;$(s).each(function(){if(this.selected)return c=this.text,!1});r.id||(r.id=p.attr("id"),r.id&&(r.id+="_tabs"));r.id&&(t.attr("id",r.id),c=f(v)||v=="page"&&ri(r.id)||v=="user"&&l(r.id)||c);$(s).filter(function(){return this.text==c}).length||(c=s[0].text);$(s).each(function(){var t=this,i=$('<a class="ui-btn"/>').appendTo($("<li/>").appendTo(n)).text(t.text).attr("data-text",t.text);t.active=t.text==c;t.active&&i.addClass("ui-btn-active app-tab-active")});n.on("vclick",function(c){var v=$(c.target).closest("a"),et=n.find(".app-tab-active"),k=t.parent(),p=k.find(".app-stub,.app-stub-main"),g=arguments.length!=2?null:arguments[1].selectedTab,w=h||g||v.attr("data-text"),tt=i.activePage,b,d=0,it,nt,rt;if(g&&(h=g),v.length)if(!h&&v.is(".app-tab-more"))n.find(".ui-btn").removeClass("ui-btn-active"),e(v,function(){v.addClass("ui-btn-active");nt=[];$(r.tabs).each(function(t){var i=this;nt.push({text:i.text,icon:i.active?"check":!1,wrap:!0,context:{text:i.text,index:t},linkClassName:"app-btn-icon-transparent",callback:function(t){v.removeClass("ui-btn-active");h=t.text;$(n.find(".ui-btn")[t.index]).trigger("vclick")}})});a({items:nt,anchor:v,afterclose:function(){setTimeout(function(){v.removeClass("ui-btn-active");n.find(".app-tab-active").addClass("ui-btn-active");y()},50)}})});else{if(r.stickyHeader&&(rt=ut()),n.find(".ui-btn").removeClass("app-tab-active ui-btn-active"),v.addClass("app-tab-active ui-btn-active"),$(s).each(function(){var n=this;n.active&&(w==n.text&&(it=!0),$(n.content).each(function(){d+=$(this).outerHeight(!0)}));n.active=n.text==w;n.active&&(b=n)}),it){h=null;y();return}r.scope=="page"?ri(r.id,w):r.scope=="user"?l(r.id,w):f(r.scope,w);d&&p.length&&p.offset().top+p.outerHeight()-d<k.offset().top+k.height()&&p.height(d+p.outerHeight());eh(tt);o(t);h&&(h=null,u(t));function ft(){y();b.callback&&b.callback();r.change&&(li=!1,r.change(b),r.restoreScrolling!=!1&&hf(tt));r.stickyHeader&&rt&&ui();nv(k,p)}b.content?ft():(ut(),setTimeout(function(){ft()},50))}return!1});t.data("data-tabs",r.tabs);o(t);u(t,!1)}function h(n){n||(n=r.container?r.container.find(".app-tabs"):i.activePage.find(".app-wrapper .app-tabs"));n.find("ul").off();n.data("data-tabs",null).remove()}function o(n){n||(n=i.activePage.find(".app-wrapper .app-tabs"));$(n).each(function(){$($(this).data("data-tabs")).each(function(){var n=this;$(n.content).each(function(){n.active?$(this).removeClass("app-tab-hidden"):$(this).addClass("app-tab-hidden")})})})}function u(n){n||(n=(r&&r.page||i.activePage).add($(".ui-page.ui-page-active .app-bar-header.ui-header-fixed")));var u=n.find(".app-tabs");u.find("ul").css("visibility","");u.each(function(){var f=$(this),r=f.width(),u=f.offset().left+pi(f.css("padding-left")),i,n,o,e;if(r&&(f.find(".app-tab-more").parent().remove(),i=f.find(".ui-btn").css({"padding-left":"","padding-right":"","min-width":"","max-width":"",display:""}),n=i.last(),n.offset().left-u+n.outerWidth()>r&&(i.css("min-width","8em"),n.offset().left-u+n.outerWidth()>r&&(i.css("min-width","4em"),n.offset().left-u+n.outerWidth()>r&&(i.css({"padding-left":"1em","padding-right":"1em"}),n.offset().left-u+n.outerWidth()>r&&(i.css({"padding-left":".5em","padding-right":".5em"}),n.offset().left-u+n.outerWidth()>r))))))for(n=$('<a class="ui-btn app-tab-more"/>').appendTo($("<li/>").appendTo(n.closest("ul"))).text(t.More).css({"min-width":"4em","padding-left":"0.5em","padding-right":"0.5em"}),e=i.length-1;n.offset().left-u+n.outerWidth()>r;){if(!e){$(i.get(0)).css("max-width",r-n.outerWidth()-12);break}o=$(i.get(e)).css("display","none");o.is(".app-tab-active")&&n.addClass("ui-btn-active");e--}})}switch(n){case"create":r.tabs&&r.tabs.length>1&&s(r);break;case"destroy":h();break;case"fit":u()}},refreshMenuStrip:function(){var r=this._menuStrip,h=r&&r.strip,p=this._title,ft=p.is(".app-hidden"),b=p.removeClass("app-hidden").offset().left,k=this._toolbar.find(".app-btn-cluster-right .ui-btn").filter(uu).first(),w=(k.length?k.offset().left:this._toolbar.outerWidth())-10,d=it.nodes,l,y,c,et,g,a,u,nt,tt,o;if(!h){for(r=this._menuStrip={strip:$('<div class="app-menu-strip"/>').appendTo(this.toolbar())},h=r.strip,l=$("<ul/>"),o=0;o<d.length;o++){var v=d[o],u=$("<li/>").appendTo(l),rt=$('<a class="ui-btn"/>').appendTo(u).text(v.title).attr({title:v.description}).data("data-node",v);v.children&&rt.addClass("app-has-children");v.selected&&rt.addClass("app-selected")}r.links=l.find(".ui-btn");r.items=r.links.parent();r.more=$('<a class="ui-btn app-has-children"/>').appendTo($("<li/>").appendTo(l)).text(t.More);function ut(n){var i=n.url,t;i&&(t=i.match(ie),t?s.open(t[2],t[1]):s.location.href=i)}l.appendTo(h).on("vclick contextmenu",function(t){var u=$(t.target).closest(".ui-btn"),o=u.is(".app-selected"),r=u.data("data-node"),s=r&&r.url&&!r.children;if(u.length==0)return!1;if(s){if(t.type=="contextmenu")return!1;r.url&&!r.url.match(ie)&&rr()}return e(u,function(){if(s)ut(r);else{o||u.addClass("app-selected");var t=$('<div class="app-popup app-popup-listview app-popup-menu" data-theme="a"/>'),e=$('<div class="ui-panel-inner"/>').appendTo($('<div class="ui-content"/>').appendTo(t)),a=$('<ul class="app-listview"/>').appendTo(e),c,v,l,y=1;function p(n,t){if(n.title){var i=$('<li data-icon="false"/>').addClass("app-depth"+t).appendTo(a),r=$("<a/>").appendTo(i).text(n.title).attr("title",n.description).data("data-context",n);n.selected&&(v=r)}$(n.children).each(function(){p(this,t+1)})}r||(y=0,r={children:[]},h.find("li:hidden a").each(function(){r.children.push($(this).data("data-node"))}));p(r,y);v&&$(vi).appendTo(v).parent().addClass("app-selected").parent().attr("data-icon","false");a.listview().on("vclick",function(i){var r=$(i.target).closest(".ui-btn"),u=r.data("data-context");return oi(r)&&u&&u.url&&n.callWithFeedback(r,function(){c=u;vt(t)}),!1});n.promo(!1).addClass("app-hidden");t.popup({history:!f(),transition:as(!0),tolerance:3,arrow:"t,l,r,b",overlayTheme:"b",positionTo:u,beforeposition:function(){var u=i.getScreenHeight(),o=n.toolbar().outerHeight(),s=t.outerHeight(!0),r;s>=u-o&&(e.css("height",u-o*2.25),f()&&(r=e.width()+20,e.css({width:r}),t.css({minWidth:r,maxWidth:"auto"})))},afteropen:function(){yc(null,t);f()&&e.focus()},afterclose:function(){o||u.removeClass("app-selected");c&&c.url&&!c.url.match(ie)&&rr();gt()&&kt();setTimeout(function(){we();up(a);au(t);e.off();c&&ut(c)},100)}});to(t);lv(t,!0);t.popupopen().closest(".ui-popup-container").css("marginTop",pi(u.css("fontSize"))*2/3);l=e.find(".ui-btn.app-selected").parent();l.length&&l.position().top+l.outerHeight()-1>e.outerHeight()&&e.scrollTop(l.position().top-(e.outerHeight()-l.outerHeight())/2)}}),!1})}if(ft&&p.addClass("app-hidden"),a=w-b,a!=h.data("tested-width")||!h.is(":visible"))if(h.data("tested-width",a),a>=50&&h.attr("data-enabled")!="false")for(of(!0),h.width(a).css({left:b}),y=r.items,c=r.more.removeClass("app-selected").parent(),et=c.find(".ui-btn").text(t.More),c.hide(),y.show(),o=y.length-1;o>=0;o--){if(u=$(y[o]),tt=u.outerWidth(),nt=u.offset().left,nt+tt-1>=w&&(c.show(),g=c.outerWidth(),u.hide()),u.is(":hidden")&&u.find(".app-selected").length&&r.more.addClass("app-selected"),!c.is(":visible")||c.offset().left+g-1<w){o<=1&&!u.is(":visible")&&of(!1);break}else u.hide(),u.find(".app-selected").length&&r.more.addClass("app-selected");if(o<=1){of(!1);break}}else of(!1)},refreshSideBar:function(i,r){function rt(){(l=!1,f.dataView().get_showViewSelector())&&(ya(r),f.tagged("view-style-grid-disabled")||r.push({text:t.Grid,icon:"grid",selected:b,callback:function(){b||su(e,"Grid")}}),f.tagged("view-style-list-disabled")||r.push({text:t.List,icon:"bullets",selected:d,callback:function(){d||su(e,"List")}}),f.tagged("view-style-cards-disabled")||r.push({text:t.Cards,icon:"cards",selected:k,callback:function(){k||su(e,"Cards")}}),f.tagged("supports-view-style-map")&&!f.tagged("view-style-map-disabled")&&r.push({text:t.Map,icon:"location",selected:g,callback:function(){g||su(e,"Map")}}),n.presenter("enumerate",{id:e,list:nt}),$(nt).each(function(){var n=this;f.tagged("view-style-"+n.name.toLowerCase()+"-disabled")||(n.name==s&&(n.selected=!0),r.push(n))}),ya(r))}var ut=this,ft=hu().find(".ui-panel-inner"),v=n.pageInfo(),u=v&&v.dataView,y=u,e=u&&u._id,o=u&&u.get_parentDataView(u),h=[],p=u&&n.content(u._id).prev().is(".app-bar-actions"),c=$('.TaskBox.About .Inner .Value, head meta[name="description"]'),w=o&&!o._parentDataViewId,l=u&&u.get_isGrid(),f=u&&u.extension(),s=l&&f.viewStyle(),b=s=="Grid",k=s=="Cards",d=s=="List",g=s=="Map",nt=[],et={items:r},tt=[],it=["back","check","info"],a;if(w){for(u=o;u;)u.get_showInSummary()&&!u.get_isInserting()&&u.extension().commandRow()&&h.unshift(u),u=$app.find(u._filterSource);$(h).each(function(){n.enumerateFields(this,r)});r.length&&(u=h[h.length-1],a=r[0],a.icon="info",a.callback=function(){n.infoView(u,!0)},r.push({}))}p&&y&&(y.extension().context(tt,["ActionBar"]),$(tt).each(function(){var t=this,n=t.icon;t.uiScope=="ActionBar"&&n&&n!="dots"&&n!="carat-r"&&it.push(n)}));$(i).each(function(){var n=this;it.indexOf(n.icon)!=-1||n.system&&n.toolbar==!1||n.command=="Select"||n.icon=="eye"&&(!o||o.get_showInSummary())||(n.text||r.length)&&(n.navigateTo&&l&&rt(),n.theme=null,n.uiScope=="ActionBar"&&p||r.push(n))});l&&rt();c.length&&w!=!1&&(r.length&&r[r.length-1].text&&r.push({}),r.push({text:c.is("meta")?c.attr("content"):c.html(),isStatic:!0,wrap:!0}))},contextPageInfo:function(){return n.pageInfo(this._contextScope)},refreshContext:function(){g()},contextScope:function(n){if(arguments.length==0)return this._contextScope;this._contextScope=n},contextDataView:function(){var n=this.contextPageInfo();return n?n.dataView:null},showContextMenu:function(t){var i="#app-panel-context";t&&(this.contextScope(t.scope),t.scope&&(i+="-scope",t.position="left"));ey(i,function(){n.refreshContextMenu(i)},t).panel("toggle")},refreshContextMenu:function(n,i){var s=this,r=$(n),f=r.find("ul"),v=f.outerHeight(),c,l,e=r.is(".app-sidebar"),h,a;if(e&&!r.is(":visible")){i=[];s.navContext(i);s.refreshAppButtons(i);return}for(e&&!si&&(l=$("<div><\/div>").appendTo(u).css({"z-index":2e3,position:"absolute",left:0,top:r.find(".ui-panel-inner").offset().top,width:r.outerWidth(),height:o.height(),"background-color":"#fff"})),v&&(c=$("<div><\/div>").height(v).insertAfter(f)),wr(f),f.find("a").removeData(),f.find("li").remove(),i||(i=[],i.isSideBar=e,s.navContext(i)),e&&(s.refreshAppButtons(i),a=[],this.refreshSideBar(i,a),i=a),h=$.Event(e?"sidebar.app":"more.app"),h.items=i,h.panel=r,$(document).trigger(h);i.length&&!i[i.length-1].text&&!i[i.length-1].src;)i.splice(i.length-1);i.length||e||i.push({text:t.EmptyContext});this.renderContext(f,i);f.listview("refresh");e&&f.find("a.ui-btn-icon-right").removeClass("ui-btn-icon-right").addClass("ui-btn-icon-left");f.find("li.app-wrap").addClass("ui-li-static ui-body-a").find("a").attr({"class":""});r.is(".app-reset-scrolling")?r.find(".ui-panel-inner").scrollTop(0):vb(r);c&&c.remove();l&&l.remove()},masterDetailStatus:function(n){var u=this.pageInfo(n),t,i;if(u!=null&&(t=u.dataView,t&&t._filterSource&&(i=$app.find(t._filterSource),i))){var f=i.extension(),e=f.itemMap(),s=i._allFields,o=f.commandRow(),r;e&&o&&(r=s[e.heading],v=o[r.Index],v=r.text(v),this._masterHeading=v)}},focus:function(t,r){var l=this,e=i.activePage,u=e.find(".app-field-"+t),s,f=$(".app-popup-message"),h=e.find(".app-tabs-form"),o,c;f.length||u.length&&(s=u.closest("li"),u.attr("type")=="hidden"&&(u=u.prev(),u.is(".app-container-scrollable")||(u=s.find('input[type="text"]'))),h.length&&(o=n.dataView(),c=o.findField(t),$(o._categories).each(function(){var n=this;if(n.Index==c.CategoryIndex)return h.find(".ui-btn").each(function(){var t=$(this);if(n.Tab==t.text())return t.is(".ui-btn-active")||t.trigger("vclick"),!1}),!1})),fh(e,u,function(){f=$('<div class="ui-content app-popup-message"/>').html(r).popup({history:!1,arrow:"t,b",overlayTheme:"b",positionTo:u,afteropen:function(){},afterclose:function(){au(f);u.focus()}}).popupopen().on("vclick",function(){return vt(f),!1})}))},showLookup:function(n){var l=this.pageInfo(),o=l.dataView,t=n.field,s=t._dataView,h=s.get_contextFilter(t,s.extension().collect()),i,r,f,e=n.query,c=n.aliasField.HeaderText;this.modalDataView();i=n.field.ItemsDataController.toLowerCase();$find(i)&&(i+=Sys.Application.getComponents().length);e&&ri(i+"_"+(ri(i+"_viewId")||t.ItemsDataView||"grid1")+"_filter",[String.format("_quickfind_:~%js%{0}",Sys.Serialization.JavaScriptSerializer.serialize(e))]);r=$create(Web.DataView,{id:i,baseUrl:o.get_baseUrl(),servicePath:o.get_servicePath(),controller:t.ItemsDataController,viewId:t.ItemsDataView,externalFilter:s.get_contextFilter(t,h),externalFilter:h,filterSource:h.length>0?"Context":null,showSearchBar:!0,showFirstLetters:t.ItemsLetters,searchOnStart:t.SearchOnStart,description:t.ItemsDescription},null,null,$("<div>").hide().appendTo(u).attr("id",i+"Placeholder")[0]);f=this.pageInfo(r._id);e&&r.viewProp("quickFind",e);f.headerText=n.value?[n.text,c]:c;f.resolved=!0;r._lookupInfo=n;n.value==null||t.ItemsValueSyncDisabled||(r._syncKey=[n.value],r._selectedKey=[n.value]);r._parentDataViewId=o._id;this.modalDataView(f.id)},pageInit:function(n,t){var i=this.pageInfo(n),r,u;return i==null?!1:(r=i.dataView,u=i.initialized||!i.dataView&&i.initialized!=!1,r&&r._busy())?!1:(i.initialized||(i.initialized=!0,r&&(i.requiresInitCallback=!0,t!=!1&&et(!0),i.refreshed==!1?(i.refreshed=!0,r.extension().refresh()):r._loadPage())),u)},pageShow:function(n){var t;if(i.activePage&&(i.activePage.find("[data-role='navbar'] a.app-tab-active").addClass("ui-btn-active"),t=this.pageInfo(n),t!=null)){var r=t.dataView,u=r?r.extension():null,f=this._modalStack.indexOf(t);f>=0&&this._modalStack.splice(f,1);t.initialized||(t.initialized=!0,r&&r._loadPage());u&&u._reset&&u.refresh()}},screen:function(){var n=i.window.scrollTop(),t=this.toolbar().outerHeight(),r=i.getScreenHeight();return{top:n+t,bottom:n+i.getScreenHeight(),height:r-t,width:o.width()}},callWhenVisible:function(n,t){i.activePage.find(n).each(function(){var n=$(this);if(n.is(":visible")){var i=n.offset().top,u=i+n.outerHeight(),e=n.closest(".app-wrapper"),r=e.offset().top,f=r+e.height()-1;(r<=i&&i<=f||r<=u&&u<=f||i<=r&&f<=u)&&t(n)}})},asyncJob:function(){return this._asyncJob},nextAsycJob:function(){return++this._asyncJob},supports:function(n){switch(n){case"Map":return this._supportsMap==!0}return!1},registerAPI:function(t,i){var u=this,f;t=="Map"&&(u._mapAPI?i&&i():(f="https://maps.googleapis.com/maps/api/js?&callback=appFactoryCallback",r.mapApiIdentifier&&!s.location.host.match(/^localhost\b/)&&(f+="&"+r.mapApiIdentifier),u._mapAPI=!0,s.appFactoryCallback=function(){u._supportsMap=!0;$(document).trigger($.Event("map.init.app"));i&&i();s.appFactoryCallback=null},$.getScript(f)));t!="Charts"||u._chartsAPI||n.registerAPI("Map",function(){$.getScript("https://www.google.com/jsapi",function(){u._chartsAPI=!0;$(document).trigger($.Event("charts.init.app"));i&&i()})})},fetchOnDemand:function(){function i(n){n.trigger("vclick")}if(!li){var t=n.dataView();t&&t._calcNotify&&t.extension().calcNotify();this.callWhenVisible(".dv-load-at-bottom",i);this.callWhenVisible(".dv-load-at-top",i)}return this},callInAnimationFrame:function(n){if(os)var t=os(function(){n();sw(t)});else n()},toPixels:function(n){return pi(n)},stickyHeader:function(){var n=this;return n.callInAnimationFrame(function(){var s=tf(),u=s.attr("data-selector"),t=u?i.activePage.find(u):s.find(".app-static-text"),r=n.stickyHeaderBar(),f,e,a=!0;if(!r.is(".app-disabled")&&!b&&(t.length||u)&&!s.is(".app-disabled")&&!c){var y=nr(),p=Math.ceil(t.length?t.offset().top:-1),h,o,l,v=0;p<y.offset().top&&(u||t.height()>0)&&(r.is(":visible")?a=!1:(a=!1,r.show(),i.activePage.find(".ui-content").children().each(function(){var n=$(this);n.is(".app-tabs,.app-bar-actions,.app-bar-header")&&n.css("display")!="none"&&(v+=n.outerHeight())}),o=t.closest("li").find("label").first().text(),e=r.find(".app-bar-label"),o!=e.data("label")&&(o?e.text(o).show():e.hide(),e.data("label",o)),f=r.css("top",n.toolbar().outerHeight()+v-1).find(".app-bar-text"),u?(l=s.html(),l!=f.data("html")&&f.data("html",l).html(l).css("white-space","normal")):(h=t.text(),h!=f.data("text")&&f.data("text",h).text(h).css("white-space",""))))}a&&r.hide()}),n},wait:function(){},start:function(t){function d(n){return $(n).each(function(){return this.url&&this.url.toLowerCase()==location.pathname.toLowerCase()?(c=this,!1):this.children&&(d(this.children),c)?(this.selected=!0,!1):void 0}),null}function nt(){var n=t&&$(t.selector).data("scripts");n&&eval(n);$(document).trigger($.Event("start.app"));n||setInterval(function(){hr.length&&!ae&&(ae=hr[0],$(document).trigger($.Event("calculate.app"),ae))},300)}function tt(){n.tabs("create",{tabs:v,className:"app-tabs-echo",scope:"page",change:function(){at()}})}var k,c;if(t||this._appLoaded&&this._pageCreated){it.nodes||kk();i.ignoreContentEnabled=!0;var f=n.pageMenu(t&&t.pageId),w=0,h,b=$(t&&t.selector||"#PageContent"),e=b.attr("data-href"),p=b.find('div[data-app-role="page"]').each(function(i){var r=$(this),c=r.find('> div[data-role="content"]'),s=r.attr("data-content-framework");s&&r.attr("data-enhance","false");c.length||(c=$('<div data-role="content"><\/div>'),r.contents().appendTo(c),c.appendTo(r));r.attr({"data-role":"page","data-app-role":null}).addClass("app-page-scrollable").appendTo(u);var v=$app.eval(r.attr("data-page-header")),h=uy(r),o={text:(v!="false"?v:"")||h.text||n.title(),description:h.description,activator:h,url:e,transition:t&&t.transition},l=r.attr("id")||bl(e||location.pathname)+(i>0||e?i+1:"")||"_root",y,a;o.headerText=o.text;r.find('div[data-role="content"]').contents().wrapAll('<div class="app-page-content'+(s?" app-content-framework app-"+s:"")+'"/>');r.page();r.attr("id",l);o.id=l;n.pageInfo(o);a=oh(r,!1).find(".app-page-content");s&&(r.attr("data-page-header","false"),$app.configureFramework(s,a,function(n){du=n}));a.find(".carousel").on("swipeleft swiperight",function(n){$(n.target).closest(".carousel").find((n.type=="swipeleft"?".right":".left")+".carousel-control").trigger("click")});h.text&&(w++,y=$('<a class="app-action-navigate" />').attr("href","#"+l).text(h.text).appendTo($("<li/>").appendTo(f)),o.description&&$("<p/>").appendTo(y).text(o.description));uh(r)});p.length&&(h=p.first(),w==0&&h.attr("data-activator")!="false"&&$('<a class="app-action-navigate" />').attr("href","#"+h.attr("id")).text(h.attr("data-page-header")||fl.SeeAlso).appendTo($("<li/>").appendTo(f)),f.is(".ui-listview")&&f.listview().listview("refresh"));k=it.nodes;t||d(k);c&&!p.length&&f.find("a").length==0&&$(c.children).each(function(){$('<a rel="external"/>').attr("href",this.url).appendTo($("<li/>").appendTo(f)).text(this.title)});var rt=this,o=t?n.page(t.pageId):i.activePage,l=o.find("a.app-action-navigate"),ut=location.href.match(/#(.+)$/),a,v=[],y,g=this._pages[0];l.length==1&&(r.initialListMode=="SeeAll"||!g.dataView||g.dataView.get_lastCommandName()||s.location.href.match(/_controller=.+_commandName=.+/))?$(this._pages).each(function(){var n=this,t=n.dataView;return yl=t&&t._id,(!e||n.url==e&&!n.root)&&(!t||!t._hidden)?(e||(n.home=!0,e=i.path.documentBase.pathname+s.location.search),nt(),i.navigate.history.clearForward(),e&&(n.replaceUrl=e),ku==null&&(ku=!0,setTimeout(function(){ku=!1},1e3)),rt.changePage(n.id),!1):void 0}):o.attr("id")=="Main"&&(l.length&&o.find('a[rel="external"]').parent().remove(),l.show(),oh(o),o.addClass("app-page-scrollable"),st(document.title),a=o.find(".app-wrapper"),$(l).each(function(){var u=$(this),f=u.attr("href"),r=f&&n.pageInfo(f.substring(1)),i,e,t;r&&r.dataView&&r.activator.type!="Button"&&(t=r.activator,t&&t.type=="Tab"&&($(v).each(function(){if(this.text==t.text)return i=this,!1}),i||(y!=t.container&&(y&&(tt(),v=[]),y=t.container),i={text:t.text,content:[]},v.push(i))),e=wv(r.id,a),i&&i.content.push(e),u.parent().remove())}),y&&tt(),f=n.pageMenu(),f.find('a.app-action-navigate,a[rel="external"]').length?f.listview().show():f.remove(),ii(),a.find(".app-tabs").length>1&&$('<div class="app-stub-main"/>').appendTo(a),tr(),nt(),at(),n.content().focus(),fv())}},pageMenu:function(n){var r=this,i=this.content(n),t=i.find("ul.app-page-menu");return t.length||(t=$('<ul data-role="listview" data-inset="false" class="app-page-menu"/>').appendTo(i).hide().on("vclick",function(n){var t=$(n.target),i,u;return t.is("a")||(t=t.closest("a")),t.length&&(i=t.attr("href"),u=i.match(/^#/),u||rr(),e(t,function(){u?r.changePage(i.substring(1)):(h(t,!1),s.location.href=i)})),!1})),t},initialize:function(){function a(){var n=fu(),t;if(n-s>2500){if(t=$.Event("awake.app"),$(document).trigger(t),t.isDefaultPrevented())return;n=fu()}s=n;setTimeout(a,1250)}var v=this,s=fu(),r=i.path.parseUrl(location.href),e=r&&r.hash,o,l=$("head"),t=$('<div class="app-scrollbar-info"><div><\/div><\/div>').appendTo(u);ei={width:t[0].offsetWidth-t[0].clientWidth,height:t[0].offsetWidth-t[0].clientWidth,gridColumnPadding:16};t.remove();v._stickyHeaderBar.css("right",ei.width);ob();e&&(e.match(/\W/)||!$(e).length)&&(i.navigate.history.initialDst="",o=i.navigate.history.stack[0],o.url=r.hrefNoHash,o.hash="",i.path.documentBase.href=i.path.documentBase.hrefNoHash);ht?$('<meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="black'+(gf>=8?"-translucent":"")+'"/><link rel="apple-touch-icon" href="../touch/logo-icon.png"/>').appendTo(l):nu&&$('<meta name="mobile-web-app-capable" content="yes"/><link rel="icon" sizes="196x196" href="../touch/logo-icon.png"/>').appendTo(l);setTimeout(a,10);p.appInfo.match(/\|$/)||$("#app-welcome").remove();$(document).on("change",":input",function(n){var t=$(n.target),i=t.attr("data-passive-value");(i==null||i!=t.val())&&de(t);i!=null&&t.attr("data-passive-value",null)}).on("keydown",":input",function(n){var t=$(n.target),i=t.attr("data-causes-calculate");i&&(le==null&&(le=t.val()),ah(),ce=setTimeout(function(){le!=t.val()&&(t.attr("data-passive-value",t.val()),de(t));ah(!0)},4e3))}).on("focus",":input",function(t){var i=$(t.target),o=i.parent(),r=i.data("format"),e,u;i.is("#app-input-search")||(c=i,h(),i.is(".app-lookup-input")&&i.next().addClass("ui-focus"),ut(),r&&(e=i.val(),e&&r.type=="number"&&(i.val(r.value),u=i.val().length,i.get(0).setSelectionRange(u,u)),ht?setTimeout(function(){i.attr("type",r.type)},200):i.attr("type",r.type)),f()||(ke(c),clearTimeout(el),n.toolbar().css("position","absolute"),$(".app-sidebar").css("position","absolute")))}).on("blur",":input",function(t){ss=new Date;var r,e,u,o=$(t.target),i=o.data("format");(ah(!0),c)&&(c.is(".app-lookup-input")&&(e=c.data("link-text"),r=c.data("link-text",null).next().removeClass("ui-focus"),e&&(r.toggleClass("ui-icon-carat-r ui-icon-search").removeClass("app-transparent"),setTimeout(function(){r.data("link-text")&&r.text(e)},2500)),u=c.val().trim(),u&&(r.text(u).data("data-context").query=u),c.val("")),c=null,i&&(i.value=o.val(),i.value=i.value?parseFloat(i.value):null,i.text=i.value==null?"":i.field.text(i.value,!1),o.attr("type","text").val(i.text)),f()||(el=setTimeout(function(){c||(n.toolbar().css("position",""),$(".app-sidebar").css("position",""))},1e3)))}).on("touchstart","a.app-lookup",function(){if(c){var n=c.val().trim();n&&c.next().text(n).removeClass("app-transparent")}}).on("touchend","a.app-lookup",function(){rt()}).on("keydown",function(n){var i=n.which,r,t;if(i==13&&!$(n.target).is("textarea")){if(c)return c.is(".app-lookup-input")?(r=c.val().trim(),(r.length||ni)&&(c.next().data("data-context").query=r,c.next().trigger("vclick"))):gt()?setTimeout(function(){c&&c.blur();pf(!0)},200):setTimeout(function(){c&&c.blur()},200),!1;gt()&&(t=$(".ui-popup-active"),t.length?t.find(".ui-listview .ui-btn").length||$(".ui-popup-active .ui-popup").popup("close"):pf(!0))}if(!c&&(i==13||i==32||i==27)&&(t=$(".ui-popup-active .app-popup"),t.length)){if(t.is(".app-popup-alert"))return t.find(".ui-btn").trigger("vclick"),!1;if(t.is(".app-popup-confirm")&&i!=32)return t.find(i==13?".app-btn-confirm":".ui-btn:not(.app-btn-confirm)").trigger("vclick"),!1}}).on("keyup",".app-lookup-input",function(n){var t=$(n.target),i=t.next();t.data("link-text")||setTimeout(function(){t.val()!=""&&(t.data("link-text",i.text()),i.html("&nbsp;").toggleClass("ui-icon-carat-r ui-icon-search app-transparent"))},10)})},presenter:function(t,i){function u(){r[i.name]=i}function f(n){su(n.id,n.name)}function e(){var n=r[typeof i=="string"?i:i.name];return n&&(typeof i=="string"||n.supports($app.find(i.id),i.config))}function o(){var f=$app.find(i.id),o=f.extension(),e=i.container.is(".app-echo-inner"),t=ac(),u;if(e||f==n.dataView()){if(t=r[i.name],e&&t.echo&&!t.echo())return!1;e||(ra(i.container,o),i.container.find('ul[data-role="listview"]').hide(),ih(i.container,o));u=$(i.container).find('div[data-presenter="'+t.name+'"][data-scope="'+f._viewId+'"]');u.length||(u=$('<div data-role="presenter" class="app-presenter"><\/div>').appendTo(i.container).attr({"data-presenter":t.name,"data-scope":f._viewId}));u.show();i.container=u;t.show(i)}else fr(i.id+"_echo");return!0}function s(){$(i.container).find('div[data-role="presenter"]').each(function(){var n=$(this),u=n.attr("data-presenter"),t=r[u];t&&(i.container=n,t.hide(i),n.hide())})}function h(){$(i.container).find('div[data-role="presenter"]').each(function(){var n=$(this),u=n.attr("data-presenter"),t=r[u];t&&(i.container=n,t.dispose(i),n.remove())})}function c(){var u=$app.find(i.id),e=vw(),t,n;for(t in r)n=r[t],n.supports(u)&&(!e||!n.echo||n.echo())&&i.list.push({name:t,text:n.text(),icon:n.icon(),context:{id:u._id,name:t},callback:f})}function l(){return r[i.name]}var r=n._presenters;switch(t){case"supports":return e();case"enumerate":c();break;case"register":u();break;case"show":return o();case"hide":s();break;case"dispose":h();break;case"find":return l()}}},function(){var p,r,w,c,l;$.event.special.swipe.scrollSupressionThreshold=100;var b=/\b_touch_(\w+)=(\w+)\b/g.exec(location.href),a=i.focusPage;i.focusPage=function(n){a(n);ii(n);hf(n)};$.extend($.fn.buttonMarkup,{initSelector:"a:jqmData(role='button'), .ui-bar > a, .ui-bar > :jqmData(role='controlgroup') > a"});i.resetActivePageHeight=function(t){var r=$("."+i.activePageClass);typeof t=="number"&&t--;t=t||i.getScreenHeight();t-=n.toolbar().outerHeight(!0);t!=NaN&&r.css("min-height",t)};u=$("body");ni&&u.addClass("app-desktop");navigator.maxTouchPoints>0&&(si||s.PointerEvent)&&(u.addClass("app-ms-tablet").removeClass("app-desktop"),ne="touch");$("#aspnetForm").hide();var f=$('<div id="app-bar-tools" data-role="header" data-position="fixed" data-theme="a" class="app-bar-tools"><\/div>').appendTo(u),v=$('<div data-role="page" id="Main"><\/div>').appendTo(u),o='<a href="#" class="ui-btn-right app-btn ui-btn ui-btn-icon-notext ui-shadow ui-corner-all"/>',k=$('<a class="ui-btn ui-btn-a ui-btn-icon-notext app-btn-promo"/>').hide().appendTo(u).on("vclick",cp),y;$('<div data-role="content" class="app-content-main"><\/div>').appendTo(v);y=$('<a data-role="button" href="#" id="app-btn-menu" class="ui-btn ui-btn-icon-notext ui-shadow ui-corner-all ui-icon-bars app-animation-spin">Site Map<\/a>').appendTo(f);p=$('<h1 class="ui-title"/>').appendTo(f).on("vclick",function(){return n._menuButton.trigger("vclick"),!1});r=$('<div class="app-btn-cluster-right"><\/div>').appendTo(f);f.on("vclick",lw);$(o).appendTo(r);$(o).appendTo(r);$(o).appendTo(r);$(o).appendTo(r);$(o).appendTo(r);$('<span class="app-user-name"/>').appendTo(r);$('<a href="#" id="app-btn-context" data-icon="dots" data-iconpos="notext" data-role="button" class="ui-btn-right app-btn-context"/>').appendTo(r).attr("title",t.More).hide();$('<div id="app-bar-heading" class="app-bar-heading"><div class="app-bar-label"><\/div><div class="app-bar-text"><\/div><\/div>').appendTo(u).hide().on("vclick contextmenu",function(n){var t=$(n.target);if(t.closest(".app-group").length&&!t.is(".app-group"))return fc(!0),!1});w=f.find(".app-btn").data("icon","gear").on("vclick",cp);f.toolbar();c=$('<div id="app-sidebar" class="ui-panel ui-panel-fixed ui-body-a app-sidebar"><div class="ui-panel-inner"><ul/><\/div><\/div>').appendTo(u);l=c.find("ul");l.listview().on("vclick",function(t){if(tu||!oi(t.target))return!1;rt();var i=$(t.target).closest("a"),r=i.data("context-action");if(i.length){if(r)return n.busy()||e(i,function(){dt(r)}),!1;h(i,!1)}})}();n=$app.touch=$app.mobile=new Web.Mobile;n.activeLinkBlacklist=".ui-slider-handle,.dv-action-see-all,.app-do-not-activate";n._presenters={};u.on("pagebeforeload",function(n,t){n.preventDefault();setTimeout(function(){location.replace(t.toPage)},200)}).on("pagecontainershow",function(){function i(){gi&&(gi(),gi=null,t&&t.returnCallback&&(t.returnCallback(),t.returnCallback=null))}cf(!1);fv();wi(100);setTimeout(function(){at();rh()},200);g();var t=n.pageInfo(),r=$.Event("show.dataview.app");t?(t.initCallback?(t.initCallback(),t.initCallback=null):i(),r.dataView=t.dataView):ro()&&i();tr();$(document).trigger(r)}).on("pagecontainercreate",function(){n._shown||setTimeout(function(){n.start();n._shown=!0},100)}).on("pagecontainerbeforeshow",function(t,r){var e=i.activePage,f=n.pageInfo();n.toolbar(n.title());u.is(".app-page-header-hidden")?st(!1):st(f&&f.headerText||f&&f.dataView&&f.dataView.get_view().Label||document.title);n.pageShow(w());n.unloadPage(r.prevPage,e);hh();n.contextScope(null)}).on("pagecontainerbeforehide",function(t,i){if(b=!0,i.nextPage){var r=n.pageInfo(i.nextPage.attr("id"));r&&n.masterDetailStatus(r.id)}}).on("pagecontainerbeforetransition",function(){n.promo(!1);eh(i.activePage);ph(hu())}).on("pagecontainertransition",function(){r&&(cf(!1),ii(),r.pageTransition=="none"&&hf(i.activePage),ni&&$(i.activePage).find(".app-wrapper").focus())});$(document).ready(function(){p=__settings;n.initialize()}).on("mousedown",function(n){var t=$(n.target).closest(".app-draggable");t.length&&($.event.special.swipe.eventInProgress=!0)}).on("dragend",function(){$.event.special.swipe.eventInProgress=!1}).on("calculate.app",function(t,i){if(i=i.split(/\./),i[i.length-1]=="app"){var r=n.pageInfo(i[1]).dataView;return r.extension().calculate(i[0]),!1}}).on("touchstart MSPointerDown pointerdown",function(t){if((tt=df(t),!c)&&yo(t)){if(b){t.preventDefault();return}var r=$(t.target),i=r.closest("a"),u=gc=df(t);po=c==null&&r.closest(".app-scrollable").length==0;r.closest(".app-echo").length&&(po=!1);i.length&&(br=i.data("touch-start",u),i.is(n.activeLinkBlacklist)||(i.parent().is("li")?(clearTimeout(dc),dc=setTimeout(function(){br&&h(br,!1)},200)):h(i,!1)))}}).on("touchmove MSPointerMove pointermove",function(n){if(yo(n)){var u,i=$(n.target),f=$(br),e=i.closest(".ui-panel-inner,.app-wrapper"),t=df(n),r=f.length&&f.data("touch-start"),o;if(ht&&i.closest(".app-bar-tools").length&&!i.closest(".ui-btn").length){n.preventDefault();return}if(po){if(po=!1,e.length&&(t.y>gc.y?u=e.scrollTop()==0:t.y<gc.y&&(o=ga(e),u=o.height>=o.maxHeight-1)),u){wo();h();n.preventDefault();ht&&(li=!1);return}if(i.is(".ui-panel-dismiss,.ui-popup-screen,.app-scrollable-cover")){n.preventDefault();return}}f.length&&(r&&(r.scrollTop!=t.scrollTop||Math.abs(r.x-t.x)>0||Math.abs(r.y-t.y)>0)&&h(),wo())}}).on("touchend MSPointerUp pointerup",function(n){if(tt=df(n),yo(n)){var i=$(n.target).closest("a"),r=df(n),t=i.length&&i.data("touch-start");i.length&&(!t||t.scrollTop!=r.scrollTop||Math.abs(t.x-r.x)>0||Math.abs(t.y-r.y)>0)&&n.preventDefault();wo()}}).on("touchcancel MSPointerCancel pointercancel",function(n){yo(n)&&(h(),wo())}).on("scrollstart.app",function(){hh()}).on("scrolldir.app scrollstop.app",function(t){var i,u,e,h,c,o;if(t.relatedTarget){i=$(t.relatedTarget);u=i.find(".app-group");u.length&&(e=tf(),e.length&&(group=e.find(".app-group"),group.length||(group=$('<div class="app-group"><\/div>').appendTo(e),$(u[0]).is(".app-group-fixed")&&group.addClass("app-group-fixed")),h=i.offset().top+n.stickyHeaderBar().outerHeight(!0),u.each(function(){var n=$(this);if(n.offset().top+n.outerHeight(!0)/2>h)return!1;c=n}),o=(c||$(u[0])).html(),o!=group.html()&&(group.html(o),n.stickyHeaderBar().find(".app-group").html(o))));var s=i.data("scroll-dir"),f=i.find("> .app-grid, .app-group-fixed").length>0,r=f?n.stickyHeaderBar().find(".app-view-instruction,.app-group:not(.app-group-fixed)"):null;s=="up"?(f&&r.length&&!r.is(":visible")&&r.show().removeClass("app-hidden"),ui()):(s=="down"||!s&&f)&&(f&&i.scrollTop()!=0?f&&(r.length&&r.is(":visible")&&r.hide().addClass("app-hidden"),ui()):ut());t.type=="scrollstop"&&(clearInterval(sl),sl=setTimeout(function(n){var t=ga(n);t.top<=0&&t.height<=t.maxHeight+1&&(wi(),at())},250,i))}}).on("contextmenu MSHoldVisual selectstart",function(n){if(f()||ne!="mouse"||$(n.target).is(":input")){if(n.type=="contextmenu"){var t=$(".ui-popup-active .ui-popup.app-popup-listview");t.length&&(t.popup("close"),n.preventDefault())}}else n.preventDefault()}).one("pagecreate","#Main",function(){n._pageCreated=!0}).on("pagecontainerbeforechange",function(t,i){var e=typeof i.toPage=="string"?i.toPage:$(i.toPage).attr("id");if(typeof i.toPage=="string"&&i.toPage.match(/^http/))return(cf(!1),ku)?(ku=!1,!1):void 0;if(i.options.deferred){var o=n.pageInfo(),f=$(i.toPage),r=n.pageInfo(f.attr("id")),u=r&&r.dataView;n.stickyHeaderBar().find(".app-bar-text, .app-bar-label").removeData();r&&!i.toPage.prevObject||(ut(),extension=u&&u.extension(),n.search("configure",{allow:extension?extension.options().quickFind:!1}))}}).on("vmousedown",".app-static-label",function(){ow=c}).on("dblclick",".app-static-text",function(t){var e;if(!ci&&(sf(),e=n.pageInfo(),e)){var u=e.dataView,o=u?u._allFields:null,f=$(t.target),r;return f.is(".app-text-collapsible")&&(f=f.parent()),r=f.attr("class").match(/(app-field-(\w+))/),r&&u?(ts=!1,u.extension().executeInContext("Edit",null,!0),setTimeout(function(){$(o).each(function(){if(o[this.AliasIndex].Name==r[2])return r=this.Name,!1});var n=i.activePage.find("*:input.app-field-"+r),t=n.parent().find(".app-lookup-input"),u=t.length?t:n;u.focus().select();ts=!0},500),!1):void 0}}).on("vclick","a",bk).on("vclick",".app-input-value",function(n){return $(n.target).prev().focus(),!1}).on("vclick",".app-btn-toggle",wk).on("vclick",".app-filter",function(t){var i=$(t.target).closest(".app-echo");return i.length&&n.contextScope(i.attr("data-for")),pr({mode:"everything"}),!1}).on("vclick","[data-href]",function(){var n=$(this),i=n.attr("data-href"),t=n.closest(".app-field");return t.addClass("app-selected"),setTimeout(function(){t.removeClass("app-selected");s.location.href=i},bt),!1}).on("vclick contextmenu",".app-grid-header",function(n){var t=$(n.target),i={x:n.pageX,y:null};if(!t.is(".app-btn-more"))return t.is(".app-icon")&&(t=t.parent()),wh(n)?yb(fp(t)):(t.attr("data-field-name")||$(this).find("span").each(function(){var i=$(this),r=i.offset().left;if(!i.is(".app-btn-check,.app-btn-more")&&r<=n.pageX&&n.pageX<r+i.outerWidth(!0))return t=i,!1}),t.is("span")&&!t.is(".app-btn-check,.app-frozen-spacer")&&(t.addClass("ui-btn-active"),i.x&&(i.y=t.offset().top+t.outerHeight()*.75),n.preventDefault(),setTimeout(function(){t.removeClass("ui-btn-active");ep(t,i)},200))),!1}).on("keydown keypress",function(t){var p=$(t.target),b=n._toolbar,l=t.type=="keydown",e,k=t.key,a=t.keyCode,r,o=l&&(a==114||a==70&&t.ctrlKey),s=l&&a==27,h,v,y,f;if(!l||s||o){if(!c&&!p.is("#app-input-search")&&(e=String.fromCharCode(t.which),e.match(/[\w\-\"]/)||s||o)){if(gt()&&!ai){if(o)return setTimeout(function(){av(n._contextButton)}),!1;if(s&&!u.find(".ui-popup-active").length)return ta(),!1}else if(w()=="taskassistant"&&s)return ta(),!1;if(h=nr(),h.length&&(v=h.offset().top,y=v+h.height()-1,i.activePage.find(".app-echo-controls .ui-btn.ui-icon-search").each(function(){var n=$(this),t;if(n.is(":visible")&&(t=n.offset().top,t>=v&&t<y-75))return r=n,f=$app.find(n.closest(".app-echo").attr("data-for")),!1})),r||(r=b.find(".ui-icon-search:visible"),f=n.dataView()),r.length){if(s)if(f&&f.extension().quickFind())ca(f,""),er(f),sh(r);else return!1;else if(o)r.trigger("vclick",!1),sh(r);else if(t.type=="keypress"){if(gt())return;ai!=null&&(e=ai+e);ai=e;ai.length==1&&(r.trigger("vclick",!1),sh(r))}return!1}}if(o)return!1}}).on("editorstart.app",ib).on("editorstop.app",rb);o.on("resize",function(){nl||(nl=!0,no(),$(".app-echo-controls,.app-bar-controls").hide(),$(".app-tabs ul").css("visibility","hidden"),$(document).trigger("resizing.app"),n._toolbarButtons.hide(),n._toolbarUserName.text("").removeData("positioned"))}).on("throttledresize",function(){nl=!1;ps();$(".ui-panel-dismiss").height(i.getScreenHeight());f()&&ii();g(!1,null,function(){ut();ui();tr()});ys(i.activePage);wi(100);clearTimeout(cl);cl=setTimeout(function(){var t=nr(),i;ge(t,!0);at(!0);at(!1);n.refreshMenuStrip();i=w();$(n._pages).each(function(){var t=this,n;t.echoId&&(n=$("#"+t.echoId),n.length&&n.closest(".ui-page").attr("id")!=i&&(t.echoChanged=!0,n.find(".app-echo-controls").addClass("app-stale")))});rh(t)},1e3);var t=$(".ui-popup");t.is(".app-popup-message,.app-popup-listview")?vt(t):t.popup("reposition",{positionTo:"window"});ci=!1;$(document).trigger("resized.app")}).on("orientationchange",function(){setTimeout(function(){c||ii();setTimeout(function(){c||ii()},500)},500)});Sys.Application.add_init(function(){});Sys.Application.add_load(function(){n._appLoaded=!0});Web.DataView.MobileGrid.registerClass("Web.DataView.MobileGrid",Web.DataView.MobileBase);Web.DataView.MobileForm.registerClass("Web.DataView.MobileForm",Web.DataView.MobileBase)})();